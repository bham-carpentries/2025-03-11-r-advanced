<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Advanced R: R for Reproducibility: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Lesson Description" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Advanced R: R for Reproducibility
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Advanced R: R for Reproducibility
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Advanced R: R for Reproducibility
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-introduction.html">1. Course introduction</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-good-practices.html">2. Good Practices</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-code-readability.html">3. Code readability</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-project-structure.html">4. Code structure</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-code-documentation.html">5. Code documentation</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-code-correctness.html">6. Code correctness</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-code-environment.html">7. Reproducible development environment</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-wrap-up.html">8. Wrap-up</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-introduction"><p>Content from <a href="01-introduction.html">Course introduction</a></p>
<hr>
<p>Last updated on 2025-03-12 |

        <a href="https://github.com/kkh451/r_reproducibility/edit/main/episodes/01-introduction.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is reproducible research?</li>
<li>Why is it important?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to:</p>
<ul>
<li>Understand the concept of reproducible research</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="jargon-busting">Jargon busting<a class="anchor" aria-label="anchor" href="#jargon-busting"></a>
</h2>
<hr class="half-width">
<p>Before we start with the course, below we cover the terminology and
explain terms, phrases, and concepts associated with software
development in reproducible research that we will use in this
course.</p>
<ul>
<li>
<strong>Reproducibility</strong> - the ability to be reproduced or
copied; the extent to which consistent results are obtained when an
experiment is repeated (definition from <a href="https://languages.oup.com/google-dictionary-en/" class="external-link">Google’s English
dictionary is provided by Oxford Languages</a>)</li>
<li>
<strong>Computational reproducibility</strong> - obtaining
consistent results using the same input data, computational methods
(code), and conditions of analysis; work that can be independently
recreated from the same data and the same code (<a href="https://the-turing-way.netlify.app/reproducible-research/overview/overview-definitions" class="external-link">definition</a>
by the <a href="https://the-turing-way.netlify.app/reproducible-research/reproducible-research" class="external-link">Turing
Way’s “Guide to Reproducible Research”</a>)</li>
<li>
<strong>Reproducible research</strong> - the idea that scientific
results should be documented in such a way that their deduction is fully
transparent (<a href="https://en.wikipedia.org/wiki/Reproducibility" class="external-link">definition</a> from
Wikipedia)</li>
<li>
<strong>Open research</strong> - research that is openly accessible
by others; concerned with making research more transparent, more
collaborative, more wide-reaching, and more efficient (<a href="https://en.wikipedia.org/wiki/Open_research" class="external-link">definition</a> from
Wikipedia)</li>
<li>
<strong>FAIR</strong> - an acronym that stands for Findable,
Accessible, Interoperable, and Reusable</li>
<li>
<strong>Sustainable software development</strong> - software
development practice that takes into account longevity and
maintainability of code (e.g. beyond the lifetime of the project),
environmental impact, societal responsibility and ethics in our software
practices.</li>
</ul>
<div id="computational-reproducibility" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="computational-reproducibility" class="callout-inner">
<h3 class="callout-title">Computational reproducibility</h3>
<div class="callout-content">
<p>In this course, we use the term “reproducibility” as a synonym for
“computational reproducibility”.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="what-is-reproducible-research">What is reproducible research?<a class="anchor" aria-label="anchor" href="#what-is-reproducible-research"></a>
</h2>
<hr class="half-width">
<p><a href="https://the-turing-way.netlify.app/reproducible-research/reproducible-research" class="external-link">The
Turing Way’s “Guide to Reproducible Research”</a> provides an <a href="https://the-turing-way.netlify.app/reproducible-research/overview/overview-definitions" class="external-link">excellent
overview of definitions of “reproducibility” and “replicability”</a>
found in literature, and their different aspects and levels.</p>
<p>In this course, we adopt the Turing Way’s definitions:</p>
<ul>
<li>
<strong>Reproducible research</strong>: a result is reproducible
when the same analysis steps performed on the same data consistently
produce the same answer.
<ul>
<li>For example, two different people drop a pen 10 times each and every
time it falls to the floor. Or, we run the same code multiple times on
different machines and each time it produces the same result.</li>
</ul>
</li>
<li>
<strong>Replicable research</strong>: a result is replicable when
the same analysis performed on different data produces qualitatively
similar answers.
<ul>
<li>For example, instead of a pen, we drop a pencil, and it also falls
to the floor. Or, we collect two different datasets as part of two
different studies and run the same code over these datasets with the
same result each time.</li>
</ul>
</li>
<li>
<strong>Robust research</strong>: a result is robust when the same
data is subjected to different analysis workflows to answer the same
research question and a qualitatively similar or identical answer is
produced.
<ul>
<li>For example, I lend you my pen and you drop it out the window, and
it still falls to the floor. Or we run the same analysis implemented in
both Python and R over the same data and it produces the same
result.</li>
</ul>
</li>
<li>
<strong>Generalisable research</strong>: combining replicable and
robust findings allow us to form generalisable results that are broadly
applicable to different types of data or contexts.
<ul>
<li>For example, everything we drop - falls, therefore gravity
exists.</li>
</ul>
</li>
</ul>
<figure><img src="https://book.the-turing-way.org/build/reproducible-definit-84ca8cdef1e03e139e888c3c25e7ae16.svg" alt="Four cartoon images depicting two researchers at two machines which take in data and output the same landscape image in 4 different ways. These visually describe the four scenarios listed above." class="figure mx-auto d-block"><div class="figcaption"><em>The Turing Way project illustration of
aspects of reproducible research by Scriberia, used under a CC-BY 4.0
licence, <a href="https://doi.org/10.5281/zenodo.3332807" class="external-link">DOI:
10.5281/zenodo.3332807</a></em></div>
</figure><p>In this course we mainly address the aspect of reproducibility -
i.e. enabling others to run our code to obtain the same results.</p>
<div id="the-reproducibility-spectrum" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-reproducibility-spectrum" class="callout-inner">
<h3 class="callout-title">The reproducibility spectrum</h3>
<div class="callout-content">
<p>As with most things, reproducibility is non-binary. Having access to
code and data sometimes is good, but how about describing the specific
version of each software and packaged used? Do you need to describe the
operating system? How about the architecture of the CPU?</p>
<p>How exact should results be to be considered successfully reproduced?
Do we expect identical result bit by bit? Or do we allow for small
changes in non-significant digits, cosmetic variation in figures such as
fonts or colours?</p>
<p>For these reasons instead of saying that a research project is
reproducible or not, is often more helpful to say that a research
project is more or less reproducible and harder or easier to reproduce.
A project that publishes code and data but not software versions is
probably harder to reproduce than one that provides the virtual machine
in which the code was run.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="why-do-reproducible-research">Why do reproducible research?<a class="anchor" aria-label="anchor" href="#why-do-reproducible-research"></a>
</h2>
<hr class="half-width">
<p>Scientific transparency and rigor are key factors in research.
Scientific methodology and results need to be published openly and
replicated and confirmed by several independent parties. However,
research papers often lack the full details required for independent
reproduction or replication. Many attempts at reproducing or replicating
the results of scientific studies have failed in a variety of
disciplines ranging from psychology (<a href="https://www.science.org/doi/10.1126/science.aac4716" class="external-link">The Open
Science Collaboration (2015)</a>) to cancer sciences (<a href="https://elifesciences.org/articles/71601" class="external-link">Errington et al
(2021)</a>). These are called <a href="https://en.wikipedia.org/wiki/Replication_crisis" class="external-link"><strong>the
reproducibility and replicability crises</strong></a> - ongoing
methodological crises in which the results of many scientific studies
are difficult or impossible to repeat.</p>
<p>Reproducible research is a practice that ensures that researchers can
repeat the same analysis multiple times with the same results. It offers
many benefits to those who practice it:</p>
<ul>
<li>Reproducible research helps researchers remember how and why they
performed specific tasks and analyses; this enables easier explanation
of work to collaborators and reviewers.</li>
<li>Reproducible research enables researchers to quickly modify analyses
and figures - this is often required at all stages of research and
automating this process saves loads of time.</li>
<li>Reproducible research enables reusability of previously conducted
tasks so that new projects that require the same or similar tasks become
much easier and efficient by reusing or reconfiguring previous
work.</li>
<li>Reproducible research supports researchers’ career development by
facilitating the reuse and citation of all research outputs - including
both code and data.</li>
<li>Reproducible research is a strong indicator of rigor,
trustworthiness, and transparency in scientific research. This can
increase the quality and speed of peer review, because reviewers can
directly access the analytical process described in a manuscript. It
increases the probability that errors are caught early on - by
collaborators or during the peer-review process, helping alleviate the
reproducibility crisis.</li>
</ul></section><section><h2 class="section-heading" id="other-considerations">Other Considerations<a class="anchor" aria-label="anchor" href="#other-considerations"></a>
</h2>
<hr class="half-width">
<p>An important consideration is that reproducible results are not
necessarily scientifically, statistically or computationally correct -
incorrect results can be perfectly reproducible.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>As researchers, we often also want our work to be “computationally
correct” and “reusable”- that is, the code we write should do what we
think it does and we want to be able to use our code in future projects
or related tasks without having to rewrite it from scratch.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
</section><section><h2 class="section-heading" id="tools-and-practices">Tools and Practices<a class="anchor" aria-label="anchor" href="#tools-and-practices"></a>
</h2>
<hr class="half-width">
<p>Developing high quality, reusable and reproducible research code
often requires that researchers new practices.</p>
<p>This course teaches good practices and reproducible working methods
for those working with R and aims to provide researchers with the tools
and knowledge to feel confident when writing good quality and
sustainable code to support their research.</p>
</section><section><h2 class="section-heading" id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<hr class="half-width">
<p>We recommend the following resources for some additional reading on
the topic of this episode:</p>
<ul>
<li><a href="https://the-turing-way.netlify.app/reproducible-research/reproducible-research" class="external-link">The
Turing Way’s “Guide for Reproducible Research”</a></li>
<li>
<a href="https://esajournals.onlinelibrary.wiley.com/doi/10.1002/bes2.1801" class="external-link">A
Beginner’s Guide to Conducting Reproducible Research</a>, Jesse M.
Alston, Jessica A. Rick, Bulletin of The Ecological Society of America
102 (2) (2021), <a href="https://doi.org/10.1002/bes2.1801" class="external-link uri">https://doi.org/10.1002/bes2.1801</a>
</li>
<li><a href="https://guereslib.github.io/ten-reproducible-research-things/" class="external-link">“Ten
reproducible research things” tutorial</a></li>
<li><a href="https://force11.org/groups/fair-4-research-software-fair4rs-working-group/" class="external-link">FORCE11’s
FAIR 4 Research Software (FAIR4RS) Working Group</a></li>
<li><a href="https://carpentries-lab.github.io/good-enough-practices/index.html" class="external-link">“Good
Enough Practices in Scientific Computing” course</a></li>
<li>
<a href="https://www.repro4everyone.org/" class="external-link">Reproducibility for
Everyone’s (R4E) resources</a>, community-led education initiative to
increase adoption of open research practices at scale</li>
<li>
<a href="https://forrt.org/resources/" class="external-link">Curated resources</a> by the
<a href="https://forrt.org/" class="external-link">Framework for Open and Reproducible
Research Training</a> (FORRT)</li>
</ul></section><section><h2 class="section-heading" id="acknowledgements-and-references">Acknowledgements and references<a class="anchor" aria-label="anchor" href="#acknowledgements-and-references"></a>
</h2>
<hr class="half-width">
<p>The content of this course borrows from or references <a href="reference.html#litref">various work</a>.</p>
</section><section><h2 class="section-heading" id="attribution">Attribution<a class="anchor" aria-label="anchor" href="#attribution"></a>
</h2>
<hr class="half-width">
<p>This episode reuses material from the <a href="https://carpentries-incubator.github.io/fair-research-software/01-introduction.html" class="external-link">“Introduction”</a>
episode of Software Carpentries Incubator course <a href="https://carpentries-incubator.github.io/fair-research-software/" class="external-link">“Tools
and practices of FAIR research software”</a> under a <a href="https://creativecommons.org/licenses/by/4.0/legalcode" class="external-link">CC-BY-4.0</a>
licence with modifications: (i) minor edits have been made to make the
material suitable for an audience of R users (e.g. replacing “software”
with “code” in places) (ii) section “Software in research and research
software” from the original source has been renamed “Tools and
Practices” and is shortened. (iii) objectives, questions, keypoints and
further reading have been edited to focus the material on
reproducibility rather than FAIR (iv) Some original material has been
introduced to maintain flow and is indicated by a footnoted reference.
(v) The callout “The reproducibility spectrum” has been added verbatim
from the lesson [“What is reproducibility anyway”]repro-rocks-what]
under <a href="https://creativecommons.org/licenses/by/4.0/legalcode" class="external-link">CC-BY-4.0</a>
from <a href="https://reproducibility.rocks/" class="external-link">“An R reproducibility
toolkit for the practical researcher”</a> by Elio Campitelli and Paola
Corrales.</p>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
<!--
Fair research software
 -->
<!--
Good Practices
 -->
<!---
Project Structure
--->
<!-------
Code Correctness
---->
<!--
Attribution
-->
</section><div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>From “An R reproducibility toolkit for the practical
researcher” by Elio Campitelli and Paola Corrales.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Original material.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div></section><section id="aio-02-good-practices"><p>Content from <a href="02-good-practices.html">Good Practices</a></p>
<hr>
<p>Last updated on 2025-03-12 |

        <a href="https://github.com/kkh451/r_reproducibility/edit/main/episodes/02-good-practices.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What good practices can to help us develop reproducible, reusable
and computationally correct R code?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to:</p>
<ul>
<li>Identify some good practices the help us develop reproducible,
reusable and computationally correct R code</li>
<li>Explain how can these practices support reproducibility</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="tools-and-good-practices">Tools and good practices<a class="anchor" aria-label="anchor" href="#tools-and-good-practices"></a>
</h2>
<hr class="half-width">
<p>There are various tools and practices that support the development of
reproducible, reusable and computationally correct R code In later
episodes we will describe these tools and practices in more detail.</p>
<div class="section level3">
<h3 id="coding-conventions">Coding conventions<a class="anchor" aria-label="anchor" href="#coding-conventions"></a>
</h3>
<p>Following coding conventions and guides for your R code that are
agreed upon by the community and other programmers are important
practices to ensure that others find it easy to read your code, reuse or
extend it in their own examples and applications.</p>
<p>For R, some key resources include:</p>
<ul>
<li>The <a href="https://style.tidyverse.org/" class="external-link">tidyverse style
guide</a>, for consistent naming conventions, indentation, and code
structure. This guide is especially useful if you’re working with
packages like ggplot2, dplyr, and tidyr.</li>
<li>
<a href="https://styler.r-lib.org/" class="external-link">styler</a> - An R package that
helps you automatically format your code according to a style
guide.</li>
<li>
<a href="https://lintr.r-lib.org/" class="external-link">lintr</a> - An R package that
checks your code for style issues and syntax errors.</li>
</ul>
</div>
<div class="section level3">
<h3 id="project-structure-rrtools-research-compendia">Project Structure (<code>rrtools</code> Research compendia)<a class="anchor" aria-label="anchor" href="#project-structure-rrtools-research-compendia"></a>
</h3>
<p>A well-structured project is essential for ensuring that your R code
is reproducible, maintainable, and easy to share when you are ready to
do so.</p>
<p>Using a research compendium provides an organized directory structure
that makes it easy to manage your R code, data, documentation, and
results.</p>
<p>A typical R research compendium structure might look like this:</p>
<pre><code>.
├── CONDUCT.md
├── CONTRIBUTING.md
├── DESCRIPTION
├── LICENSE
├── LICENSE.md
├── NAMESPACE
├── R
│   └── process-data.R
├── README.Rmd
├── README.md
├── analysis
│   ├── data
│   │   ├── DO-NOT-EDIT-ANY-FILES-IN-HERE-BY-HAND
│   │   ├── derived_data
│   │   └── raw_data
│   │       └── gillespie.csv
│   ├── figures
│   ├── paper
│   │   ├── elsarticle.cls
│   │   ├── mybibfile.bib
│   │   ├── numcompress.sty
│   │   ├── paper.Rmd
│   │   ├── paper.fff
│   │   ├── paper.pdf
│   │   ├── paper.spl
│   │   ├── paper.tex
│   │   ├── paper_files
│   │   │   └── figure-latex
│   │   │       └── figure1-1.pdf
│   │   └── refs.bib
│   └── templates
│       ├── journal-of-archaeological-science.csl
│       ├── template.Rmd
│       └── template.docx
├── inst
│   └── testdata
│       └── gillespie.csv
├── man
│   └── recode_system_size.Rd
├── rrcompendium.Rproj
└── tests
    ├── testthat
    │   └── test-process-data.R
    └── testthat.R</code></pre>
<p>Reproduced from “Reproducible Research with rrtools” by Anna
Krystalli, licensed under <a href="https://creativecommons.org/licenses/by/4.0/deed.en" class="external-link">CC BY
4.0</a>.</p>
<p>Using rrtools or similar packages helps you to automatically set up
this structure, which makes it easier for others to navigate your
project.</p>
</div>
<div class="section level3">
<h3 id="code-testing-testthat">Code testing (<code>testthat</code>)<a class="anchor" aria-label="anchor" href="#code-testing-testthat"></a>
</h3>
<p>Testing ensures that your code is correct and does what it is set out
to do. When you write code you often feel very confident that it is
perfect, but when writing bigger codes or code that is meant to do
complex operations it is very hard to consider all possible edge cases
or notice every single typing mistake. Testing also gives other people
confidence in your code as they can see an example of how it is meant to
run and be assured that it does work correctly on their machine -
helping with code understanding and reusability.</p>
</div>
<div class="section level3">
<h3 id="code--and-project--level-documentation-roxygen2-pkgdown">Code- and project- level documentation (<code>roxygen2</code>,
<code>pkgdown</code>)<a class="anchor" aria-label="anchor" href="#code--and-project--level-documentation-roxygen2-pkgdown"></a>
</h3>
<p>Documentation comes in many forms - from <strong>code-level
documentation</strong> including descriptive names of variables and
functions and additional comments that explain lines of your code, to
<strong>project-level documentation</strong> (including README, LICENCE,
CITATION, etc. files) that help explain the legal terms of reusing it,
describe its functionality and how to install and run it, to whole
websites full of documentation with function definitions, usage
examples, tutorials and guides. You many not need as much documentation
as a large commercial software product, but making your code reusable
relies on other people being able to understand what your code does and
how to use it.</p>
<div class="section level4">
<h4 id="code-licensing">Code licensing<a class="anchor" aria-label="anchor" href="#code-licensing"></a>
</h4>
<p>A licence is a legal document which sets down the terms under which
the creator of work (such as written text, photographs, films, music,
software code) is releasing what they have created for others to use,
modify, extend or exploit. It is important to state the terms under
which software can be reused - the lack of a licence for your code
implies that no one can reuse the software at all.</p>
<p>A common way to declare your copyright of a piece of software and the
license you are distributing it under is to include a file called
<strong>LICENSE</strong> in the root directory of your code project
folder / repository.</p>
</div>
<div class="section level4">
<h4 id="code-citation">Code citation<a class="anchor" aria-label="anchor" href="#code-citation"></a>
</h4>
<p>We should add citation instructions to our project README or a
<strong>CITATION</strong> file to our project to provide instructions on
how and when to cite our code. A citation file can be a plain text
(CITATION.txt) or a Markdown file (CITATION.md), but there are certain
benefits to using use a special file format called the <a href="https://citation-file-format.github.io/" class="external-link">Citation File Format
(CFF)</a>, which provides a way to include richer metadata about code
(or datasets) we want to cite, making it easy for both humans and
machines to use this information.</p>
</div>
</div>
<div class="section level3">
<h3 id="managing-dependencies-renv">Managing dependencies (<code>renv</code>)<a class="anchor" aria-label="anchor" href="#managing-dependencies-renv"></a>
</h3>
<p>Managing dependencies is essential for ensuring that your R code runs
consistently across different environments. renv is a powerful R package
that helps you manage the libraries your project relies on, ensuring
that the exact versions of packages are used when your project is shared
or run in the future.</p>
</div>
</section><section><h2 class="section-heading" id="code-and-data-used-in-this-course">Code and data used in this course<a class="anchor" aria-label="anchor" href="#code-and-data-used-in-this-course"></a>
</h2>
<hr class="half-width">
<p>We are going to follow a fairly typical experience of a new PhD or
postdoc joining a research group. They were emailed some data and
analysis code bundled in a <code>.zip</code> archive and written by
another group member who worked on similar things but has since left the
group. They need to be able to install and run this code on their
machine, check they can understand it and then adapt it to their own
project.</p>
<p>As part of the <a href="./index.html#astronaut-data-and-analysis-code">setup for this
course</a>, you should have downloaded a <code>.zip</code> archive
containing the software project the new research team member was given.
Let’s unzip this archive and inspect its content in R Studio. The
software project contains:</p>
<ol style="list-style-type: decimal">
<li>a JSON file (<code>data.json</code>) - a snippet of which is shown
below - with data on extra-vehicular activities (EVAs or spacewalks)
undertaken by astronauts and cosmonauts from 1965 to 2013 (data provided
by NASA via its <a href="https://data.nasa.gov/Raw-Data/Extra-vehicular-Activity-EVA-US-and-Russia/9kcy-zwvn/about_data" class="external-link">Open
Data Portal</a>). The first few lines are:</li>
</ol>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">JSON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode json" tabindex="0"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ot">[</span><span class="fu">{</span><span class="dt">"eva"</span><span class="fu">:</span> <span class="st">"1"</span><span class="fu">,</span> <span class="dt">"country"</span><span class="fu">:</span> <span class="st">"USA"</span><span class="fu">,</span> <span class="dt">"crew"</span><span class="fu">:</span> <span class="st">"Ed White;"</span><span class="fu">,</span> <span class="dt">"vehicle"</span><span class="fu">:</span> <span class="st">"Gemini IV"</span><span class="fu">,</span> <span class="dt">"date"</span><span class="fu">:</span> <span class="st">"1965-06-03T00:00:00.000"</span><span class="fu">,</span> <span class="dt">"duration"</span><span class="fu">:</span> <span class="st">"0:36"</span><span class="fu">,</span> <span class="dt">"purpose"</span><span class="fu">:</span> <span class="st">"First U.S. EVA. Used HHMU and took  photos.  Gas flow cooling of 25ft umbilical overwhelmed by vehicle ingress work and helmet fogged.  Lost overglove.  Jettisoned thermal gloves and helmet sun visor"</span><span class="fu">}</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ot">,</span><span class="fu">{</span><span class="dt">"eva"</span><span class="fu">:</span> <span class="st">"2"</span><span class="fu">,</span> <span class="dt">"country"</span><span class="fu">:</span> <span class="st">"USA"</span><span class="fu">,</span> <span class="dt">"crew"</span><span class="fu">:</span> <span class="st">"David Scott;"</span><span class="fu">,</span> <span class="dt">"vehicle"</span><span class="fu">:</span> <span class="st">"Gemini VIII"</span><span class="fu">,</span> <span class="dt">"duration"</span><span class="fu">:</span> <span class="st">"0:00"</span><span class="fu">,</span> <span class="dt">"purpose"</span><span class="fu">:</span> <span class="st">"HHMU EVA cancelled before starting by stuck on vehicle thruster that ended mission early"</span><span class="fu">}</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ot">,</span><span class="fu">{</span><span class="dt">"eva"</span><span class="fu">:</span> <span class="st">"3"</span><span class="fu">,</span> <span class="dt">"country"</span><span class="fu">:</span> <span class="st">"USA"</span><span class="fu">,</span> <span class="dt">"crew"</span><span class="fu">:</span> <span class="st">"Eugene Cernan;"</span><span class="fu">,</span> <span class="dt">"vehicle"</span><span class="fu">:</span> <span class="st">"Gemini IX-A"</span><span class="fu">,</span> <span class="dt">"date"</span><span class="fu">:</span> <span class="st">"1966-06-05T00:00:00.000"</span><span class="fu">,</span> <span class="dt">"duration"</span><span class="fu">:</span> <span class="st">"2:07"</span><span class="fu">,</span> <span class="dt">"purpose"</span><span class="fu">:</span> <span class="st">"Inadequate restraints, stiff 25ft umbilical and high workloads exceeded suit vent loop cooling capacity and caused fogging.  Demo called off of tethered astronaut maneuvering unit"</span><span class="fu">}</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="ot">]</span></span></code></pre>
</div>
<p>Let’s have a closer look at one line of to understand the dataset a
little better:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">JSON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode json" tabindex="0"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ot">[</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="er">...</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="dt">"eva"</span><span class="fu">:</span> <span class="st">"13"</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="dt">"country"</span><span class="fu">:</span> <span class="st">"USA"</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="dt">"crew"</span><span class="fu">:</span> <span class="st">"Neil Armstrong;Buzz Aldrin;"</span><span class="fu">,</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  <span class="dt">"vehicle"</span><span class="fu">:</span> <span class="st">"Apollo 11"</span><span class="fu">,</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="dt">"date"</span><span class="fu">:</span> <span class="st">"1969-07-20T00:00:00.000"</span><span class="fu">,</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="dt">"duration"</span><span class="fu">:</span> <span class="st">"2:32"</span><span class="fu">,</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>  <span class="dt">"purpose"</span><span class="fu">:</span> <span class="st">"First to walk on the moon.  Some trouble getting out small hatch.  46.3 lb of geologic material collected.  EASEP seismograph and laser reflector exp deployed.  Solar wind exp deployed &amp; retrieved.  400 ft (120m) circuit on foot.  Dust issue post EVA"</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="fu">}</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="er">...</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="ot">]</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>an R script (<code>my_code_v2.R</code>) containing some analysis.
The first few lines are:</li>
</ol>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># https://data.nasa.gov/resource/eva.json (with modifications)</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co"># File paths</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>data_f <span class="ot">&lt;-</span> <span class="st">"/home/sarah/Projects/ssi-ukrn-fair-course/data.json"</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>data_t <span class="ot">&lt;-</span> <span class="st">"/home/sarah/Projects/ssi-ukrn-fair-course/data.csv"</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>g_file <span class="ot">&lt;-</span> <span class="st">"myplot.png"</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>fieldnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"eva"</span>, <span class="st">"country"</span>, <span class="st">"crew"</span>, <span class="st">"vehicle"</span>, <span class="st">"date"</span>, <span class="st">"duration"</span>, <span class="st">"purpose"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>data_raw <span class="ot">&lt;-</span> <span class="fu">readLines</span>(data_f, <span class="at">warn =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co"># 374</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">374</span>) {</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>  line <span class="ot">&lt;-</span> data_raw[i]</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>  <span class="fu">print</span>(line)</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>  data[[i]] <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">substr</span>(line, <span class="dv">2</span>, <span class="fu">nchar</span>(line)))</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>}</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co"># Initialize empty vectors</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>j <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> data) {  <span class="co"># Iterate manually</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"duration"</span> <span class="sc">%in%</span> <span class="fu">names</span>(data[[j]])) {</span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>    tt <span class="ot">&lt;-</span> data[[j]]<span class="sc">$</span>duration</span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>    <span class="cf">if</span> (tt <span class="sc">==</span> <span class="st">""</span>) {</span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>      <span class="co"># Do nothing if empty</span></span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a>      t_parts <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(tt, <span class="st">":"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a>      ttt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(t_parts[<span class="dv">1</span>]) <span class="sc">+</span> <span class="fu">as.numeric</span>(t_parts[<span class="dv">2</span>]) <span class="sc">/</span> <span class="dv">60</span>  <span class="co"># Convert to hours</span></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a>      <span class="fu">print</span>(ttt)</span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a>...</span></code></pre>
</div>
<p>The code in the R script does some common research tasks:</p>
<ul>
<li>Read in the data from the JSON file</li>
<li>Change the data from one data format to another and save to a file
in the new format (CSV)</li>
<li>Make a plot to visualise the data</li>
</ul>
<p>Let’s have a critical look at this code and think about how easy it
is to reproduce the outputs of this project.</p>
<div id="barriers-to-reproducibility-1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="barriers-to-reproducibility-1" class="callout-inner">
<h3 class="callout-title">Barriers to Reproducibility <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
</h3>
<div class="callout-content">
<p>Look at the code in RStudio:</p>
<ol style="list-style-type: lower-alpha">
<li>Can you rerun the code in R?</li>
</ol>
<p>(Hint: what changes do you need to make to get the code to run?)</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Are the results of the analysis repeatable?</li>
<li>Are there any barriers that would prevent the results generated by
the code from being reproduced by someone else in the future?</li>
</ol>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" data-bs-parent="#accordionHint1" aria-labelledby="headingHint1">
<div class="accordion-body">
<p>Here are some questions to help you identify barriers to
reproducibilty in the code:</p>
<ul>
<li>Code readability - Is the code easy to understand? Are there clear
comments explaining what each part of the code does?</li>
<li>Reusability - Can you easily modify the code to run on different
data or compute a different result?</li>
<li>Environment &amp; dependencies - Does the code specify what tools or
packages (e.g., R libraries, specific versions) need to be installed to
run it? Is it clear which version of the code was used in the
analysis?</li>
</ul>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ol style="list-style-type: lower-alpha">
<li>The code fails with errors because the file paths to the input and
output data are specific to the author’s computer and not available on
our computers:</li>
</ol>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in file(con, "r") : cannot open the connection
In addition: Warning message:
In file(con, "r") :
  cannot open file '/home/sarah/Projects/ssi-ukrn-fair-course/data.json': No such file or directory</code></pre>
</div>
<p>You need to change the data input/ output file paths to get the code
to run:</p>
<pre><code><span><span class="va">data_f</span> <span class="op">&lt;-</span> <span class="st">"data.json"</span></span>
<span><span class="va">data_t</span> <span class="op">&lt;-</span> <span class="st">"data.csv"</span></span></code></pre>
<p>b . The results of the analysis are not repeatable because the code
produces different output depending on whether it is run for the first
time in our RStudio session or not.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">SH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sh" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">In</span> the RStudio menus, select Session <span class="op">&gt;</span> Restart R and run the code once using <span class="st">"Source with Echo"</span>:</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="kw">```</span><span class="ex">output</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="op">&gt;</span> print<span class="kw">(</span><span class="va">ct</span><span class="op">[</span>length(ct)<span class="op">]</span><span class="kw">)</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="ex">[1]</span> 1840.2</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="ex">Now</span> run the code again:</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="kw">```</span><span class="ex">output</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="op">&gt;</span> print<span class="kw">(</span><span class="va">ct</span><span class="op">[</span>length(ct)<span class="op">]</span><span class="kw">)</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="ex">[1]</span> 1951.2</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="ex">Notice</span> how <span class="kw">`</span><span class="ex">ct</span><span class="kw">`</span> is incorrectly reset to <span class="kw">`</span><span class="ex">c</span><span class="er">(</span><span class="ex">111</span><span class="kw">)`</span> here:</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="kw">```</span><span class="ex">r</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="ex">ggplot</span><span class="er">(</span><span class="ex">tdf,</span> aes<span class="er">(</span><span class="ex">x</span> = years, y = ct<span class="kw">))</span> <span class="ex">+</span> geom_line<span class="er">(</span><span class="ex">color</span> = <span class="st">"black"</span><span class="kw">)</span> <span class="ex">+</span> geom_point<span class="er">(</span><span class="ex">color</span> = <span class="st">"black"</span><span class="kw">)</span> <span class="ex">+</span> </span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>    <span class="ex">labs</span><span class="er">(</span> <span class="ex">x</span> = <span class="st">"Year"</span>, y = <span class="st">"Total time spent in space to date (hours)"</span>, title = <span class="st">"Cumulative Spacewalk Time"</span> <span class="kw">)</span> <span class="ex">+</span> </span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>    <span class="ex">+</span> theme_minimal<span class="er">(</span><span class="kw">)</span> <span class="kw">;</span> <span class="ex">ct</span> <span class="op">&lt;</span>- c<span class="er">(</span><span class="ex">111</span><span class="kw">)</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="kw">```</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="ex">Let</span><span class="st">'s correct this as follows:</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="st">```r</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="st">ggplot(tdf, aes(x = years, y = ct)) + geom_line(color = "black") + geom_point(color = "black") + </span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="st">    labs( x = "Year", y = "Total time spent in space to date (hours)", title = "Cumulative Spacewalk Time" ) + </span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="st">    + theme_minimal() </span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a><span class="st">ct &lt;- c(0)</span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a><span class="st">The code should now be repeatable.</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: lower-alpha">
<li>Barriers to reproducibility include:
<ul>
<li>The code lacks clear comments, and the variable names and file names
are not descriptive. It is hard to determine the purpose of the code or
how it works. This may hinder another researcher’s ability to get the
code running.</li>
<li>The code does not explicitly specify what third party packages need
to be installed to run the code. There are library() statements in the
code but these are positioned through out the code and not in a single
place where they can be easily identified. We don’t know which version
of the packages were used in the analysis.</li>
<li>It is really difficult to understand what the code does and how it
does it. This makes it hard to modify the code to run on different
dataset or plot another facet of the data.</li>
</ul>
</li>
</ol>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<hr class="half-width">
<p>We recommend the following resources for some additional reading on
the topic of this episode:</p>
<ul>
<li>
<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC10969410/" class="external-link">Primer
on Reproducible Research in R: Enhancing Transparency and Scientific
Rigor.</a> Siraji MA, Rahman M. Clocks Sleep. 2023 Dec 20;6(1):1-10.
doi: 10.3390/clockssleep6010001. PMID: 38534796; PMCID:
PMC10969410.</li>
<li>[Reproducible Research in R: A Tutorial on How to Do the Same Thing
More Than Once.] <a href="https://www.mdpi.com/2624-8611/3/4/53" class="external-link">rrr-intro</a> Peikert, A.,
van Lissa, C. J., &amp; Brandmaier, A. M. (2021) Psych, 3(4), 836-867.
<a href="https://doi.org/10.3390/psych3040053" class="external-link uri">https://doi.org/10.3390/psych3040053</a>
</li>
</ul>
<p>Also check the <a href="reference.html#litref">full reference set</a>
for the course.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Coding conventions ensure your R code is easy to read, reuse, and
extend.</li>
<li>Research compendia provide an organized directory for your code,
data, documentation, and results.</li>
<li>Testing helps you check that your code is behaving as expected and
will continue to do so in the future or when used by someone else.</li>
<li>Documentation is essential for explaining what your code does, how
to use it, and the legal terms for reuse.</li>
<li>Dependency management helps making your code reproducible across
different computational environments.</li>
</ul>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="attribution">Attribution<a class="anchor" aria-label="anchor" href="#attribution"></a>
</h2>
<hr class="half-width">
<p>This episode is a remix of episodes <a href="https://carpentries-incubator.github.io/fair-research-software/02-fair-research-software.html" class="external-link">“FAIR
research software”</a> (Section: Software and data used in this course)
and <a href="https://carpentries-incubator.github.io/fair-research-software/03-tools.html" class="external-link">“Tools
and Practices for FAIR research software development”</a> from the
Software Carpentries Incubator course <a href="https://carpentries-incubator.github.io/fair-research-software/" class="external-link">“Tools
and practices of FAIR research software”</a>] under a <a href="https://creativecommons.org/licenses/by/4.0/deed.en" class="external-link">CC-BY-4.0</a>
licence with modifications.</p>
<p>The material has been edited to target a audience of R users and to
focus on reproducibility, correctness and reuse as end goals rather than
FAIR (findability, accessibility, interoperability and reusability) .
Consequently, several tools considered in the original course
e.g. persistent identifiers have been omitted. The section Code and data
used in this course has been adapted to reflect the R version of the
spacewalks repository used in this course.</p>
<p>Objectives, Questions, Key Points and Further Reading sections have
been updated to reflect the remixed R focussed content. Some original
material has been added – this is marked with a footnote <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
<!--
Fair research software
 -->
<!--
Good Practices
 -->
<!---
Project Structure
--->
<!-------
Code Correctness
---->
<!--
Attribution
-->
</section><div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Original material.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Original material.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div></section><section id="aio-03-code-readability"><p>Content from <a href="03-code-readability.html">Code readability</a></p>
<hr>
<p>Last updated on 2025-03-12 |

        <a href="https://github.com/kkh451/r_reproducibility/edit/main/episodes/03-code-readability.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Why does code readability matter?</li>
<li>How can I organise my code to be more readable?</li>
<li>What types of documentation can I include to improve the readability
of my code?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to:</p>
<ul>
<li>Organise R code into reusable functions that achieve a singular
purpose</li>
<li>Choose function and variable names that help explain the purpose of
the function or variable</li>
<li>Write informative comments and to provide more detail about what the
code is doing</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>In this episode, we will introduce the concept of readable code and
consider how it can help create reusable scientific software and empower
collaboration between researchers.</p>
<p>When someone writes code, they do so based on requirements that are
likely to change in the future. Requirements change because code
interacts with the real world, which is dynamic. When these requirements
change, the developer (who is not necessarily the same person who wrote
the original code) must implement the new requirements. They do this by
reading the original code to understand how it currently works and
identify what needs to change. Readable code facilitates this process
and saves future you and developers’ time and effort.</p>
<p>In order to develop readable code, we should ask ourselves: “If I
re-read this piece of code in fifteen days or one year, will I be able
to understand what I have done and why?” Or even better: “If a new
person who just joined the project reads my software, will they be able
to understand what I have written here?”</p>
<p>We will now learn about a few best practices we can follow to help
create more readable code.</p>
<section><h2 class="section-heading" id="remove-unused-files-and-folders">Remove unused files and folders<a class="anchor" aria-label="anchor" href="#remove-unused-files-and-folders"></a>
</h2>
<hr class="half-width">
<p>Let’s start by removing any files or folders that are not needed in
our project directory.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-r</span> astronaut-data-analyses-old</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="use-meaningful-file-names">Use meaningful file names<a class="anchor" aria-label="anchor" href="#use-meaningful-file-names"></a>
</h2>
<hr class="half-width">
<p>Let’s give our analysis script a meaningful name that reflects what
it does and do the same for our input and output files.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">mv</span> my_analysis_v2.R eva_data_analysis.R </span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">mv</span> data.json eva_data.json</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="place-library-statements-at-the-top">Place <code>library</code> statements at the top<a class="anchor" aria-label="anchor" href="#place-library-statements-at-the-top"></a>
</h2>
<hr class="half-width">
<p>Let’s have a look at our code again - the first thing we may notice
is that our script currently places <code>library()</code> statements
throughout the code. Conventionally, all <code>library()</code>
statements are placed at the top of the script so that dependent
libraries are clearly visible and not buried inside the code This will
help readability (accessibility) and reusability of our code.</p>
<p>Our code after the modification should look like the following.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">jsonlite</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># https://data.nasa.gov/resource/eva.json (with modifications)</span></span>
<span><span class="co"># File paths</span></span>
<span><span class="va">data_f</span> <span class="op">&lt;-</span> <span class="st">"eva-data.json"</span></span>
<span><span class="va">data_t</span> <span class="op">&lt;-</span> <span class="st">"eva-data.csv"</span></span>
<span><span class="va">g_file</span> <span class="op">&lt;-</span> <span class="st">"cumulative_eva_graph.png"</span></span>
<span></span>
<span><span class="va">fieldnames</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"eva"</span>, <span class="st">"country"</span>, <span class="st">"crew"</span>, <span class="st">"vehicle"</span>, <span class="st">"date"</span>, <span class="st">"duration"</span>, <span class="st">"purpose"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">data_raw</span> <span class="op">&lt;-</span> <span class="fu">readLines</span><span class="op">(</span><span class="va">data_f</span>, warn <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 374</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">374</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">line</span> <span class="op">&lt;-</span> <span class="va">data_raw</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="va">line</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="fu">substr</span><span class="op">(</span><span class="va">line</span>, <span class="fl">2</span>, <span class="fu">nchar</span><span class="op">(</span><span class="va">line</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Initialize empty vectors</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">j</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">data</span><span class="op">)</span> <span class="op">{</span>  <span class="co"># Iterate manually</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"duration"</span> <span class="op">%in%</span> <span class="fu">names</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tt</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">duration</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tt</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Do nothing if empty</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">t_parts</span> <span class="op">&lt;-</span> <span class="fu">strsplit</span><span class="op">(</span><span class="va">tt</span>, <span class="st">":"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="va">ttt</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">t_parts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">t_parts</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fl">60</span>  <span class="co"># Convert to hours</span></span>
<span>      <span class="fu">print</span><span class="op">(</span><span class="va">ttt</span><span class="op">)</span></span>
<span>      <span class="va">time</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">time</span>, <span class="va">ttt</span><span class="op">)</span></span>
<span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="st">"date"</span> <span class="op">%in%</span> <span class="fu">names</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="st">"eva"</span> <span class="op">%in%</span> <span class="fu">names</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">date</span> <span class="op">&lt;-</span> <span class="fu">as.Date</span><span class="op">(</span><span class="fu">substr</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span>, <span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span></span>
<span>        <span class="va">year</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="fu">format</span><span class="op">(</span><span class="va">date</span>,<span class="st">"%Y"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">dates</span>, <span class="va">date</span><span class="op">)</span></span>
<span>        <span class="va">years</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">years</span>, <span class="va">year</span><span class="op">)</span></span>
<span>        <span class="va">row_data</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">time</span> <span class="op">&lt;-</span> <span class="va">time</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co">## Comment out this bit if you don't want the spreadsheet</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu">exists</span><span class="op">(</span><span class="st">"row_data"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">print</span><span class="op">(</span><span class="va">row_data</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">w</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">write.table</span><span class="op">(</span><span class="va">row_data</span>, <span class="va">data_t</span>, sep <span class="op">=</span> <span class="st">","</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, col.names <span class="op">=</span> <span class="cn">TRUE</span>, append <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="fu">write.table</span><span class="op">(</span><span class="va">row_data</span>, <span class="va">data_t</span>, sep <span class="op">=</span> <span class="st">","</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, col.names <span class="op">=</span> <span class="cn">FALSE</span>, append <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">w</span> <span class="op">&lt;-</span> <span class="va">w</span><span class="op">+</span><span class="fl">1</span></span>
<span>    <span class="fu">rm</span><span class="op">(</span><span class="va">row_data</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">j</span> <span class="op">&lt;-</span> <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">exists</span><span class="op">(</span><span class="st">"ct"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="va">time</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ct</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">ct</span>, <span class="va">ct</span><span class="op">[</span><span class="fu">length</span><span class="op">(</span><span class="va">ct</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="va">k</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sorted_indices</span> <span class="op">&lt;-</span> <span class="fu">order</span><span class="op">(</span><span class="va">dates</span><span class="op">)</span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="va">years</span><span class="op">[</span><span class="va">sorted_indices</span><span class="op">]</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">time</span><span class="op">[</span><span class="va">sorted_indices</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Print total time in space</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">ct</span><span class="op">[</span><span class="fu">length</span><span class="op">(</span><span class="va">ct</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tdf</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span></span>
<span>  years <span class="op">=</span> <span class="va">years</span>,</span>
<span>  ct <span class="op">=</span> <span class="va">ct</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Plot the data</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">tdf</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">years</span>, y <span class="op">=</span> <span class="va">ct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span> x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>, title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span> <span class="op">)</span> <span class="op">+</span> <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Correction for repeatability</span></span>
<span><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save plot</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="va">g_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="use-meaningful-variable-names">Use meaningful variable names<a class="anchor" aria-label="anchor" href="#use-meaningful-variable-names"></a>
</h2>
<hr class="half-width">
<p>Variables are the most common thing you will assign when coding, and
it’s really important that it is clear what each variable means in order
to understand what the code is doing. If you return to your code after a
long time doing something else, or share your code with a colleague, it
should be easy enough to understand what variables are involved in your
code from their names. Therefore we need to give them clear names, but
we also want to keep them concise so the code stays readable. There are
no “hard and fast rules” here, and it’s often a case of using your best
judgment.</p>
<p>Some useful tips for naming variables are:</p>
<ul>
<li>Short words are better than single character names. For example, if
we were creating a variable to store the speed to read a file,
<code>s</code> (for ‘speed’) is not descriptive enough but
<code>MBReadPerSecondAverageAfterLastFlushToLog</code> is too long to
read and prone to misspellings. <code>ReadSpeed</code> (or
<code>read_speed</code>) would suffice.</li>
<li>If you are finding it difficult to come up with a variable name that
is both short and descriptive, go with the short version and use an
inline comment to describe it further (more on those in the next
section). This guidance does not necessarily apply if your variable is a
well-known constant in your domain - for example, <em>c</em> represents
the speed of light in physics.</li>
<li>Try to be descriptive where possible and avoid meaningless or funny
names like <code>foo</code>, <code>bar</code>, <code>var</code>,
<code>thing</code>, etc.</li>
</ul>
<p>Remember there are some restrictions to consider when naming
variables in R - variable names can only contain letters, numbers,
underscores and full-stops. They cannot start with a number or contain
spaces.</p>
<div id="give-a-descriptive-name-to-a-variable" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="give-a-descriptive-name-to-a-variable" class="callout-inner">
<h3 class="callout-title">Give a descriptive name to a variable</h3>
<div class="callout-content">
<p>Below we have a variable called <code>var</code> being set the value
of 9.81. <code>var</code> is not a very descriptive name here as it
doesn’t tell us what 9.81 means, yet it is a very common constant in
physics! Go online and find out which constant 9.81 relates to and
suggest a new name for this variable.</p>
<p>Hint: the units are <em>metres per second squared</em>!</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fl">9.81</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p><span class="math display">\[ 9.81 m/s^2 \]</span> is the <a href="https://en.wikipedia.org/wiki/Gravity_of_Earth" class="external-link">gravitational
force exerted by the Earth</a>. It is often referred to as “little g” to
distinguish it from “big G” which is the <a href="https://en.wikipedia.org/wiki/Gravitational_constant" class="external-link">Gravitational
Constant</a>. A more descriptive name for this variable therefore might
be:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g_earth</span> <span class="op">&lt;-</span> <span class="fl">9.81</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="rename-our-variables-to-be-more-descriptive" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="rename-our-variables-to-be-more-descriptive" class="callout-inner">
<h3 class="callout-title">Rename our variables to be more descriptive</h3>
<div class="callout-content">
<p>Let’s apply this to <code>eva_data_analysis.R</code>.</p>
<ol style="list-style-type: lower-alpha">
<li>
<p>Edit the code as follows to use descriptive variable names:</p>
<ul>
<li>Change data_f to input_file</li>
<li>Change data_t to output_file</li>
<li>Change g_file to graph_file</li>
</ul>
</li>
<li><p>What other variable names in our code would benefit from
renaming?</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<ol style="list-style-type: lower-alpha">
<li>Updated code:</li>
</ol>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">jsonlite</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># https://data.nasa.gov/resource/eva.json (with modifications)</span></span>
<span><span class="co"># File paths</span></span>
<span><span class="va">input_file</span> <span class="op">&lt;-</span> <span class="st">"eva-data.json"</span></span>
<span><span class="va">output_file</span> <span class="op">&lt;-</span> <span class="st">"eva-data.csv"</span></span>
<span><span class="va">graph_file</span> <span class="op">&lt;-</span> <span class="st">"cumulative_eva_graph.png"</span></span>
<span></span>
<span><span class="va">fieldnames</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"eva"</span>, <span class="st">"country"</span>, <span class="st">"crew"</span>, <span class="st">"vehicle"</span>, <span class="st">"date"</span>, <span class="st">"duration"</span>, <span class="st">"purpose"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">data_raw</span> <span class="op">&lt;-</span> <span class="fu">readLines</span><span class="op">(</span><span class="va">input_file</span>, warn <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 374</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">374</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">line</span> <span class="op">&lt;-</span> <span class="va">data_raw</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="va">line</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="fu">substr</span><span class="op">(</span><span class="va">line</span>, <span class="fl">2</span>, <span class="fu">nchar</span><span class="op">(</span><span class="va">line</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Initialize empty vectors</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">j</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">rownno</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">data</span><span class="op">)</span> <span class="op">{</span>  <span class="co"># Iterate manually</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"duration"</span> <span class="op">%in%</span> <span class="fu">names</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_text</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">duration</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">time_text</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Do nothing if empty</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">t_parts</span> <span class="op">&lt;-</span> <span class="fu">strsplit</span><span class="op">(</span><span class="va">time_text</span>, <span class="st">":"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="va">t_hours</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">t_parts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">t_parts</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fl">60</span>  <span class="co"># Convert to hours</span></span>
<span>      <span class="fu">print</span><span class="op">(</span><span class="va">t_hours</span><span class="op">)</span></span>
<span>      <span class="va">time</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">time</span>, <span class="va">t_hours</span><span class="op">)</span></span>
<span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="st">"date"</span> <span class="op">%in%</span> <span class="fu">names</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="st">"eva"</span> <span class="op">%in%</span> <span class="fu">names</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">date</span> <span class="op">&lt;-</span> <span class="fu">as.Date</span><span class="op">(</span><span class="fu">substr</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">date</span>, <span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span></span>
<span>        <span class="va">year</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="fu">format</span><span class="op">(</span><span class="va">date</span>,<span class="st">"%Y"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">dates</span>, <span class="va">date</span><span class="op">)</span></span>
<span>        <span class="va">years</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">years</span>, <span class="va">year</span><span class="op">)</span></span>
<span>        <span class="va">row_data</span> <span class="op">&lt;-</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">time</span> <span class="op">&lt;-</span> <span class="va">time</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co">## Comment out this bit if you don't want the spreadsheet</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu">exists</span><span class="op">(</span><span class="st">"row_data"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">print</span><span class="op">(</span><span class="va">row_data</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">rownno</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">write.table</span><span class="op">(</span><span class="va">row_data</span>, <span class="va">output_file</span>, sep <span class="op">=</span> <span class="st">","</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, col.names <span class="op">=</span> <span class="cn">TRUE</span>, append <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="fu">write.table</span><span class="op">(</span><span class="va">row_data</span>, <span class="va">output_file</span>, sep <span class="op">=</span> <span class="st">","</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, col.names <span class="op">=</span> <span class="cn">FALSE</span>, append <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">rownno</span> <span class="op">&lt;-</span> <span class="va">rowno</span><span class="op">+</span><span class="fl">1</span></span>
<span>    <span class="fu">rm</span><span class="op">(</span><span class="va">row_data</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">j</span> <span class="op">&lt;-</span> <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">exists</span><span class="op">(</span><span class="st">"cumulative_time"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="va">cumulative_time</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="va">time</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cumulative_time</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">cumulative_time</span>, <span class="va">cumulative_time</span><span class="op">[</span><span class="fu">length</span><span class="op">(</span><span class="va">cumulative_time</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="va">k</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sorted_indices</span> <span class="op">&lt;-</span> <span class="fu">order</span><span class="op">(</span><span class="va">dates</span><span class="op">)</span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="va">years</span><span class="op">[</span><span class="va">sorted_indices</span><span class="op">]</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">time</span><span class="op">[</span><span class="va">sorted_indices</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Print total time in space</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">cumulative_time</span><span class="op">[</span><span class="fu">length</span><span class="op">(</span><span class="va">cumulative_time</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tdf</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span></span>
<span>  years <span class="op">=</span> <span class="va">years</span>,</span>
<span>  cumulative_time <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Plot the data</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">tdf</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">years</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span> x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>, title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span> <span class="op">)</span> <span class="op">+</span> <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Correction for repeatability</span></span>
<span><span class="va">cumulative_time</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save plot</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: lower-alpha">
<li>We should also rename variables <code>w</code>, <code>tt</code>,
<code>ttt</code>, <code>ct</code> to be more descriptive. In the
solution above, these have been renamed to rownno, time_text, t_hours
and cumulative_time respectively.</li>
</ol>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="use-standard-libraries">Use standard libraries<a class="anchor" aria-label="anchor" href="#use-standard-libraries"></a>
</h2>
<hr class="half-width">
<p>Our script currently reads the data line-by-line from the JSON data
file and uses custom code to manipulate the data. Variables of interest
are stored in lists but there are more suitable data structures
(e.g. data frames) to store data in our case. By choosing custom code
over standard and well-tested libraries, we are making our code less
readable and understandable and more error-prone.</p>
<p>The main functionality of our code can be rewritten as follows using
the <code>dplyr</code> library to load and manipulate the data in data
frames.</p>
<p>The code should now look like:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">jsonlite</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">lubridate</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">readr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">stringr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">input_file</span> <span class="op">&lt;-</span> <span class="st">"eva-data.json"</span></span>
<span><span class="va">output_file</span> <span class="op">&lt;-</span> <span class="st">"eva-data.csv"</span></span>
<span><span class="va">graph_file</span> <span class="op">&lt;-</span> <span class="st">"cumulative_eva_graph.png"</span></span>
<span></span>
<span><span class="va">eva_data</span> <span class="op">&lt;-</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span></span>
<span><span class="fu">write_csv</span><span class="op">(</span><span class="va">eva_data</span>, <span class="va">output_file</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">eva_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span>  <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span></span>
<span>                  <span class="fu">sum</span><span class="op">(</span><span class="fu">as.numeric</span><span class="op">(</span><span class="fu">str_split_1</span><span class="op">(</span><span class="va">duration</span>, <span class="st">"\\:"</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, plot <span class="op">=</span> <span class="va">time_in_space_plot</span><span class="op">)</span></span></code></pre>
</div>
<p>We should replace the existing code in our R script
<code>eva_data_analysis.R</code> with the above code.</p>
</section><section><h2 class="section-heading" id="use-comments-to-explain-functionality">Use comments to explain functionality<a class="anchor" aria-label="anchor" href="#use-comments-to-explain-functionality"></a>
</h2>
<hr class="half-width">
<p>Commenting is a very useful practice to help convey the context of
the code. It can be helpful as a reminder for your future self or your
collaborators as to why code is written in a certain way, how it is
achieving a specific task, or the real-world implications of your
code.</p>
<p>There are several ways to add comments to code:</p>
<ul>
<li>An <strong>inline comment</strong> is a comment on the same line as
a code statement. Typically, it comes after the code statement and
finishes when the line ends and is useful when you want to explain the
code line in short. Inline comments in R should be separated by at least
two spaces from the statement; they start with a # followed by a single
space, and have no end delimiter.</li>
</ul>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">5</span>  <span class="co"># In R, inline comments begin with the `#` symbol and a single space.</span></span></code></pre>
</div>
<ul>
<li>A <strong>multi-line</strong> or <strong>block comment</strong>
spans multiple lines. R doesn’t have a specific multiline comment
syntax, a common practice is to use a single # for each line but make it
look like a block comment for readability. You could also align the #
symbol vertically to create a visually consistent block of
comments.</li>
</ul>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ==========================================</span></span>
<span><span class="co"># This is a block comment.</span></span>
<span><span class="co"># You can write a detailed explanation here.</span></span>
<span><span class="co"># It can span multiple lines as needed.</span></span>
<span><span class="co"># ==========================================</span></span></code></pre>
</div>
<p>Here are a few things to keep in mind when commenting your code:</p>
<ul>
<li>Focus on the <strong>why</strong> and the <strong>how</strong> of
your code - avoid using comments to explain <strong>what</strong> your
code does. If your code is too complex for other programmers to
understand, consider rewriting it for clarity rather than adding
comments to explain it.</li>
<li>Make sure you are not reiterating something that your code already
conveys on its own. Comments should not echo your code.</li>
<li>Keep comments short and concise. Large blocks of text quickly become
unreadable and difficult to maintain.</li>
<li>Comments that contradict the code are worse than no comments. Always
make a priority of keeping comments up-to-date when code changes.</li>
</ul>
<div class="section level3">
<h3 id="examples-of-unhelpful-comments">Examples of unhelpful comments<a class="anchor" aria-label="anchor" href="#examples-of-unhelpful-comments"></a>
</h3>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">statetax</span> <span class="op">&lt;-</span> <span class="fl">1.0625</span>  <span class="co"># Assigns the float 1.0625 to the variable 'statetax'</span></span>
<span><span class="va">citytax</span> <span class="op">&lt;-</span> <span class="fl">1.01</span>  <span class="co"># Assigns the float 1.01 to the variable 'citytax'</span></span>
<span><span class="va">specialtax</span> <span class="op">&lt;-</span> <span class="fl">1.01</span>  <span class="co"># Assigns the float 1.01 to the variable 'specialtax'</span></span></code></pre>
</div>
<p>The comments in this code simply tell us what the code does, which is
easy enough to figure out without the inline comments.</p>
</div>
<div class="section level3">
<h3 id="examples-of-helpful-comments">Examples of helpful comments<a class="anchor" aria-label="anchor" href="#examples-of-helpful-comments"></a>
</h3>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">statetax</span> <span class="op">=</span> <span class="fl">1.0625</span>  <span class="co"># State sales tax rate is 6.25% through Jan. 1</span></span>
<span><span class="va">citytax</span> <span class="op">=</span> <span class="fl">1.01</span>  <span class="co"># City sales tax rate is 1% through Jan. 1</span></span>
<span><span class="va">specialtax</span> <span class="op">=</span> <span class="fl">1.01</span>  <span class="co"># Special sales tax rate is 1% through Jan. 1</span></span></code></pre>
</div>
<p>In this case, it might not be immediately obvious what each variable
represents, so the comments offer helpful, real-world context. The date
in the comment also indicates when the code might need to be
updated.</p>
<div id="add-comments-to-our-code" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="add-comments-to-our-code" class="callout-inner">
<h3 class="callout-title">Add comments to our code</h3>
<div class="callout-content">
<ol style="list-style-type: lower-alpha">
<li><p>Examine <code>eva_data_analysis.R</code>. Add as many comments as
you think is required to help yourself and others understand what that
code is doing.</p></li>
<li><p>Add as many print statements as you think is required to keep the
user informed about what the code is doing as it runs.</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>Some good comments and print statements may look like the example
below.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ibrary</span><span class="op">(</span><span class="va">jsonlite</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">lubridate</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">readr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">stringr</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># https://data.nasa.gov/resource/eva.json (with modifications)</span></span>
<span><span class="va">input_file</span> <span class="op">&lt;-</span> <span class="st">"eva-data.json"</span></span>
<span><span class="va">output_file</span> <span class="op">&lt;-</span> <span class="st">"eva-data.csv"</span></span>
<span><span class="va">graph_file</span> <span class="op">&lt;-</span> <span class="st">"cumulative_eva_graph.png"</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="st">"--START--"</span><span class="op">)</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="st">"Reading JSON file"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read the data from a JSON file into a dataframe</span></span>
<span><span class="va">eva_data</span> <span class="op">&lt;-</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="st">"Saving to CSV file"</span><span class="op">)</span></span>
<span><span class="co"># Save dataframe to CSV file for later analysis</span></span>
<span><span class="fu">write_csv</span><span class="op">(</span><span class="va">eva_data</span>, <span class="va">output_file</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="st">"Plotting cumulative spacewalk duration and saving to file"</span><span class="op">)</span></span>
<span><span class="co"># Plot cumulative time spent in space over years</span></span>
<span><span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">eva_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span></span>
<span>                  <span class="fu">sum</span><span class="op">(</span><span class="fu">as.numeric</span><span class="op">(</span><span class="fu">str_split_1</span><span class="op">(</span><span class="va">duration</span>, <span class="st">"\\:"</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Calculate cumulative time</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, plot <span class="op">=</span> <span class="va">time_in_space_plot</span><span class="op">)</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="st">"--END--"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="separate-units-of-functionality">Separate units of functionality<a class="anchor" aria-label="anchor" href="#separate-units-of-functionality"></a>
</h2>
<hr class="half-width">
<p>Functions are a fundamental concept in writing software and are one
of the core ways you can organise your code to improve its readability.
A function is an isolated section of code that performs a single,
<em>specific</em> task that can be simple or complex. It can then be
called multiple times with different inputs throughout a codebase, but
its definition only needs to appear once.</p>
<p>Breaking up code into functions in this manner benefits readability
since the smaller sections are easier to read and understand. Since
functions can be reused, codebases naturally begin to follow the <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" class="external-link">Don’t
Repeat Yourself principle</a> which prevents software from becoming
overly long and confusing. The software also becomes easier to maintain
because, if the code encapsulated in a function needs to change, it only
needs updating in one place instead of many. As we will learn in a
future episode, testing code also becomes simpler when code is written
in functions. Each function can be individually checked to ensure it is
doing what is intended, which improves confidence in the software as a
whole.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Decomposing code into functions helps with reusability of blocks of
code and eliminating repetition, but, equally importantly, it helps with
code readability and testing.</p>
</div>
</div>
</div>
<p>Looking at our code, you may notice it contains different pieces of
functionality:</p>
<ol style="list-style-type: decimal">
<li>reading the data from a JSON file</li>
<li>converting and saving the data in the CSV format</li>
<li>processing/cleaning the data and preparing it for analysis</li>
<li>data analysis and visualising the results</li>
</ol>
<p>Let’s refactor our code so that reading the data in JSON format into
a dataframe (step 1.) and converting it and saving to the CSV format
(step 2.) is extracted into a separate function. Let’s name this
function <code>read_json_to_dataframe</code>. The main part of the
script should then be simplified to invoke these new functions, while
the function itself contain the complexity of this step. We will
continue to work on steps 3. and 4. above later on.</p>
<p>After the initial refactoring, our code may look something like the
following.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">jsonlite</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">lubridate</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">readr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">stringr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">read_json_to_dataframe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"Reading JSON file"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_df</span> <span class="op">&lt;-</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">eva_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># https://data.nasa.gov/resource/eva.json (with modifications)</span></span>
<span><span class="va">input_file</span> <span class="op">&lt;-</span> <span class="st">"eva-data.json"</span></span>
<span><span class="va">output_file</span> <span class="op">&lt;-</span> <span class="st">"eva-data.csv"</span></span>
<span><span class="va">graph_file</span> <span class="op">&lt;-</span> <span class="st">"cumulative_eva_graph.png"</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="st">"--START--"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Read the data from a JSON file into a dataframe</span></span>
<span><span class="va">eva_data</span> <span class="op">&lt;-</span> <span class="fu">read_json_to_dataframe</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save dataframe to CSV file for later analysis</span></span>
<span><span class="fu">write_csv</span><span class="op">(</span><span class="va">eva_data</span>, <span class="va">output_file</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="st">"Plotting cumulative spacewalk duration and saving to file"</span><span class="op">)</span></span>
<span><span class="co"># Plot cumulative time spent in space over years</span></span>
<span><span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">eva_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span></span>
<span>                  <span class="fu">sum</span><span class="op">(</span><span class="fu">as.numeric</span><span class="op">(</span><span class="fu">str_split_1</span><span class="op">(</span><span class="va">duration</span>, <span class="st">"\\:"</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Calculate cumulative time</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, plot <span class="op">=</span> <span class="va">time_in_space_plot</span><span class="op">)</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="st">"--END--"</span><span class="op">)</span></span></code></pre>
</div>
<p>We have chosen to create functions for reading in our data files
since this is a very common task within research software. While this
function does not contain that many lines of code due to using the
<code>tidyverse</code> functions that do all the complex data reading
and data preparation operations, it can be useful to package these steps
together into reusable functions if you need to read in or write out a
lot of similarly structured files and process them in the same way.</p>
</section><section><h2 class="section-heading" id="function-documentation">Function Documentation<a class="anchor" aria-label="anchor" href="#function-documentation"></a>
</h2>
<hr class="half-width">
<p>Now that we have written some functions, it is time to document them
so that we can quickly recall (and others looking at our code in the
future can understand) what the functions do without having to read the
code.</p>
<p><em>Roxygen comments</em> are a specific type of function-level
documentation that are provided within R functions and classes. Function
level documentation should explain what that particular code is doing,
what parameters the function needs (inputs) and what form they should
take, what the function outputs (you may see words like ‘return’ here),
and errors (if any) that might be raised.</p>
<p>Providing Roxygen comments helps improve code readability since it
makes the function code more transparent and aids understanding.
Particularly, roxygen comments that provide information on the input and
output of functions makes it easier to reuse them in other parts of the
code, without having to read the full function to understand what needs
to be provided and what will be returned.</p>
<p>Roxygen comment lines in R start with #’ to indicate that they are
documentation and are written directly above the function definition.
The tag <span class="citation">@param</span> is used to document
function parameters, while <span class="citation">@return</span>
describes what the function returns, and you can also use <span class="citation">@details</span> to give additional information such as
errors.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Divide number x by number y.</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @param x A number to be divided.</span></span>
<span><span class="co">#' @param y A number to divide by.</span></span>
<span><span class="co">#' @return The result of dividing x by y.</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @details</span></span>
<span><span class="co">#' If y is zero, this will result in an error (division by zero).</span></span>
<span><span class="va">divide</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">return</span><span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>We’ll see later in the course how the <code>roxygen2</code> package
can be used to automatically generate formal documentation for the
function. while the package <code>pkgdown</code> can be used to generate
a documentation website for our whole project.</p>
<p>Let’s write a roxygen comment for the function
<code>read_json_to_dataframe</code> we introduced in the previous
exercise. Remember, questions we want to answer when writing the
function-level documentation include:</p>
<ul>
<li>What the function does?</li>
<li>What kind of inputs does the function take? Are they required or
optional? Do they have default values?</li>
<li>What output will the function produce?</li>
<li>What exceptions/errors, if any, it can produce?</li>
</ul>
<p>Our <code>read_json_to_dataframe</code> function fully described by a
roxygen comment block may look like:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Read and Clean EVA Data from JSON</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function reads EVA data from a JSON file, cleans it by converting</span></span>
<span><span class="co">#' the 'eva' column to numeric, converting data from text to date format,</span></span>
<span><span class="co">#. creating a year variable and removing rows with missing values, and sorts</span></span>
<span><span class="co">#' the data by the 'date' column.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param input_file A character string specifying the path to the input JSON file.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A cleaned and sorted data frame containing the EVA data.</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">read_json_to_dataframe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"Reading JSON file"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_df</span> <span class="op">&lt;-</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">eva_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div id="writing-roxygen-comments" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="writing-roxygen-comments" class="callout-inner">
<h3 class="callout-title">Writing roxygen comments</h3>
<div class="callout-content">
<p>Write a roxygen comment for this function
<code>text_to_duration</code>:.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">time_parts</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_split</span><span class="op">(</span><span class="va">duration</span>, <span class="st">":"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">hours</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">minutes</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">60</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>Our <code>text_to_duration</code> function fully described by roxygen
comments may look like:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Convert Duration from HH:MM Format to Hours</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function converts a duration in "HH:MM" format (as a character string)</span></span>
<span><span class="co">#' into the total duration in hours (as a numeric value).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @details</span></span>
<span><span class="co">#' When applied to a vector, it will only process and return the first element</span></span>
<span><span class="co">#' so this function must be applied to a data frame rowwise.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param duration A character string representing the duration in "HH:MM" format.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A numeric value representing the duration in hours.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' text_to_duration("03:45")  # Returns 3.75 hours</span></span>
<span><span class="co">#' text_to_duration("12:30")  # Returns 12.5 hours</span></span>
<span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">time_parts</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_split</span><span class="op">(</span><span class="va">duration</span>, <span class="st">":"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">hours</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">minutes</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">60</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="functions-for-modular-and-reusable-code-revisited-">Functions for modular and reusable code revisited.<a class="anchor" aria-label="anchor" href="#functions-for-modular-and-reusable-code-revisited-"></a>
</h2>
<hr class="half-width">
<p>As we have already seen earlier in this episode - functions play a
key role in creating modular and reusable code. We are going to carry on
improving our code following these principles:</p>
<ul>
<li>Each function should have a single, clear responsibility. This makes
functions easier to understand, test, and reuse.</li>
<li>Write functions that can be easily combined or reused with other
functions to build more complex functionality.</li>
<li>Functions should accept parameters to allow flexibility and
reusability in different contexts; avoid hard-coding values inside
functions/code (e.g. data files to read from/write to) and pass them as
arguments instead.</li>
</ul>
<p>Bearing in mind the above principles, we can further simplify the
main part of our code by extracting the code to process, analyse our
data and plot a graph into a separate function
<code>plot_cumulative_time_in_space</code>.</p>
<p>We can further extract the code to convert the spacewalk duration
text into a number to allow for arithmetic calculations (into a separate
function <code>text_to_duration</code>).</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">jsonlite</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">lubridate</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">readr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">stringr</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Read and Clean EVA Data from JSON</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function reads EVA data from a JSON file, cleans it by converting</span></span>
<span><span class="co">#' the 'eva' column to numeric, converting data from text to date format,</span></span>
<span><span class="co">#. creating a year variable and removing rows with missing values, and sorts</span></span>
<span><span class="co">#' the data by the 'date' column.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param input_file A character string specifying the path to the input JSON file.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A cleaned and sorted data frame containing the EVA data.</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">read_json_to_dataframe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"Reading JSON file"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_df</span> <span class="op">&lt;-</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">eva_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Convert Duration from HH:MM Format to Hours</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function converts a duration in "HH:MM" format (as a character string)</span></span>
<span><span class="co">#' into the total duration in hours (as a numeric value).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @details</span></span>
<span><span class="co">#' When applied to a vector, it will only process and return the first element</span></span>
<span><span class="co">#' so this function must be applied to a data frame rowwise.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param duration A character string representing the duration in "HH:MM" format.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A numeric value representing the duration in hours.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' text_to_duration("03:45")  # Returns 3.75 hours</span></span>
<span><span class="co">#' text_to_duration("12:30")  # Returns 12.5 hours</span></span>
<span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">time_parts</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_split</span><span class="op">(</span><span class="va">duration</span>, <span class="st">":"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">hours</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">minutes</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">60</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Plot Cumulative Time in Space Over the Years</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function plots the cumulative time spent in space over the years based on</span></span>
<span><span class="co">#' the data in the dataframe. The cumulative time is calculated by converting the</span></span>
<span><span class="co">#' "duration" column into hours, then computing the cumulative sum of the duration.</span></span>
<span><span class="co">#' The plot is saved as a PNG file at the specified location.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param tdf A dataframe containing a "duration" column in "HH:MM" format and a "date" column.</span></span>
<span><span class="co">#' @param graph_file A character string specifying the path to save the graph.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return NULL</span></span>
<span><span class="va">plot_cumulative_time_in_space</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tdf</span>, <span class="va">graph_file</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">tdf</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Add duration_hours column</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>     <span class="co"># Calculate cumulative time</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, plot <span class="op">=</span> <span class="va">time_in_space_plot</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>The main part of our code then becomes much simpler and more
readable, only containing the invocation of the following three
functions:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># https://data.nasa.gov/resource/eva.json (with modifications)</span></span>
<span><span class="va">input_file</span> <span class="op">&lt;-</span> <span class="st">"eva-data.json"</span></span>
<span><span class="va">output_file</span> <span class="op">&lt;-</span> <span class="st">"eva-data.csv"</span></span>
<span><span class="va">graph_file</span> <span class="op">&lt;-</span> <span class="st">"cumulative_eva_graph.png"</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="st">"--START--"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read the data from a JSON file into a dataframe</span></span>
<span><span class="va">eva_data</span> <span class="op">&lt;-</span> <span class="fu">read_json_to_dataframe</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="st">"Writing CSV File"</span><span class="op">)</span></span>
<span><span class="co"># Save dataframe to CSV file for later analysis</span></span>
<span><span class="fu">write_csv</span><span class="op">(</span><span class="va">eva_data</span>, <span class="va">output_file</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="st">"Plotting cumulative spacewalk duration and saving to file"</span><span class="op">)</span></span>
<span><span class="co"># Plot cumulative time spent in space over years</span></span>
<span><span class="fu">plot_cumulative_time_in_space</span><span class="op">(</span><span class="va">eva_data</span>, <span class="va">graph_file</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="st">"--END--"</span><span class="op">)</span></span>
<span><span class="va">...</span></span></code></pre>
</div>
<div id="using-the-styler-package-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="using-the-styler-package-1" class="callout-inner">
<h3 class="callout-title">Using the styler package <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: lower-alpha">
<li>Look up the stylr package. How can it help you make your code more
readable?</li>
<li>Install <code>stylr</code> and apply it to this poorly formatted
version of the <code>plot_cumulative_time_in_space</code> functions we
created.</li>
</ol>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_cumulative_time_in_space</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tdf</span>, <span class="va">graph_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">tdf</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>       <span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Add duration_hours column</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Calculate cumulative time</span></span>
<span>       <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>      </span>
<span>      title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, plot <span class="op">=</span> <span class="va">time_in_space_plot</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<ol style="list-style-type: lower-alpha">
<li><p>See <a href="https://r4ds.hadley.nz/workflow-style.html" class="external-link">R for
Data Science</a> for a discussion of <code>stylr</code> and how it can
help you make your code more readable.</p></li>
<li><p><code>plot_cumulative_time_in_space</code> after applying
<code>stylr</code></p></li>
</ol>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_cumulative_time_in_space</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tdf</span>, <span class="va">graph_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">tdf</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Add duration_hours column</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Calculate cumulative time</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, plot <span class="op">=</span> <span class="va">time_in_space_plot</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<hr class="half-width">
<p>We recommend the following resources for some additional reading on
the topic of this episode:</p>
<ul>
<li><a href="https://www.index.dev/blog/7-tell-tale-signs-of-unreadable-code-how-to-identify-and-fix-the-problem" class="external-link">7
tell-tale signs of unreadable code</a></li>
<li><a href="https://www.theguardian.com/info/2019/jan/29/code-readability-matters" class="external-link">‘Code
Readability Matters’ from the Guardian’s engineering blog</a></li>
</ul>
<p>Also check the <a href="reference.html#litref">full reference set</a>
for the course.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Readable code is easier to understand, maintain, debug and extend
(reuse) - saving time and effort.</li>
<li>Choosing descriptive variable and function names will communicate
their purpose more effectively.</li>
<li>Using comments and function-level documentation (roxygen) to
describe parts of the code will help transmit understanding and
context.</li>
<li>Use libraries or packages for common functionality to avoid
duplication.</li>
<li>Creating functions from the smallest, reusable units of code will
make the code more readable and help. compartmentalise which parts of
the code are doing what actions and isolate specific code sections for
re-use.</li>
</ul>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="attribution">Attribution<a class="anchor" aria-label="anchor" href="#attribution"></a>
</h2>
<hr class="half-width">
<p>This episode reuses material from the <a href="https://carpentries-incubator.github.io/fair-research-software/06-code-readability.html" class="external-link">“Code
Readability”</a> episode of the Software Carpentries Incubator course <a href="https://carpentries-incubator.github.io/fair-research-software/" class="external-link">“Tools
and practices of FAIR research software”</a> under a <a href="https://creativecommons.org/licenses/by/4.0/deed.en" class="external-link">CC-BY-4.0</a>
licence with modifications: (i) adaptations have been made to make the
material suitable for an audience of R users (e.g. replacing “software”
with “code” in places, docstrings with roxygen2), (ii) all code has been
ported from Python to R (iii) the example code has been deliberately
modified to be non-repeatable for teaching purposes. (iv) Objectives,
Questions, Key Points and Further Reading sections have been updated to
reflect the remixed R focussed content. Some original material has been
added – this is marked with a footnote.</p>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
<!--
Fair research software
 -->
<!--
Good Practices
 -->
<!---
Project Structure
--->
<!-------
Code Correctness
---->
<!--
Attribution
-->
</section><div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Original Material<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div></section><section id="aio-04-project-structure"><p>Content from <a href="04-project-structure.html">Code structure</a></p>
<hr>
<p>Last updated on 2025-03-12 |

        <a href="https://github.com/kkh451/r_reproducibility/edit/main/episodes/04-project-structure.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can we best structure our R project?</li>
<li>What are conventional places to store data, code, results and tests
within our research project?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to:</p>
<ul>
<li>Set up and use an R “research compendium” using rrtools to organise
a reproducible research project.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>In the previous episode we have seen some tools and practices that
can help up improve readability of our code - including breaking our
code into small, reusable functions that perform one specific task.</p>
<p>In this episode we will expand these practices to our (research)
projects as a whole.</p>
<section><h2 class="section-heading" id="introducing-research-compendia">Introducing Research Compendia<a class="anchor" aria-label="anchor" href="#introducing-research-compendia"></a>
</h2>
<hr class="half-width">
<p>Ensuring that our R project is organised and well-structured is just
as important as writing well-structured code. Following conventions on
consistent and informative directory structure for our project will
ensure people will immediately know where to find things and is
especially helpful for long-term research projects or when working in
teams.</p>
<p>Our project is currently set up as a simple R project with all of our
files stored in the root of the project folder. We could improve on this
significantly by creating a more structured directory layout like the
one below:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>project_name/
├── README.md             # overview of the project
├── data/                 # data files used in the project
│   ├── README.md         # describes where data came from
│   ├── raw/
│   └── processed/
├── manuscript/           # manuscript describing the results
├── results/              # results of the analysis (data, tables)
│   ├── preliminary/
│   └── final/
├── figures/              # results of the analysis (figures)
│   ├── comparison_plot.png
│   └── regression_chart.pdf
├── src/                  # contains source code for the project
│   ├── LICENSE           # license for your code
│   ├── main_script.R    # main script/code entry point
│   └── ...
├── doc/                  # documentation for your project
└── ...</code></pre>
</div>
<p>However, we are going to structure our project as an rrtools
(package) research compendium instead.</p>
<p>An rrtools compendium is essentially an R package containing
everything required to reproduce an analysis (data and functions). While
experience of building R packages is helpful - it isn’t necessary to get
started working with rrtools compendia - we will cover the necessary
detail as we go along.</p>
<div id="research-compendium-vs-r-project" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="research-compendium-vs-r-project" class="callout-inner">
<h3 class="callout-title">Research Compendium vs R Project</h3>
<div class="callout-content">
<p>A <strong>research compendium</strong> offers additional benefits
over a simple R project structure, particularly for ensuring
reproducibility and long-term sustainability of the project.</p>
<ul>
<li><p>While a simple R project can be <strong>well-organised</strong>,
a research compendium follows a standardised <strong>R package
structure</strong> that aligns with best practices for reproducible
research. This makes it far easier for someone new to the project to
understand and run the analysis.</p></li>
<li><p>rrtools compendia include <strong>metadata files</strong> like
<code>DESCRIPTION</code> and <code>NAMESPACE</code> that provide clear
documentation of dependencies, which helps other collaborators or future
users run your project with the correct packages and versions.</p></li>
<li><p>The compendium setup also allows you to include automatic
documentation generation through tools like <strong>roxygen2</strong>,
making it easier to maintain and update as the project evolves.</p></li>
<li><p>A research compendium supports <strong>automated testing</strong>
(using tools like <code>testthat</code>).</p></li>
</ul>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="setting-up-a-research-compendium">Setting up a research compendium<a class="anchor" aria-label="anchor" href="#setting-up-a-research-compendium"></a>
</h2>
<hr class="half-width">
<p>In this section we are going to setup an R compendium using the
rrtools package and copy over our content from out current project to
the new compendium.</p>
<p>The top-level of our folder structure for this course is organised as
follows:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>advanced_r/
├── project/
│   └── spacewalks1/ # contains source code for the project
└── compendium/</code></pre>
</div>
<p>Before we start, we need to close our current
<code>spacewalks1</code> project (File &gt;&gt; Close Project) and
create and open a new R project <code>spacewalks2</code> in the
compendium subdfolder of <code>advanced_r</code> (File &gt;&gt; New
Project &gt;&gt; New Directory &gt;&gt; New Project).</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>advanced_r/
├── project/
│   └── spacewalks1/
└── compendium/
│   └── spacewalks2/ </code></pre>
</div>
<p>We also need to install a number of packages we’ll need to start
working with the compendium:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"rrtools"</span><span class="op">)</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"usethis"</span><span class="op">)</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span></code></pre>
</div>
<p>Once we have created and launched the new project, we can start
setting up the compendium by running the following commands in the R
console:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">rrtools</span><span class="op">)</span></span>
<span><span class="fu">rrtools</span><span class="fu">::</span><span class="fu">use_compendium</span><span class="op">(</span>simple<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&gt; library(rrtools)
✔ Git is installed on this computer, your username is abc123</code></pre>
</div>
<pre><code>New project 'spacewalks2' is nested inside an existing project '/Users/myusername/projects/astronaut-data-analysis-r/advanced_r/compendium', which is rarely a good idea.
If this is unexpected, the here package has a function, `here::dr_here()` that reveals why '/Users/myusername/projects/astronaut-data-analysis-r/advanced_r/compendium' is regarded as a project.
Do you want to create anyway?

1: I agree
2: Absolutely not
3: Not now</code></pre>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Selection: 1
✔ Setting active project to '/Users/myusername/projects/astronaut-data-analysis-r/advanced_r/compendium/spacewalks2'
✔ Creating 'R/'
✔ Writing 'DESCRIPTION'
Package: spacewalks2
Title: What the Package Does (One Line, Title Case)
Version: 0.0.0.9000
Authors@R (parsed):
    * First Last &lt;first.last@example.com&gt; [aut, cre]
Description: What the package does (one paragraph).
License: MIT + file LICENSE
ByteCompile: true
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.3.2
✔ Writing 'NAMESPACE'
Overwrite pre-existing file 'spacewalks2.Rproj'?

1: Yup
2: Nope
3: Not now
</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Selection: 1
✔ Writing 'spacewalks2.Rproj'
✔ Adding '^spacewalks2\\.Rproj$' to '.Rbuildignore'
✔ Adding '.Rproj.user' to '.gitignore'
✔ Adding '^\\.Rproj\\.user$' to '.Rbuildignore'
✔ Opening '/Users/myusername/projects/astronaut-data-analysis-r/advanced_r/compendium/spacewalks2/' in new RStudio session
✔ Setting active project to '&lt;no active project&gt;'
✔ The package spacewalks2 has been created

Next, you need to:  ↓ ↓ ↓
• Edit the DESCRIPTION file
• Add a license file (e.g. with usethis::use_mit_license(copyright_holder = 'Your Name'))
• Use other 'rrtools' functions to add components to the compendium</code></pre>
</div>
<p>The output of the use_compendium function provides a list of next
steps to complete the setup of the compendium.</p>
<p>We will follow these steps to complete the setup, but first let’s
take a look at the new directory structure that has been created:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>.
├── DESCRIPTION &lt;- .............................package metadata
|                                               dependency management
├── NAMESPACE &lt;- ...............................AUTO-GENERATED on build
├── R &lt;- .......................................folder for functions
└── spacewalks2.Rproj &lt;- ......................rstudio project file</code></pre>
</div>
<p>rrtools::use_compendium() creates the bare backbone of infrastructure
required for a research compendium.</p>
<p>At this point it provides facilities to store general metadata about
our compendium (eg bibliographic details to create a citation) and
manage dependencies in the DESCRIPTION file and store and document
functions in the R/ folder.</p>
<p>Together these allow us to manage, install and share functionality
associated with our project.</p>
<ul>
<li>A <code>DESCRIPTION</code> file is a required component of an R
package. This file contains metadata about our package, including the
name, version, author, and dependencies.</li>
<li>A <code>NAMESPACE</code> file is a required component of an R
package. Its role is to defines the functions, methods, and datasets
that are exported from a package (i.e., made available to users) and
those that are kept internal (i.e., not accessible directly by users).
It helps manage the visibility of functions and ensures that only the
intended parts of the package are exposed to the outside world. This
file is auto-generated when the package is built.</li>
<li>The <code>R/</code> folder contains the R scripts that contain the
functions in the package.</li>
<li>RStudio Project file <code>spacewalks2.Rproj</code> - this file is
used to open the project in RStudio.</li>
</ul>
<div class="section level3">
<h3 id="edit-the-description-file">Edit the DESCRIPTION file<a class="anchor" aria-label="anchor" href="#edit-the-description-file"></a>
</h3>
<p>Let’s start by editing the DESCRIPTION file.</p>
<pre class="text"><code>Package: spacewalks2
Title: What the Package Does (One Line, Title Case)
Version: 0.0.0.9000
Authors@R:
    person("First", "Last", , "first.last@example.com", role = c("aut", "cre"))
Description: What the package does (one paragraph).
License: MIT + file LICENSE
ByteCompile: true
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.3.2</code></pre>
<p>The following fields need to be updated:</p>
<ul>
<li>
<code>Package</code> - the name of the package.</li>
<li>
<code>Title</code> - a short description of what the package
does.</li>
<li>
<code>Version</code> - the version number of the package.</li>
<li>
<code>Authors@R</code> - the authors of the package.</li>
<li>
<code>Description</code> - a longer description of what the package
does.</li>
<li>
<code>License</code> - the license under which the package code is
distributed.</li>
</ul>
<pre><code>Package: spacewalks2
Title: Analysis of NASA's extravehicular activity datasets
Version: 0.0.0.9000
Authors@R: c(
    person(given   = "Kamilla",
           family  = "Kopec-Harding",
           role    = c("cre"),
           email   = "k.r.kopec-harding@bham.ac.uk",
           comment = c(ORCID = "{{0000-0002-2960-7944}}")),
    person(given   = "Sarah",
           family  = "Jaffa",
           role    = c("aut"),
           email   = "sarah.jaffa@manchester.ac.uk",
           comment = c(ORCID = "{{0000-0002-6711-6345}}")),
    person(given   = "Aleksandra",
           family  = "Nenadic",
           role    = c("aut"),
           comment = c(ORCID = "{{0000-0002-2269-3894}}"))
    )
Description: An R research compendium for researchers to generate visualisations and statistical
    summaries of NASA's extravehicular activity datasets.
License: MIT + file LICENSE
ByteCompile: true
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.3.2</code></pre>
</div>
<div class="section level3">
<h3 id="add-a-license-file">Add a license file<a class="anchor" aria-label="anchor" href="#add-a-license-file"></a>
</h3>
<p>Next, we need to add a license file to the compendium.<br>
A license file is a text file that specifies the legal terms under which
the code in the package can be used.</p>
<p>We can add a license file using the <code>usethis</code> package:
We’ll use an MIT license for this project. We discuss how to select a
license in the next episode.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_mit_license</span><span class="op">(</span>copyright_holder <span class="op">=</span> <span class="st">"Kamilla Kopec-Harding"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>✔ Writing 'LICENSE'
✔ Writing 'LICENSE.md'
✔ Adding '^LICENSE\\.md$' to '.Rbuildignore'</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="add-components-to-the-compendium">Add components to the compendium<a class="anchor" aria-label="anchor" href="#add-components-to-the-compendium"></a>
</h3>
<p>Once we have filled in the DESCRIPTION file and added a license file,
we can start adding content to the compendium. We’ll look a this in
detail in the next section</p>
</div>
</section><section><h2 class="section-heading" id="managing-functionality-in-a-package">Managing functionality in a package<a class="anchor" aria-label="anchor" href="#managing-functionality-in-a-package"></a>
</h2>
<hr class="half-width">
<p>We mentioned previously that an R compendium is an R package.
<code>rrtools</code> essentially provides us with an R package template
and in this section we will start populating this with the functionality
from our current project <code>spacewalks1</code>.</p>
<p>Our first task is to copy over the code from our current project to
the new compendium and get it working within the compendium / R package
structure. We’ll follow these steps:</p>
<ul>
<li>Create package functions</li>
<li>Document our functions</li>
<li>Build and install our compendium package</li>
<li>Check our package for issues</li>
<li>Fix any issues that come up</li>
<li>Re-build and install our compendium package</li>
<li>Write a script to run (drive) our analysis</li>
</ul>
<div class="section level3">
<h3 id="create-package-functions">Create package functions<a class="anchor" aria-label="anchor" href="#create-package-functions"></a>
</h3>
<p>We’ll start by creating a new R script file in the <code>R/</code>
folder of the compendium and copying over the functions we have created
so far.</p>
<p>To create or edit .R files in the R/ directory, we can use:</p>
<pre><code><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_r</span><span class="op">(</span><span class="st">"eva_data_analysis.R"</span><span class="op">)</span></span></code></pre>
<p>This creates a file called eva_data_analysis.R in the R/ directory
and opens it up for editing. Let’s populate this with the functions we
created in the previous episode.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># R/eva_data_analysis.R</span></span>
<span></span>
<span><span class="co">#' Read and Clean EVA Data from JSON</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function reads EVA data from a JSON file, cleans it by converting</span></span>
<span><span class="co">#' the 'eva' column to numeric, converting data from text to date format,</span></span>
<span><span class="co">#. creating a year variable and removing rows with missing values, and sorts</span></span>
<span><span class="co">#' the data by the 'date' column.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param input_file A character string specifying the path to the input JSON file.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A cleaned and sorted data frame containing the EVA data.</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">read_json_to_dataframe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"Reading JSON file"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_df</span> <span class="op">&lt;-</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">eva_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Convert Duration from HH:MM Format to Hours</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function converts a duration in "HH:MM" format (as a character string)</span></span>
<span><span class="co">#' into the total duration in hours (as a numeric value).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @details</span></span>
<span><span class="co">#' When applied to a vector, it will only process and return the first element</span></span>
<span><span class="co">#' so this function must be applied to a data frame rowwise.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param duration A character string representing the duration in "HH:MM" format.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A numeric value representing the duration in hours.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' text_to_duration("03:45")  # Returns 3.75 hours</span></span>
<span><span class="co">#' text_to_duration("12:30")  # Returns 12.5 hours</span></span>
<span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">time_parts</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_split</span><span class="op">(</span><span class="va">duration</span>, <span class="st">":"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">hours</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">minutes</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">60</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Plot Cumulative Time in Space Over the Years</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function plots the cumulative time spent in space over the years based on</span></span>
<span><span class="co">#' the data in the dataframe. The cumulative time is calculated by converting the</span></span>
<span><span class="co">#' "duration" column into hours, then computing the cumulative sum of the duration.</span></span>
<span><span class="co">#' The plot is saved as a PNG file at the specified location.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param tdf A dataframe containing a "duration" column in "HH:MM" format and a "date" column.</span></span>
<span><span class="co">#' @param graph_file A character string specifying the path to save the graph.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return NULL</span></span>
<span><span class="va">plot_cumulative_time_in_space</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tdf</span>, <span class="va">graph_file</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">tdf</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Add duration_hours column</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>     <span class="co"># Calculate cumulative time</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, plot <span class="op">=</span> <span class="va">time_in_space_plot</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Notice that this file <strong>only</strong> contains functions and we
have omitted <code>library()</code> calls. We will add the main script
that calls these functions later.</p>
</div>
<div class="section level3">
<h3 id="document-package-functions">Document package functions<a class="anchor" aria-label="anchor" href="#document-package-functions"></a>
</h3>
<p>Now, to have our functions exported as part of the spacewalks2
package, we need to document them using Roxygen2.</p>
<p>As we saw earlier, Roxygen2 provides a documentation framework in R
and allows us to write specially-structured comments preceding each
function definition. When we document our our package, these are
processed automatically to produce .Rd help files for our functions. The
contents of these files controls which are exported to the package
NAMESPACE.</p>
<p>The <span class="citation">@export</span> tag tells Roxygen2 to add a
function as an export in the NAMESPACE file, so that it will be
accessible and available for use after package installation. This means
that we need to add the <span class="citation">@export</span> function
to each of our functions:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Read and Clean EVA Data from JSON</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function reads EVA data from a JSON file, cleans it by converting</span></span>
<span><span class="co">#' the 'eva' column to numeric, converting data from text to date format,</span></span>
<span><span class="co">#. creating a year variable and removing rows with missing values, and sorts</span></span>
<span><span class="co">#' the data by the 'date' column.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param input_file A character string specifying the path to the input JSON file.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A cleaned and sorted data frame containing the EVA data.</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">read_json_to_dataframe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"Reading JSON file"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_df</span> <span class="op">&lt;-</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">eva_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Convert Duration from HH:MM Format to Hours</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function converts a duration in "HH:MM" format (as a character string)</span></span>
<span><span class="co">#' into the total duration in hours (as a numeric value).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @details</span></span>
<span><span class="co">#' When applied to a vector, it will only process and return the first element</span></span>
<span><span class="co">#' so this function must be applied to a data frame rowwise.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param duration A character string representing the duration in "HH:MM" format.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A numeric value representing the duration in hours.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' text_to_duration("03:45")  # Returns 3.75 hours</span></span>
<span><span class="co">#' text_to_duration("12:30")  # Returns 12.5 hours</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">time_parts</span> <span class="op">&lt;-</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">duration</span>, <span class="st">":"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">hours</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">minutes</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">60</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Plot Cumulative Time in Space Over the Years</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function plots the cumulative time spent in space over the years based on</span></span>
<span><span class="co">#' the data in the dataframe. The cumulative time is calculated by converting the</span></span>
<span><span class="co">#' "duration" column into hours, then computing the cumulative sum of the duration.</span></span>
<span><span class="co">#' The plot is saved as a PNG file at the specified location.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param tdf A dataframe containing a "duration" column in "HH:MM" format and a "date" column.</span></span>
<span><span class="co">#' @param graph_file A character string specifying the path to save the graph.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return NULL</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">plot_cumulative_time_in_space</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tdf</span>, <span class="va">graph_file</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">tdf</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Add duration_hours column</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>     <span class="co"># Calculate cumulative time</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, plot <span class="op">=</span> <span class="va">time_in_space_plot</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="build-and-install-package">Build and install package<a class="anchor" aria-label="anchor" href="#build-and-install-package"></a>
</h3>
<div class="section level4">
<h4 id="build-roxygen-documentation">Build Roxygen documentation<a class="anchor" aria-label="anchor" href="#build-roxygen-documentation"></a>
</h4>
<p>Now that we’ve annotated our source code we can build the
documentation either by clicking on More &gt; Document in the RStudio
Build panel or from the console using:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">document</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>ℹ Updating spacewalks2 documentation
ℹ Loading spacewalks2
Writing NAMESPACE
Writing read_json_to_dataframe.Rd
Writing text_to_duration.Rd
Writing plot_cumulative_time_in_space.Rd</code></pre>
</div>
<p>The man/ directory will now contain an .Rd file for each of our
functions.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>man
└── plot_cumulative_time_in_space.Rd
└── read_json_to_dataframe.Rd
└── text_to_duration.Rd</code></pre>
</div>
<p>and the NAMESPACE now contains an export() entry for each of our
functions:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co"># Generated by roxygen2: do not edit by hand</span></span>
<span><span class="fu">export</span><span class="op">(</span><span class="va">plot_cumulative_time_in_space</span><span class="op">)</span></span>
<span><span class="fu">export</span><span class="op">(</span><span class="va">read_json_to_dataframe</span><span class="op">)</span></span>
<span><span class="fu">export</span><span class="op">(</span><span class="va">text_to_duration</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="install-package">Install Package<a class="anchor" aria-label="anchor" href="#install-package"></a>
</h4>
<p>The usual workflow for package development is to:</p>
<ul>
<li>make some changes</li>
<li>build and install the package</li>
<li>unload and reload the package (often in a new R session)</li>
</ul>
<p>The best way to install and reload a package in a fresh R session is
to use the 🔨 Clean and Install cammand tab in the Build panel which
performs several steps in sequence to ensure a clean and correct
result:</p>
<ul>
<li>Unloads any existing version of the package (including shared
libraries if necessary).</li>
<li>Builds and installs the package using R CMD INSTALL.</li>
<li>Restarts the underlying R session to ensure a clean environment for
re-loading the package.</li>
<li>Reloads the package in the new R session by executing the library
function.</li>
</ul>
<p>Running the 🔨 Clean and Install command on our package results in
this output in the Build panel output:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>==&gt; R CMD INSTALL --preclean --no-multiarch --with-keep.source spacewalks2

* installing to library ‘/Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library’
* installing *source* package ‘spacewalks2’ ...
** using staged installation
** R
** byte-compile and prepare package for lazy loading
** help
*** installing help indices
** building package indices
** testing if installed package can be loaded from temporary location
** testing if installed package can be loaded from final location
** testing if installed package keeps a record of temporary installation path
* DONE (spacewalks2)</code></pre>
</div>
<p>We can inspect the resulting documentation for our function using
?plot_cumulative_time_in_space</p>
</div>
</div>
<div class="section level3">
<h3 id="check-package">Check package<a class="anchor" aria-label="anchor" href="#check-package"></a>
</h3>
<div class="section level4">
<h4 id="automated-checking">Automated checking<a class="anchor" aria-label="anchor" href="#automated-checking"></a>
</h4>
<p>An important part of the package development process is R CMD check.
R CMD check automatically checks your code and can automatically detects
many common problems that we’d otherwise discover the hard way.</p>
<p>To check our package, we can:</p>
<ul>
<li>use devtools::check()</li>
<li>click on the ✅Check tab in the Build panel.</li>
</ul>
<p>This: + Ensures that the documentation is up-to-date by running
devtools::document(). + Bundles the package before checking it.</p>
<p>More info on checks here.</p>
<p>Both these run R CMD check which return three types of messages:</p>
<ul>
<li>ERRORs: Severe problems that you should fix regardless of whether or
not you’re submitting to CRAN.</li>
<li>WARNINGs: Likely problems that you must fix if you’re planning to
submit to CRAN (and a good idea to look into even if you’re not). _
NOTEs: Mild problems. If you are submitting to CRAN, you should strive
to eliminate all NOTEs, even if they are false positives. Let’s Check
our package:</li>
</ul>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── R CMD check results ──────────────────────────────────────────────────────────── spacewalks2 0.0.0.9000 ────
Duration: 10s

❯ checking dependencies in R code ... WARNING
  '::' or ':::' imports not declared from:
    ‘ggplot2’ ‘stringr’

❯ checking R code for possible problems ... NOTE
  plot_cumulative_time_in_space: no visible global function definition
    for ‘ggplot’
  plot_cumulative_time_in_space: no visible global function definition
    for ‘mutate’
  plot_cumulative_time_in_space: no visible global function definition
    for ‘ungroup’
  plot_cumulative_time_in_space: no visible global function definition
    for ‘rowwise’
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘duration’
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘duration_hours’
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘cumulative_time’
  plot_cumulative_time_in_space: no visible global function definition
    for ‘geom_line’
  plot_cumulative_time_in_space: no visible global function definition
    for ‘labs’
  read_json_to_dataframe: no visible global function definition for
    ‘arrange’
  read_json_to_dataframe: no visible global function definition for
    ‘drop_na’
  read_json_to_dataframe: no visible global function definition for
    ‘mutate’
  read_json_to_dataframe: no visible global function definition for
    ‘fromJSON’
  read_json_to_dataframe: no visible binding for global variable ‘eva’
  read_json_to_dataframe: no visible global function definition for
    ‘ymd_hms’
  read_json_to_dataframe: no visible global function definition for
    ‘year’
  Undefined global functions or variables:
    arrange cumulative_time drop_na duration duration_hours eva fromJSON
    geom_line ggplot labs mutate rowwise ungroup year ymd_hms

0 errors ✔ | 1 warning ✖ | 1 notes ✖</code></pre>
</div>
<p>R CMD check succeeded OK so there’s a couple of flags from problems
and a NOTE. Let’s start troubleshooting with:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>our_function_name: no visible global function definition for ‘third_party_function_name’

read_json_to_dataframe: no visible global function definition for ‘mutate’
plot_cumulative_time_in_space: no visible global function definition for ‘ggplot’</code></pre>
</div>
<p>This arises because we are using lots of functions from third party
packages in our code e.g. mutate and ggplot from dplyr and ggplot2
respectively. However, we have not specified that they are imported from
the dplyr and ggplot2 NAMESPACEs so the checks look for functions with
those names in our package (spacewalks2) instead and obviously can’t
find anything.</p>
<p>To fix this we need to add the namespace of every third-party
function we use.</p>
<p>To specify the namespace of a function we use the notation
<package_name>::<function_name>, so let’s update our functions with
these details.</function_name></package_name></p>
<p>Let’s start with <code>read_json_to_dataframe</code>:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">read_json_to_dataframe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"Reading JSON file"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_df</span> <span class="op">&lt;-</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">eva_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Once we’ve added namespace notation to all the functions our
<code>read_json_to_dataframe</code> function looks like this:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">read_json_to_dataframe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"Reading JSON file"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_df</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">eva_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Add namespace notation to the
<code>plot_cumulative_time_in_space</code> function</p>
<pre><code><span><span class="va">plot_cumulative_time_in_space</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tdf</span>, <span class="va">graph_file</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">tdf</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Add duration_hours column</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>     <span class="co"># Calculate cumulative time</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, plot <span class="op">=</span> <span class="va">time_in_space_plot</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>plot_cumulative_time_in_space &lt;- function(tdf, graph_file) {</p>
<p>time_in_space_plot &lt;- tdf |&gt; dplyr::rowwise() |&gt;
dplyr::mutate(duration_hours = text_to_duration(duration)) |&gt; # Add
duration_hours column dplyr::ungroup() |&gt;
dplyr::mutate(cumulative_time = cumsum(duration_hours)) |&gt; #
Calculate cumulative time ggplot2::ggplot(ggplot2::aes(x = date, y =
cumulative_time)) + ggplot2::geom_line(color = “black”) + ggplot2::labs(
x = “Year”, y = “Total time spent in space to date (hours)”, title =
“Cumulative Spacewalk Time” )</p>
<p>ggplot2::ggsave(graph_file, width = 8, height = 6, plot =
time_in_space_plot) }</p>
</div>
</div>
</div>
</div>
<p>We can update the rest of our functions as follows:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Read and Clean EVA Data from JSON</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function reads EVA data from a JSON file, cleans it by converting</span></span>
<span><span class="co">#' the 'eva' column to numeric, converting data from text to date format,</span></span>
<span><span class="co">#. creating a year variable and removing rows with missing values, and sorts</span></span>
<span><span class="co">#' the data by the 'date' column.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param input_file A character string specifying the path to the input JSON file.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A cleaned and sorted data frame containing the EVA data.</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">read_json_to_dataframe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"Reading JSON file"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_df</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">eva_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Convert Duration from HH:MM Format to Hours</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function converts a duration in "HH:MM" format (as a character string)</span></span>
<span><span class="co">#' into the total duration in hours (as a numeric value).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @details</span></span>
<span><span class="co">#' When applied to a vector, it will only process and return the first element</span></span>
<span><span class="co">#' so this function must be applied to a data frame rowwise.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param duration A character string representing the duration in "HH:MM" format.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A numeric value representing the duration in hours.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' text_to_duration("03:45")  # Returns 3.75 hours</span></span>
<span><span class="co">#' text_to_duration("12:30")  # Returns 12.5 hours</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">time_parts</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_split</span><span class="op">(</span><span class="va">duration</span>, <span class="st">":"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">hours</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">minutes</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">60</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Plot Cumulative Time in Space Over the Years</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function plots the cumulative time spent in space over the years based on</span></span>
<span><span class="co">#' the data in the dataframe. The cumulative time is calculated by converting the</span></span>
<span><span class="co">#' "duration" column into hours, then computing the cumulative sum of the duration.</span></span>
<span><span class="co">#' The plot is saved as a PNG file at the specified location.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param tdf A dataframe containing a "duration" column in "HH:MM" format and a "date" column.</span></span>
<span><span class="co">#' @param graph_file A character string specifying the path to save the graph.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return NULL</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">plot_cumulative_time_in_space</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tdf</span>, <span class="va">graph_file</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">tdf</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Add duration_hours column</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>     <span class="co"># Calculate cumulative time</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">labs</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, plot <span class="op">=</span> <span class="va">time_in_space_plot</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Let’s run Check again:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── R CMD check results ───────────────── spacewalks2 0.0.0.9000 ────
Duration: 1m 7.7s

❯ checking dependencies in R code ... WARNING
  '::' or ':::' imports not declared from:
    ‘dplyr’ ‘ggplot2’ ‘jsonlite’ ‘lubridate’ ‘stringr’ ‘tidyr’

❯ checking R code for possible problems ... NOTE
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘duration’
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘duration_hours’
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘cumulative_time’
  read_json_to_dataframe: no visible binding for global variable ‘eva’
  Undefined global functions or variables:
    cumulative_time duration duration_hours eva

0 errors ✔ | 1 warning ✖ | 1 notes ✖
Error: R CMD check found WARNINGs
Execution halted

Exited with status 1.</code></pre>
</div>
</div>
<div class="section level4">
<h4 id="add-dependency">Add dependency<a class="anchor" aria-label="anchor" href="#add-dependency"></a>
</h4>
<p>In this next round of checks, the note about undefined global
functions is gone but now we have a warning regarding ‘::’ or ‘:::’
import not declared from: ‘dplyr’, ‘ggplot2’ and other packages. It’s
flagging the fact that we are wanting to import functions from dplyr and
other packages but have not yet declared the package as a dependency in
the Imports field of the DESCRIPTION file.</p>
<p>We can add dplyr and these other packages to Imports with:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_package</span><span class="op">(</span><span class="st">"dplyr"</span>, <span class="st">"Imports"</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_package</span><span class="op">(</span><span class="st">"ggplot2"</span>, <span class="st">"Imports"</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_package</span><span class="op">(</span><span class="st">"jsonlite"</span>, <span class="st">"Imports"</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_package</span><span class="op">(</span><span class="st">"lubridate"</span>, <span class="st">"Imports"</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_package</span><span class="op">(</span><span class="st">"stringr"</span>, <span class="st">"Imports"</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_package</span><span class="op">(</span><span class="st">"tidyr"</span>, <span class="st">"Imports"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>✔ Setting active project to '/Users/krharding/projects/uob/astronaut-data-analysis-not-so-fair-r/advanced_r/compendium/spacewalks2'
✔ Adding 'dplyr' to Imports field in DESCRIPTION
• Refer to functions with `dplyr::fun()`
&gt; usethis::use_package("ggplot2", "Imports")
✔ Adding 'ggplot2' to Imports field in DESCRIPTION
• Refer to functions with `ggplot2::fun()`
&gt; usethis::use_package("jsonlite", "Imports")
✔ Adding 'jsonlite' to Imports field in DESCRIPTION
• Refer to functions with `jsonlite::fun()`
&gt; usethis::use_package("lubridate", "Imports")
✔ Adding 'lubridate' to Imports field in DESCRIPTION
• Refer to functions with `lubridate::fun()`
&gt; usethis::use_package("stringr", "Imports")
✔ Adding 'stringr' to Imports field in DESCRIPTION
• Refer to functions with `stringr::fun()`
&gt; usethis::use_package("tidyr", "Imports")
✔ Adding 'tidyr' to Imports field in DESCRIPTION
• Refer to functions with `tidyr::fun()` </code></pre>
</div>
<p>Our description file now looks like this:</p>
<pre><code>Package: spacewalks2
Title: Analysis of NASA's extravehicular activity datasets
Version: 0.0.0.9000
Authors@R: c(
    person(given   = "Kamilla",
           family  = "Kopec-Harding",
           role    = c("cre"),
           email   = "k.r.kopec-harding@bham.ac.uk",
           comment = c(ORCID = "{{0000-0002-2960-7944}}")),
    person(given   = "Sarah",
           family  = "Jaffa",
           role    = c("aut"),
           email   = "sarah.jaffa@manchester.ac.uk",
           comment = c(ORCID = "{{0000-0002-6711-6345}}")),
    person(given   = "Aleksandra",
           family  = "Nenadic",
           role    = c("aut"),
           comment = c(ORCID = "{{0000-0002-2269-3894}}"))
    )
Description: An R research compendium for researchers to generate visualisations and statistical
    summaries of NASA's extravehicular activity datasets.
License: MIT + file LICENSE
ByteCompile: true
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.3.2
Imports:
    dplyr,
    ggplot2,
    jsonlite,
    lubridate,
    stringr,
    tidyr</code></pre>
<p>Let’s do one final check.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── R CMD check results ───────────────── spacewalks2 0.0.0.9000 ────
Duration: 13.7s

❯ checking for future file timestamps ... NOTE
  unable to verify current time

❯ checking R code for possible problems ... NOTE
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘duration’
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘duration_hours’
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘cumulative_time’
  read_json_to_dataframe: no visible binding for global variable ‘eva’
  Undefined global functions or variables:
    cumulative_time duration duration_hours eva

0 errors ✔ | 0 warnings ✔ | 1 notes ✖</code></pre>
</div>
<p>We’ll ignore this note for the time being. It results from the
non-standard evaluation used in dplyr functions. You can find out more
about it in the [Programming with dplyr
vignette][programming-with-dplyr-vignette].</p>
<div id="creating-a-driver-script" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="creating-a-driver-script" class="callout-inner">
<h3 class="callout-title">Creating a Driver Script</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li><p>Now that we’ve updated our functions to include the correct
namespace for dplyr functions, let’s build and install the package again
so that are functions are available for use.</p></li>
<li>
<p>Setup a run script that calls the functions in the package to run
the analysis on the EVA data. The steps below will lead you through this
process.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Create a new folder <code>analysis</code> in the root of the
compendium.</p></li>
<li>
<p>Create the following sub-folders in the <code>analysis</code>
folder to organise our scripts, data and results:</p>
<ul>
<li>
<code>scripts</code> - to store our analysis scripts</li>
<li>
<code>data</code> - to store raw and processed data</li>
<li>
<code>data/raw_data</code> - to store our raw data<br>
</li>
<li>
<code>data/derived_data</code> - to store the output of our
analysis<br>
</li>
<li>
<code>figures</code> - to store any figures generated by our
analysis</li>
<li>
<code>tables</code> - to store any tables generated by our
analysis</li>
</ul>
</li>
<li><p>Place the file <code>eva-data.json</code> in the
<code>analysis/data/raw_data</code> folder.</p></li>
<li>
<p>Create a new R script file in the <code>scripts</code> folder
called <code>run_analysis.R</code>. Use the <code>run_analysis</code>
function from <code>spacewalks1</code> and related code to run the
analysis</p>
<p>Hint: remember to update the input and output file locations in your
code.</p>
</li>
<li>
<p>One final piece of housekeeping we need to do is to edit the file
.Rbuildignore in the root of the compendium and add the following line
to it:</p>
<pre><code>^analysis$</code></pre>
<p>This will ensure that the analysis folder is not included in the
package next time it is built.</p>
</li>
</ol>
</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>Build and install the package</li>
</ol>
<p>Run “Clean and Install” from the build panel.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>==&gt; R CMD INSTALL --preclean --no-multiarch --with-keep.source spacewalks2

* installing to library ‘/Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library’
* installing *source* package ‘spacewalks2’ ...
** using staged installation
** R
** byte-compile and prepare package for lazy loading
** help
*** installing help indices
** building package indices
** testing if installed package can be loaded from temporary location
** testing if installed package can be loaded from final location
** testing if installed package keeps a record of temporary installation path
* DONE (spacewalks2)</code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Your <code>run_analysis.R</code> script should look like this:</li>
</ol>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">spacewalks</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">readr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">run_analysis</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span>, <span class="va">output_file</span>, <span class="va">graph_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"--START--\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_data</span> <span class="op">&lt;-</span> <span class="fu">read_json_to_dataframe</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span></span>
<span>  <span class="fu">write_csv</span><span class="op">(</span><span class="va">eva_data</span>, <span class="va">output_file</span><span class="op">)</span></span>
<span>  <span class="fu">plot_cumulative_time_in_space</span><span class="op">(</span><span class="va">eva_data</span>, <span class="va">graph_file</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"--END--\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">input_file</span> <span class="op">&lt;-</span> <span class="st">'analysis/data/raw_data/eva-data.json'</span></span>
<span><span class="va">output_file</span> <span class="op">&lt;-</span> <span class="st">'analysis/data/derived_data/eva-data.csv'</span></span>
<span><span class="va">graph_file</span> <span class="op">&lt;-</span> <span class="st">'analysis/figures/cumulative_eva_graph.png'</span></span>
<span><span class="fu">run_analysis</span><span class="op">(</span><span class="va">input_file</span>, <span class="va">output_file</span>, <span class="va">graph_file</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<hr class="half-width">
<p>We recommend the following resources for some additional reading on
the topic of this episode:</p>
<ul>
<li><a href="https://github.com/benmarwick/rrtools" class="external-link"><code>rrtools</code>
package documentation</a></li>
<li><a href="https://book.the-turing-way.org/reproducible-research/compendia" class="external-link">The
Turing Way’s “Guide for Reproducible Research – Research
Compendia”</a></li>
<li><a href="https://research-compendium.science/" class="external-link">A list of resources
about Research Compendia by Daniel Nust, Ben Marwich and Carl
Boettinger</a></li>
</ul>
<p>Also check the <a href="reference.html#litref">full reference set</a>
for the course.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Good practices for code and project structure are essential for
creating readable, reusable and reproducible projects.</li>
</ul>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="attribution">Attribution<a class="anchor" aria-label="anchor" href="#attribution"></a>
</h2>
<hr class="half-width">
<p>This episode reuses material from pages <a href="https://annakrystalli.me/rrtools-repro-research/create-compendium.html" class="external-link">“Create
a compendium”</a> and <a href="https://annakrystalli.me/rrtools-repro-research/package.html" class="external-link">“Manage
functionality as a package“</a> from <a href="https://annakrystalli.me/rrtools-repro-research/index.html" class="external-link">“Reproducible
Research in R with rrtools”</a> by Anna Krystalli under <a href="https://creativecommons.org/licenses/by/4.0/" class="external-link">CC-BY-4.0</a>
license with modifications. Sections covering git and github have been
removed. Output has been modified to reflect the spacewalks case study
project used in this course. Some original material has been added to
introduce the episode and to connect sections together where needed.
This is indicated with a footnote <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> e.g. Challenge “Create a Driver Script”.
The section ”Test function” is omitted and the Document function section
has been cut-down as roxygen is covered elsewhere in this course.<br>
Questions, Objectives and Keypoints have been re-used from the “Code
Structure” episod the Software Carpentries Incubator course <a href="https://carpentries-incubator.github.io/fair-research-software/07-code-structure.html" class="external-link">’Tools
and practices of FAIR research software”</a> under a <a href="https://creativecommons.org/licenses/by/4.0/" class="external-link">CC-BY-4.0</a>
licence with modifications: adaptations for R code.</p>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
<!--
Fair research software
 -->
<!--
Good Practices
 -->
<!---
Project Structure
--->
<!-------
Code Correctness
---->
<!--
Attribution
-->
</section><div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Original Material<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div></section><section id="aio-05-code-documentation"><p>Content from <a href="05-code-documentation.html">Code documentation</a></p>
<hr>
<p>Last updated on 2025-03-12 |

        <a href="https://github.com/kkh451/r_reproducibility/edit/main/episodes/05-code-documentation.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How should we document our R code?</li>
<li>Why is documentation important?</li>
<li>What are the minimum elements of documentation needed to support
reproducible research?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to:</p>
<ul>
<li>Use a <code>README</code> file to provide an overview of an R
project including citation instructions</li>
<li>Describe the main types of code documentation (tutorials, how to
guides, reference and explanation).</li>
<li>Describe the different formats available for delivering code
documentation (Markdown files, static webpages).</li>
<li>[Supplementary Material] Use <code>pkgdown</code> to generate and
manage comprehensive project documentation</li>
<li>[Supplementary Material] Apply a documentation framework to write
effective documentation of any type.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>We have seen how writing inline comments and roxygen2 function-level
documentation within our code can help with improving its readability.
The purpose of profect-level code documentation is to communicate other
important information about our analysis (its purpose, dependencies, how
to install and run it, etc.) to the people who need it – both users and
developers.</p>
<section><h2 class="section-heading" id="why-document-our-code">Why document our code?<a class="anchor" aria-label="anchor" href="#why-document-our-code"></a>
</h2>
<hr class="half-width">
<p>Code documentation is often perceived as a thankless and
time-consuming task with few tangible benefits and is often neglected in
research projects. However, like testing, documenting our code can help
ourselves and others conduct <strong>better research</strong> and
produce <strong>reproducible research</strong>:</p>
<ul>
<li>Good documentation captures important methodological details ready
for when we come to publish our research</li>
<li>Good documentation can help us return to a project seamlessly after
time away</li>
<li>Documentation can facilitate collaborations by helping us onboard
new project members quickly and more easily</li>
<li>Good documentation can save us time by answering frequently asked
questions (FAQs) about our code for us</li>
<li>Code documentation improves the re-usability of our code.
<ul>
<li>Good documentation can make our code more understandable and
reusable by others, and can bring us some citations and credit</li>
<li>How-to guides and tutorials ensure that users can install our code
independently and make use of its basic features</li>
<li>Reference guides and background information can help developers
understand our code sufficiently to modify/extend/repurpose it.</li>
</ul>
</li>
</ul></section><section><h2 class="section-heading" id="project-level-documentation">Project-level documentation<a class="anchor" aria-label="anchor" href="#project-level-documentation"></a>
</h2>
<hr class="half-width">
<p>In previous episodes we encountered several different forms of
in-code documentation aspects, including in-line comments and roxygen2
function-level documentation These are an excellent way to improve the
readability of our code, but by themselves are insufficient to ensure
that our code is easy to use, understand and modify - this requires
additional project-level documentation.</p>
<p>Project-level documentation includes various information and metadata
about our code such as the legal terms of reusing it, describe its
functionality on a high level and how to install, run and contribute to
it.</p>
<p>There are many different types of project-level documentation
including.</p>
<div class="section level3">
<h3 id="technical-documentation">Technical documentation<a class="anchor" aria-label="anchor" href="#technical-documentation"></a>
</h3>
<p>Project-level technical documentation encompasses:</p>
<ul>
<li>Tutorials - lessons that guide learners through a series of
exercises to build proficiency as using the code<br>
</li>
<li>How-To Guides - step by step instructions on how to accomplish
specific goals using the code.</li>
<li>Reference - a lookup manual to help users find relevant information
about the software e.g. functions and their parameters.</li>
<li>Explanation - conceptual discussion of the code to help users
understand implementation decisions</li>
</ul>
</div>
<div class="section level3">
<h3 id="project-metadata-files">Project metadata files<a class="anchor" aria-label="anchor" href="#project-metadata-files"></a>
</h3>
<p>A common way to to provide project-level documentation is to include
various metadata files in the software repository together with code.
Many of these files can be described as “social documentation”,
i.e. they indicate how users should “behave” in relation to our project.
Some common examples of repository metadata files and their role are
explained below:</p>
<table class="table">
<colgroup>
<col width="7%">
<col width="92%">
</colgroup>
<thead><tr class="header">
<th>File</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>README</td>
<td>Provides an overview of the project, including installation, usage
instructions, dependencies and links to other metadata files and
technical documentation (tutorial/how-to/explanation/reference)</td>
</tr>
<tr class="even">
<td>CONTRIBUTING</td>
<td>Explains to developers how to contribute code to the project
including processes and standards that should be followed</td>
</tr>
<tr class="odd">
<td>CODE_OF_CONDUCT</td>
<td>Defines expected standards of conduct when engaging in a software
project</td>
</tr>
<tr class="even">
<td>LICENSE</td>
<td>Defines the (legal) terms of using, modifying and distributing the
code</td>
</tr>
<tr class="odd">
<td>CITATION</td>
<td>Provides instructions on how to cite the code</td>
</tr>
<tr class="even">
<td>AUTHORS</td>
<td>Provides information on who authored the code (can also be included
in CITATION)</td>
</tr>
</tbody>
</table>
<div id="just-enough-documentation" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="just-enough-documentation" class="callout-inner">
<h3 class="callout-title">Just enough documentation</h3>
<div class="callout-content">
<p>For many small projects the following three pieces of project-level
documentation may be sufficient: README, LICENSE and CITATION.</p>
</div>
</div>
</div>
<p>Let’s look at each of these files in turn.</p>
</div>
<div class="section level3">
<h3 id="readme-file">README file<a class="anchor" aria-label="anchor" href="#readme-file"></a>
</h3>
<p>A README file is the first piece of documentation users are likely to
read and should provide sufficient information for users to and
developers to get started using your code.</p>
<p>Let’s create a simple README for our repository:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rrtools</span><span class="fu">::</span><span class="fu">use_readme_qmd</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>NB: the README created by rrtools provides a good template. For the
purposes of this course we’ll create our own.</p>
<p>We can start by adding a one-liner that explains the purpose of our
code and who it is for.</p>
<pre class="code"><code># Spacewalks

## Overview

Spacewalks is a research compendium written in R which contains the data
and code underpinning our analysis of NASA’s extravehicular activity
datasets. It is intended for researchers who want to reproduce our analysis.
</code></pre>
<p>Now let’s add a list of Spacewalks’ key features:</p>
<pre class="code"><code>
## Features

Key features of Spacewalks:

- Generates a line plot to show the cumulative duration of space walks
  over time</code></pre>
<p>Now let’s tell users about any pre-requisites required to run the
software:</p>
<pre class="code"><code>## Pre-requisites

This research compendium has been developed using the statistical
programming language R. To work with the compendium, you will need
installed on your computer the [R
software](https://cloud.r-project.org/) itself (version: \&gt;=4.3.3) and
optionally [RStudio
Desktop](https://rstudio.com/products/rstudio/download/).

Additional dependencies are documented in the DESCRIPTION file.</code></pre>
<div id="spacewalks-readme" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="spacewalks-readme" class="callout-inner">
<h3 class="callout-title">Spacewalks README</h3>
<div class="callout-content">
<p>Extend the README for Spacewalks by adding:</p>
<ol style="list-style-type: decimal">
<li>Installation instructions</li>
<li>A simple usage example / instructions</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Installation instructions:</p>
<p>NB: In the solution below the back ticks of each code block have been
escaped to avoid rendering issues (if you are copying and pasting the
text, make sure you unescape them).</p>
<pre class="text"><code>## Installation instructions

+ Clone the Spacewalks repository to your local machine using Git.
If you don't have Git installed, you can download it from the official Git website.

\`\`\`
git clone https://github.com/your-repository-url/spacewalks.git
cd spacewalks
\`\`\`

+ Open the project in RStudio by clickling on the spacewalks.Rproj file.
+ Navgigate to Build &gt; Check to check the package.
+ Navigate to Build &gt; Install install the package and restart the R sessions.


## Usage Intructions

To run this analysis, navigate to the analysis/scripts folder and open the
file `run_analysis.R` and run the script using `Source with echo` from
the text editor bar.
</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="license-file">LICENSE file<a class="anchor" aria-label="anchor" href="#license-file"></a>
</h3>
<p>Copyright allows a creator of work (such as written text,
photographs, films, music, software code) to state that they own the
work they have created. Copyright is automatically implied - even if the
creator does not explicitly assert it, copyright of the work exists from
the moment of creation. A licence is a legal document which sets down
the terms under which the creator is releasing what they have created
for others to use, modify, extend or exploit.</p>
<p>Because any creative work is copyrighted the moment it is created,
even without any kind of licence agreement, it is important to state the
terms under which code can be reused. The lack of a licence for your
software implies that no one can reuse the software at all - hence it is
imperative you declare it. A common way to declare your copyright of a
piece of software and the license you are distributing it under is to
include a file called LICENSE in the root directory of your code
repository.</p>
<p>There is an optional extra <a href="licensing.html">episode in this
course on different open source software licences</a> that you can
choose for your code and that we recommend for further reading.</p>

<div id="tools-to-help-you-choose-a-licence" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="tools-to-help-you-choose-a-licence" class="callout-inner">
<h3 class="callout-title">Tools to help you choose a licence</h3>
<div class="callout-content">
<ul>
<li>A <a href="licensing.html">short intro</a> on different open source
software licences included as extra content to this course.</li>
<li>
<a href="https://opensource.guide/legal/#which-open-source-license-is-appropriate-for-my-project" class="external-link">The
open source guide</a> on applying, changing and editing licenses.</li>
<li>
<a href="https://choosealicense.com/" class="external-link">choosealicense.com</a> online
tool has some great resources to help you choose a license that is
appropriate for your needs, and can even automate adding the LICENSE
file to your GitHub code repository.</li>
</ul>
</div>
</div>
</div>
<div id="change-the-license-of-your-code" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="change-the-license-of-your-code" class="callout-inner">
<h3 class="callout-title">Change the license of your code</h3>
<div class="callout-content">
<p>NB: One you’ve shared your code outside your research group or made
your code public it isn’t common to change the license and there are
complexities associated with this (see: <a href="https://r-pkgs.org/license.html#relicensing" class="external-link">12.2.4 Relicensing
Section in R Packages (2e)</a>). This challenge covers the situation
prior to code release when you<br>
might change your mind about the license you’d like to use.</p>
<ol style="list-style-type: decimal">
<li><p>Many R packages are licensed using GPL-2 / 3. Read the
description of GPL-2 and GPL-3 licenses from the <a href="https://choosealicense.com/" class="external-link">choosealicense.com</a>
website.</p></li>
<li><p>Use usethis::use_gpl3_license(copyright_holder = ‘You Name’)) to
change the license of your code to GPL-3. This function will create a
LICENSE file in the root of your repository with the text of the GPL-3
license.</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<ol style="list-style-type: decimal">
<li>See <a href="https://choosealicense.com/" class="external-link">choosealicense.com</a>
</li>
<li>usethis::use_gpl3_license(copyright_holder = ‘You Name’))</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="citation-information">CITATION information<a class="anchor" aria-label="anchor" href="#citation-information"></a>
</h3>
<p>We should add a citation instructions to our README to provide
instructions on how to cite our code. This encourages users to credit us
when they make use of our code:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="do">### How to cite</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>Please cite this compendium as<span class="sc">:</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="er">&gt;</span> Kopec<span class="sc">-</span>Harding et al, (<span class="dv">2025</span>). _Compendium of R code and data <span class="cf">for</span> an analyis of NASA extravehicular data. Accessed <span class="dv">12</span> Mar <span class="fl">2025.</span> Online at <span class="sc">&lt;</span>https<span class="sc">:</span><span class="er">//</span>doi.org<span class="sc">/</span>xxx<span class="sc">/</span>xxx<span class="sc">&gt;</span></span></code></pre>
</div>
<p>In this example, we assume that the code of the R Compendium will be
shared online via repository such as Zenodo (see <a href="%22https://carpentries-incubator.github.io/fair-research-software/10-open-collaboration.html#archiving-code-to-zenodo-and-obtaining-a-doi%22" class="external-link">“Archiving
code to Zenodo and obtaining a DOI”</a>.</p>
<div id="citation.cff" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="citation.cff" class="callout-inner">
<h3 class="callout-title">CITATION.cff</h3>
<div class="callout-content">
<p>We can include citation information in our README file, but there are
certain benefits to using a a special file format called the <a href="https://citation-file-format.github.io/" class="external-link">Citation File Format
(CFF)</a>, which provides a way to include richer metadata about code
(or datasets) we want to cite, making it easy for both humans and
machines to use this information.</p>
<p>Further information is available from the <a href="https://book.the-turing-way.org/communication/citable/citable-cff.html" class="external-link">Turing
Way’s guide to software citation</a>.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="supplementary-material-documentation-tools">[Supplementary Material] Documentation tools<a class="anchor" aria-label="anchor" href="#supplementary-material-documentation-tools"></a>
</h2>
<hr class="half-width">
<p>Once our project reaches a certain size or level of complexity we may
want to add additional documentation such as a standalone tutorial or
“background” explaining our methodological choices.</p>
<p>Once we move beyond using a README as our primary source of
documentation, we need to consider how we will distribute our
documentation to our users. Options include:</p>
<ul>
<li>A <code>docs/</code> folder of Markdown files</li>
<li>Adding a Wiki to our repository (if sharing online)</li>
<li>Creating a set of web pages (either bundled with our project folder
or hosted online) for our documentation using a static site generator
for our documentation such as <code>pkgdown</code>.</li>
</ul>
<p>Creating a static site is a popular solution as it has the key
benefit being able to automatically generate a reference manual from any
roxygen2 comment blocks we have added to our code.</p>
<div class="section level3">
<h3 id="pkgdown-1">pkgdown [^1]<a class="anchor" aria-label="anchor" href="#pkgdown-1"></a>
</h3>
<p>You can use package pkgdown to create an online site for your
documentation. It effectively recycles the documentation you have
already created for your functions, information in your README and
DESCRIPTION file and presents it in a standardised website form.</p>
<p>Let’s create such a site for our package.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu">build_site</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>This creates html documentation for our package in the docs/ folder
and presents you with a preview to the site.</p>
<div id="explore-your-documentation" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="explore-your-documentation" class="callout-inner">
<h3 class="callout-title">Explore your documentation</h3>
<div class="callout-content">
<p>Explore documentation in <code>docs/</code> folder built with
<code>pkgdown</code> for your project, starting from the
<code>index.html</code> file.</p>
<p>Open <code>index.html</code> file in a Web browser to see how it
renders.</p>
<p>Check <code>Reference</code> page in the top menu to see how roxygen2
blocks from your functions are provided here as a reference manual.</p>
</div>
</div>
</div>
<div id="hosting-documentation" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="hosting-documentation" class="callout-inner">
<h3 class="callout-title">Hosting documentation</h3>
<div class="callout-content">
<p>We saw how <code>pkgdown</code> documentation can be distributed with
our repository and viewed “offline” using a browser.</p>
<p>We can also make our documentation available as a live website by
deploying our documentation to a hosting service like GitHub pages. You
can find out more about how to do this here: see <a href="https://annakrystalli.me/rrresearchACCE20/packaging-functionality.html" class="external-link">Create
documentation site</a> in course <a href="https://annakrystalli.me/rrresearchACCE20/" class="external-link">“Reproducible Research
Data and Project Management in R”</a> for further details.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="documentation-guides">Documentation guides<a class="anchor" aria-label="anchor" href="#documentation-guides"></a>
</h2>
<hr class="half-width">
<p>Once we start to consider other forms of documentation beyond the
README, we can also increase reusability of our code by ensuring that
the content and style of our documentation matches its purpose.</p>
<p>Documentation guides such as <a href="https://www.writethedocs.org/" class="external-link">Write the Docs</a>, <a href="https://www.thegooddocsproject.dev/" class="external-link">The Good Docs Project</a> and
the <a href="https://diataxis.fr/" class="external-link">Diataxis framework</a> provide a
range of resources including documentation templates to help to help us
do this.</p>
<div id="spacewalks-how-to-guide" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="spacewalks-how-to-guide" class="callout-inner">
<h3 class="callout-title">Spacewalks how-to guide</h3>
<div class="callout-content">
<ol style="list-style-type: lower-alpha">
<li><p>Review the Diataxis guidance page on writing a How-to guide.
Identify three features of an effective how-to guide.</p></li>
<li><p>Following the Diataxis guidelines, write a how-to guide to show
users how to change the destination filename for the output CSV dataset
generated by the Spacewalks software.</p></li>
</ol>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Discussion hints &amp; solution </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>An effective how-to guide should:</p>
<ul>
<li>be goal oriented and focus on action.</li>
<li>avoid teaching or explanation</li>
<li>use appropriate language e.g. conditional imperatives</li>
<li>have an informative title</li>
</ul>
<p>An example how-to guide for our project to the file
<code>docs/how-to-guides.md</code>:</p>
<pre><code># How to change the file path of Spacewalk's output dataset

This guide shows you how to set the file path for Spacewalk's output
data set to a location of your choice.

By default, the cleaned data set in CSV format, generated by the Spacewalk software, is saved to the `analysis/data/derived-data`
folder within the working directory with file name `eva-data.csv`.

If you would like to modify the name or location of the output dataset, you should edit
the run_analysis.R script in the `analysis/scripts` folder directly and modify the `output_file` variable.

The specified destination folder `data/clean/` must exist before running spacewalks analysis script.</code></pre>
<p>Remember to rebuild your documentation:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">document</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<hr class="half-width">
<p>We recommend the following resources for some additional reading on
the topic of this episode:</p>
<ul>
<li>
<a href="https://github.com/hackergrrl/art-of-readme#bonus-the-readme-checklist" class="external-link">“The
Art of Readme”</a> article by Kira Oakley - a useful discussion of best
practices for writing a high-quality README</li>
<li>
<a href="https://www.software.ac.uk/blog/what-are-best-practices-research-software-documentation" class="external-link">What
are best practices for research software documentation?</a> (Software
Sustainability blog post) by Stephan Druskat et al.</li>
</ul>
<p>Also check the <a href="reference.html#litref">full reference set</a>
for the course.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Documentation allows users to run and understand software without
having to work things out for themselves directly from the source
code.</li>
<li>Software documentation improves the reusability of research
code.</li>
<li>A (good) README, CITATION entry/file and LICENSE file are the
minimum documentation elements required to support reproducible and
reusable research code.</li>
<li>Documentation can be provided to users in a variety of formats
including a <code>docs</code> folder of Markdown files, a repository
Wiki and static webpages.</li>
<li>A static documentation site can be created using the tool
<code>pkgdown</code>
</li>
<li>Documentation frameworks such as Diataxis provide content and style
guidelines that can helps us write high quality documentation.</li>
</ul>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="attribution">Attribution<a class="anchor" aria-label="anchor" href="#attribution"></a>
</h2>
<hr class="half-width">
<p>This episode reuses material from <a href="https://carpentries-incubator.github.io/fair-research-software/09-code-documentation.html" class="external-link">“Code
Documentation”</a> episode of the Software Carpentries Incubator course
<a href="https://carpentries-incubator.github.io/fair-research-software/" class="external-link">“Tools
and practices of FAIR research software”</a> under a <a href="https://creativecommons.org/licenses/by/4.0/deed.en" class="external-link">CC-BY-4.0</a>
with modifications, (i) adaptations have been made to make the material
suitable for an audience of R users (e.g. replacing “software” with
“code” in places and introducing R specific versions content
e.g. discussing pkgdown insteam of mkdocs) (ii) all code has been ported
from Python to R (iii) Objectives, Questions, Key Points and Further
Reading sections have been updated to reflect the remixed R focussed
content.</p>
<p>[^1] : Reused from <a href="https://annakrystalli.me/rrresearchACCE20/packaging-functionality.html" class="external-link">Create
documentation site</a> in course <a href="https://annakrystalli.me/rrresearchACCE20/" class="external-link">“Reproducible Research
Data and Project Management in R”</a> by Anna Krystalli under <a href="https://creativecommons.org/licenses/by/4.0/deed.en" class="external-link">CC-BY-4.0</a>.</p>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
<!--
Fair research software
 -->
<!--
Good Practices
 -->
<!---
Project Structure
--->
<!-------
Code Correctness
---->
<!--
Attribution
-->
</section></section><section id="aio-06-code-correctness"><p>Content from <a href="06-code-correctness.html">Code correctness</a></p>
<hr>
<p>Last updated on 2025-03-12 |

        <a href="https://github.com/kkh451/r_reproducibility/edit/main/episodes/06-code-correctness.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can we verify that our code is correct?</li>
<li>How can we automate testing in R?</li>
<li>What makes a “good” test?</li>
<li>Which parts of our code should we prioritise for testing?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to:</p>
<ul>
<li>Explain why code testing is important and how this supports
reproducibility.</li>
<li>Describe the different types of software tests (unit tests,
integration tests, regression tests).</li>
<li>Implement unit tests to verify that functions behave as expected
using the R testing framework <code>testthat</code>.</li>
<li>Interpret the output from <code>testthat</code> to identify which
functions are not behaving as expected.</li>
<li>Write tests using typical values, edge cases and invalid inputs to
ensure that the code can handle extreme values and invalid inputs
appropriately.</li>
<li>Evaluate code coverage to identify how much of the code is being
tested and identify areas that need further tests.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Now that we have improved the structure and readability of our code -
it is much easier to test its functionality and improve it further. The
goal of software testing is to check that the actual results produced by
a piece of code meet our expectations, i.e. are correct.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Open your research compendium in R Studio and clear your
environment:</p>
<ul>
<li>Double-click on spacwalks2.rproj to open your project in
RStudio.</li>
<li>Clear your environment using the built-in GUI:
<ul>
<li>Go to the Environment pane (usually on the top right).</li>
<li>Click on the ** broom icon** (Clear All) to remove all objects in
the environment.</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<section><h2 class="section-heading" id="why-use-software-testing">Why use software testing?<a class="anchor" aria-label="anchor" href="#why-use-software-testing"></a>
</h2>
<hr class="half-width">
<p>Adopting software testing as part of our research workflow helps us
to conduct <strong>better research</strong> and produce reproducible
software:</p>
<ul>
<li>Software testing can help us be more productive as it helps us to
identify and fix problems with our code early and quickly and allows us
to demonstrate to ourselves and others that our code does what we claim.
More importantly, we can share our tests alongside our code, allowing
others to verify our software for themselves.</li>
<li>The act of writing tests encourages to structure our code as
individual functions and often results in a more
<strong>readable</strong>, modular and maintainable codebase that is
easier to extend or repurpose.</li>
<li>Software testing improves the <strong>accessibility</strong> and
<strong>reusability</strong> of our code - well-written software tests
capture the expected behaviour of our code and can be used alongside
documentation to help other developers quickly make sense of our code.
In addition, a well tested codebase allows developers to experiment with
new features safe in the knowledge that tests will reveal if their
changes have broken any existing functionality.</li>
<li>Software testing also gives us the confidence to engage in open
research practices - if we are not sure that our code works as intended
and produces accurate results, we are unlikely to feel confident about
sharing our code with others. Software testing brings piece of mind by
providing a step-by-step approach that we can apply to verify that our
code is correct.</li>
</ul></section><section><h2 class="section-heading" id="types-of-software-tests">Types of software tests<a class="anchor" aria-label="anchor" href="#types-of-software-tests"></a>
</h2>
<hr class="half-width">
<p>There are many different types of software tests, including:</p>
<ul>
<li><p><strong>Unit tests</strong> focus on testing individual functions
in isolation. They ensure that each small part of the software performs
as intended. By verifying the correctness of these individual units, we
can catch errors early in the development process.</p></li>
<li><p><strong>Integration tests</strong> check how different parts of
the code e.g. functions work together.</p></li>
<li><p><strong>Regression tests</strong> are used to ensure that new
changes or updates to the codebase do not adversely affect the existing
functionality. They involve checking whether a program or part of a
program still generates the same results after changes have been
made.</p></li>
<li><p><strong>End-to-end</strong> tests are a special type of
integration testing which checks that a program as a whole behaves as
expected.</p></li>
</ul>
<p>In this course, our primary focus will be on unit testing. However,
the concepts and techniques we cover will provide a solid foundation
applicable to other types of testing.</p>
<div id="types-of-software-tests-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="types-of-software-tests-1" class="callout-inner">
<h3 class="callout-title">Types of software tests</h3>
<div class="callout-content">
<p>Fill in the blanks in the sentences below:</p>
<ul>
<li>__________ tests compare the ______ output of a program to its
________ output to demonstrate correctness.</li>
<li>Unit tests compare the actual output of a ______ ________ to the
expected output to demonstrate correctness.</li>
<li>__________ tests check that results have not changed since the
previous test run.</li>
<li>__________ tests check that two or more parts of a program are
working together correctly.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ul>
<li>End-to-end tests compare the actual output of a program to the
expected output to demonstrate correctness.</li>
<li>Unit tests compare the actual output of a single function to the
expected output to demonstrate correctness.</li>
<li>Regression tests check that results have not changed since the
previous test run.</li>
<li>Integration tests check that two or more parts of a program are
working together correctly.</li>
</ul>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="informal-testing">Informal testing<a class="anchor" aria-label="anchor" href="#informal-testing"></a>
</h2>
<hr class="half-width">
<p>How should we test our code?</p>
<p>One approach is to load the code or a function into our R
environment.</p>
<p>From the R console, we can then run one function or a piece of code
at a time and check that it behaves as expected. To do this, we can
observe how the function behaves using input values for which we know
what the correct return value should be.</p>
<p>Let’s do this for our <code>text_to_duration</code> function.</p>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Before we do so, let’s deliberately introduce a bug into our
code:</p>
<ol style="list-style-type: decimal">
<li>Open <code>R/eva_data_analysis.R</code>
</li>
<li>Let’s modify <code>text_to_duration</code> so that the
<code>minutes</code> component is divided by <code>6</code> instead of
<code>60</code> (an easy typo to make!).</li>
</ol>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">#' Convert Duration from HH:MM Format to Hours</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#' This function converts a duration in "HH:MM" format (as a character string)</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#' into the total duration in hours (as a numeric value).</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#' @param duration A character string representing the duration in "HH:MM" format.</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#' @return A numeric value representing the duration in hours.</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#' text_to_duration("03:45")  # Returns 3.75 hours</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#' text_to_duration("12:30")  # Returns 12.5 hours</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>text_to_duration <span class="ot">&lt;-</span> <span class="cf">function</span>(duration) {</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  time_parts <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_split</span>(duration, <span class="st">":"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>  hours <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(time_parts[<span class="dv">1</span>])</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>  minutes <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(time_parts[<span class="dv">2</span>])</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>  duration_hours <span class="ot">&lt;-</span> hours <span class="sc">+</span> minutes <span class="sc">/</span> <span class="dv">6</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>  <span class="fu">return</span>(duration_hours)</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>}</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="fl">3.</span> Once we<span class="st">'ve done this we must rebuild and install our compendium using </span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="st">   "Clean and Install" from the Build panel.</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>Recall that the <code>text_to_duration</code> function converts a
spacewalk duration stored as a string in format “HH:MM” to a duration in
hours - e.g. duration <code>01:15</code> (1 hour and 15 minutes) should
return a numerical value of <code>1.25</code>.</p>
<p>Open <code>R/eva_data_analysis.R</code> in RStudio and click “Source”
to load all of the functions into the R environment.</p>
<p>On the R console, let’s invoke our function with the value
“10:00”:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">text_to_duration</span>(<span class="st">"10:00"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fl">10.0</span></span></code></pre>
</div>
<p>So, we have invoked our function with the value “10:00” and it
returned the floating point value “10” as expected.</p>
<p>We can then further explore the behaviour of our function by
running:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">text_to_duration</span>(<span class="st">"00:00"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fl">0.0</span></span></code></pre>
</div>
<p>This all seems correct so far.</p>
<p>Testing code in this “informal” way in an important process to go
through as we draft our code for the first time. However, there are some
serious drawbacks to this approach if used as our only form of
testing.</p>
<div id="what-are-the-limitations-of-informally-testing-code-5-minutes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="what-are-the-limitations-of-informally-testing-code-5-minutes" class="callout-inner">
<h3 class="callout-title">What are the limitations of informally testing code? (5 minutes)</h3>
<div class="callout-content">
<p>Think about the questions below. Your instructors may ask you to
share your answers in a shared notes document and/or discuss them with
other participants.</p>
<ul>
<li>Why might we choose to test our code informally?</li>
<li>What are the limitations of relying solely on informal tests to
verify that a piece of code is behaving as expected?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>It can be tempting to test our code informally because this
approach:</p>
<ul>
<li>is quick and easy</li>
<li>provides immediate feedback</li>
</ul>
<p>However, there are limitations to this approach:</p>
<ul>
<li>Working interactively is error prone</li>
<li>We must reload our function in R each time we change our code</li>
<li>We must repeat our tests every time we update our code which is time
consuming</li>
<li>We must rely on memory to keep track of how we have tested our code,
e.g. what input values we tried</li>
<li>We must rely on memory to keep track of which functions have been
tested and which have not (informal testing may work well on smaller
pieces of code but it becomes unpractical for a large codebase)</li>
<li>Once we close the R console, we lose all the test scenarios we have
tried</li>
</ul>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="formal-testing">Formal testing<a class="anchor" aria-label="anchor" href="#formal-testing"></a>
</h2>
<hr class="half-width">
<div id="caution1" class="callout caution">
<div class="callout-square">
<i class="callout-icon" data-feather="alert-triangle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Caution</h3>
<div class="callout-content">
<p>The way we setup and store tests in this section is not conventional
for R and is used for teaching purposes to introduce the concept of
testing.</p>
<p>In section “Testing Frameworks”, we cover the conventional way to
write tests in R.</p>
</div>
</div>
</div>
<p>We can overcome some of these limitations by formalising our testing
process. A formal approach to testing our code is to write dedicated
test functions to check it. These test functions:</p>
<ul>
<li>Run the function we want to test - the target function with known
inputs</li>
<li>Compare the output to known, valid results</li>
<li>Raise an error if the function’s actual output does not match the
expected output</li>
<li>Are recorded in a test script that can be re-run on demand.</li>
</ul>
<p>Let’s explore this process by writing some formal tests for our
<code>text_to_duration</code> function.</p>
<p>In RStudio, let’s create a new R file <code>test_code.R</code> in
<code>analysis/scripts</code> to store our tests.</p>
<p>We need to load spacewalks using a <code>library()</code> call so
that we can access text_to_duration` in our test script.</p>
<p>Then, we define our first test function and run it:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">spacewalks</span><span class="op">)</span></span>
<span><span class="va">test_text_to_duration_integer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">input_value</span> <span class="op">&lt;-</span> <span class="st">"10:00"</span></span>
<span>  <span class="va">test_result</span> <span class="op">&lt;-</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">input_value</span><span class="op">)</span> <span class="op">==</span> <span class="fl">10</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="fu">paste</span><span class="op">(</span><span class="st">"text_to_duration('10:00') == 10?"</span>, <span class="va">test_result</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">test_text_to_duration_integer</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>We can run this code with RStudio using the “Source” button or by
running the code in the R console:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">test_text_to_duration_integer</span>()</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"text_to_duration('10:00') == 10? TRUE"</span></span></code></pre>
</div>
<p>This test checks that when we apply <code>text_to_duration</code> to
input value <code>10:00</code>, the output matches the expected value of
<code>10</code>.</p>
<p>In this example, we use a print statement to report whether the
actual output from <code>text_to_duration</code> meets our
expectations.</p>
<p>However, this does not meet our requirement to “Raise an error if the
function’s output does not match the expected output” and means that we
must carefully read our test function’s output to identify whether it
has failed.</p>
<p>To ensure that our code raises an error if the function’s output does
not match the expected output, we using<br>
the <code>expect_true</code> function from the <code>testthat</code>
package.</p>
<p>The <code>expect_true</code> function checks whether a statement is
<code>True</code>. If the statement is <code>True</code>,
<code>expect_true</code> does not return a value and the code continues
to run. However, if the statement is <code>False</code>,
<code>expect_true</code> raises an <code>Error</code>.</p>
<p>Let’s rewrite our test with an <code>expect_true</code>
statement:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">spacewalks</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">testthat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_text_to_duration_integer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">input_value</span> <span class="op">&lt;-</span> <span class="st">"10:00"</span></span>
<span>  <span class="va">test_result</span> <span class="op">&lt;-</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">input_value</span><span class="op">)</span> <span class="op">==</span> <span class="fl">10</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="va">test_result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">test_text_to_duration_integer</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Notice that when we run <code>test_text_to_duration_integer()</code>,
nothing happens - there is no output. That is because our function is
working correctly and returning the expected value of 10.</p>
<p>Let’s add another test to check what happens when duration is not an
integer number and if our function can handle durations with a non-zero
minute component, and rerun our test code.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">spacewalks</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">testthat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_text_to_duration_integer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">input_value</span> <span class="op">&lt;-</span> <span class="st">"10:00"</span></span>
<span>  <span class="va">test_result</span> <span class="op">&lt;-</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">input_value</span><span class="op">)</span> <span class="op">==</span> <span class="fl">10</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="va">test_result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">test_text_to_duration_float</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">input_value</span> <span class="op">&lt;-</span> <span class="st">"10:15"</span></span>
<span>  <span class="va">test_result</span> <span class="op">&lt;-</span> <span class="fu">all.equal</span><span class="op">(</span><span class="fu">text_to_duration</span><span class="op">(</span><span class="va">input_value</span><span class="op">)</span>, <span class="fl">10.25</span><span class="op">)</span> <span class="co">#</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="va">test_result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">test_text_to_duration_float</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">test_text_to_duration_integer</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>&gt; test_text_to_duration_float()
Error: `test_result` is not TRUE

`actual`:   FALSE
`expected`: TRUE</code></pre>
</div>
<p>Notice that this time, our test
<code>test_text_to_duration_float</code> fails. Our
<code>expect_true</code> statement has raised an <code>Error</code> - a
clear signal that there is a problem in our code that we need to
fix.</p>
<p>We know that duration <code>10:15</code> should be converted to
number <code>10.25</code>. What is wrong with our code? If we look at
our <code>text_to_duration</code> function, we may identify the
following line of our code as problematic:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">6</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Recall that our conversion code contains a bug - the minutes
component should have been divided by 60 and not 6. We were able to spot
this tiny bug <strong>only by testing our code</strong> (note that just
by looking at the result graph there is not way to spot incorrect
results).</p>
<p>Let’s fix the problematic line and rerun out tests. To do this we
need to:</p>
<ul>
<li>Navigate to R/eva_data_analysis.R in RStudio</li>
<li>Correct the affected line of code</li>
</ul>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">duration_hours</span> <span class="op">=</span> <span class="fu">int</span><span class="op">(</span><span class="va">hours</span><span class="op">)</span> <span class="op">+</span> <span class="fu">int</span><span class="op">(</span><span class="va">minutes</span><span class="op">)</span><span class="op">/</span><span class="fl">60</span> </span></code></pre>
</div>
<div id="checklist1" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Checklist</h3>
<div class="callout-content">
<p>Remember to “Clean and Install” (Build panel) to make sure that our
changes have been installed.</p>
</div>
</div>
</div>
<p>This time our tests run without problem.</p>
<p>You may have noticed that we have to repeat a lot of code to add each
individual test for each test case. You may also have noticed that our
test script stopped after the first test failure and none of the tests
after that were run.</p>
<p>To run our remaining tests we would have to manually comment out our
failing test and re-run the test script. As our code base grows, testing
in this way becomes cumbersome and error-prone. These limitations can be
overcome by automating our tests using a <strong>testing
framework</strong>.</p>
</section><section><h2 class="section-heading" id="testing-frameworks">Testing frameworks<a class="anchor" aria-label="anchor" href="#testing-frameworks"></a>
</h2>
<hr class="half-width">
<p>Testing frameworks can automatically find all the tests in our code
base, run all of them (so we do not have to invoke them explicitly or,
even worse, forget to invoke them), and present the test results as a
readable summary.</p>
<p>We will use the R testing framework <code>testthat</code> with the
code coverage package <code>covr</code>.</p>
<p>Let’s install these packages and add them to our DESCRIPTION
file.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"testthat"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"covr)</span></span></code></pre>
</div>
<p>DESCRIPTION file</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>Suggests<span class="sc">:</span> </span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="fu">testthat</span> (<span class="sc">&gt;=</span> <span class="dv">3</span>.<span class="fl">0.0</span>),</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  covr,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  ...</span></code></pre>
</div>
<p>Let’s make sure that our tests are ready to work with
<code>testthat</code>.</p>
<ul>
<li>
<p><code>testthat</code> automatically discovers tests based on
specific naming patterns. It looks for files that start with “test_” or
“test-” and end with “.r” or “.R”. Then, within these files,
<code>testthat</code> looks for function calls to “test_that()”. Our
test file already meets these requirements, so there is nothing to do
here. However, our script does contain lines to run each of our test
functions. These are no-longer required as <code>testthat</code> will
run our tests so we can remove them:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Delete these 2 lines</span></span>
<span><span class="fu">test_text_to_duration_float</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">test_text_to_duration_integer</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</li>
<li><p>It is also conventional when working with <code>testthat</code>
to place test files in a <code>tests\testthat</code> directory at the
root of our project and to name each test file after the code file that
it targets. This helps in maintaining a clean structure and makes it
easier for others to understand where the tests are located.</p></li>
<li>
<p>Finally, a standard setup file <code>testthat.R</code> is placed
in the tests folder:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This file is part of the standard setup for testthat.</span></span>
<span><span class="co"># It is recommended that you do not modify it.</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Where should you do additional test configuration?</span></span>
<span><span class="co"># Learn more about the roles of various files in:</span></span>
<span><span class="co"># * https://r-pkgs.org/testing-design.html#sec-tests-files-overview</span></span>
<span><span class="co"># * https://testthat.r-lib.org/articles/special-files.html</span></span>
<span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">testthat</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">spacewalks</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">test_check</span><span class="op">(</span><span class="st">"spacewalks"</span><span class="op">)</span></span></code></pre>
</div>
</li>
</ul>
<p>We can setup the folder structure and setup file manually or by
running the following commands in the R console:</p>
<pre><code><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_testthat</span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>A set of tests for a given piece of code is called a test suite. Our
test suite is currently located in <code>analysis/scripts</code>. Let’s
move it to a conventional test folder <code>tests/testthat</code> and
rename our <code>test-code.R</code> file to
<code>test-eva_data_analysis.R</code>.</p>
<p>You can do this using the file panel in RStudio or by typing the
following commands in the command line terminal:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">mv</span> test-code.R tests/testthat/test-eva_data_analysis.R</span></code></pre>
</div>
<p>Before we re-run our tests using <code>testthat</code>, let’s convert
out test functions to <code>test_that()</code> calls and add some inline
comments to clarify what each test is doing. We will also expand our
syntax to highlight the logic behind our approach:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"text_to_duration returns expected ground truth values</span></span>
<span><span class="st">    for typical durations with a non-zero minute component"</span>, <span class="op">{</span></span>
<span>  <span class="va">actual_result</span> <span class="op">&lt;-</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="st">"10:15"</span><span class="op">)</span></span>
<span>  <span class="va">expected_result</span> <span class="op">&lt;-</span> <span class="fl">10.25</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu">isTRUE</span><span class="op">(</span><span class="fu">all.equal</span><span class="op">(</span><span class="va">actual_result</span><span class="op">)</span>, <span class="va">expected_result</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">test_that</span><span class="op">(</span><span class="st">"text_to_duration returns expected ground truth values</span></span>
<span><span class="st">    for typical whole hour durations"</span>, <span class="op">{</span></span>
<span>  <span class="va">actual_result</span> <span class="op">&lt;-</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="st">"10:00"</span><span class="op">)</span></span>
<span>  <span class="va">expected_result</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="va">actual_result</span><span class="op">==</span><span class="va">expected_result</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Writing our tests this way highlights the key idea that each test
should compare the actual results returned by our function with expected
values.</p>
<p>Similarly, writing inline comments for our tests that complete the
sentence “Test that …” helps us to understand what each test is doing
and why it is needed.</p>
<p>Before running out tests with <code>testthat</code>, let’s
reintroduce our old bug in function <code>text_to_duration</code> that
affects the durations with a non-zero minute component like “10:25” but
not those that are whole hours, e.g. “10:00”:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">6</span> <span class="co"># 6 instead of 60</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Finally, let’s run our tests. We can do this by running the following
command in the R console:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu">test_dir</span><span class="op">(</span><span class="st">"tests/testthat"</span><span class="op">)</span></span></code></pre>
</div>
<p>This runs all of the tests in the <code>tests/testthat</code>
directory and provides a summary of the results.</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>&gt; testthat::test_dir("tests/testthat")
✔ | F W  S  OK | Context
✖ | 1        1 | eva_data_analysis
────────────────────────────────────────────────────────────────────────────────
Error (test-eva_data_analysis.R:5:3): text_to_duration returns expected ground truth values
    for typical durations with a non-zero minute component
Error in `isTRUE(all.equal(actual_result), expected_result)`: unused argument (expected_result)
Backtrace:
    ▆
 1. └─testthat::expect_true(isTRUE(all.equal(actual_result), expected_result)) at test-eva_data_analysis.R:5:3
 2.   └─testthat::quasi_label(enquo(object), label, arg = "object")
 3.     └─rlang::eval_bare(expr, quo_get_env(quo))
────────────────────────────────────────────────────────────────────────────────

══ Results ═════════════════════════════════════════════════════════════════════
── Failed tests ────────────────────────────────────────────────────────────────
Error (test-eva_data_analysis.R:5:3): text_to_duration returns expected ground truth values
    for typical durations with a non-zero minute component
Error in `isTRUE(all.equal(actual_result), expected_result)`: unused argument (expected_result)
Backtrace:
    ▆
 1. └─testthat::expect_true(isTRUE(all.equal(actual_result), expected_result)) at test-eva_data_analysis.R:5:3
 2.   └─testthat::quasi_label(enquo(object), label, arg = "object")
 3.     └─rlang::eval_bare(expr, quo_get_env(quo))

[ FAIL 1 | WARN 0 | SKIP 0 | PASS 1 ]
Error: Test failures</code></pre>
</div>
<p>From the above output from <code>testthats</code>’s execution of out
tests, we notice that:</p>
<ul>
<li>If a test finishes without triggering an error, the test is
considered “OK” and is included in the total count of of successful
tests under the “OK” column.</li>
<li>If a test raises an error, the test is considered a failure with an
<code>F</code> and is included in the total count of of successful tests
under the “OK” column</li>
<li>The output includes details about the error to help identify what
went wrong.</li>
</ul>
<p>Let’s fix our bug once again, reload our compendium
(devtools::load_all()) and rerun our tests using
<code>testthat</code>.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">60</span> </span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div id="checklist2" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Checklist</h3>
<div class="callout-content">
<p>Remember to “Clean and Install” (Build panel) to make sure that our
changes have been installed.</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu">test_dir</span><span class="op">(</span><span class="st">"tests/testthat"</span><span class="op">)</span></span></code></pre>
</div>
<div id="interpreting-testhat-output" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="interpreting-testhat-output" class="callout-inner">
<h3 class="callout-title">Interpreting <code>testhat</code> output</h3>
<div class="callout-content">
<p>A colleague has asked you to conduct a pre-publication review of
their code which analyses time spent in space by various individual
astronauts.</p>
<p>You tested their code using <code>testhat</code>, and got the
following output. Inspect it and answer the questions below.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&gt; testthat::test_dir("tests/testthat")
✔ | F W  S  OK | Context
✖ | 2        4 | analyse
──────────────────────────────────────────────────────────────────────────────────────────────────────────────
Failure (test-analyse.R:7:3): test_total_duration
`actual` (`actual`) not equal to `expected` (`expected`).

  `actual`: 100
`expected`:  10

Error (test-analyse.R:14:3): test_mean_duration
Error in `len(durations)`: could not find function "len"
Backtrace:
    ▆
 1. └─spacetravel:::calculate_mean_duration(durations) at test-analyse.R:14:3
──────────────────────────────────────────────────────────────────────────────────────────────────────────────
✔ |      1    2 | prepare

══ Results ═══════════════════════════════════════════════════════════════════════════════════════════════════
── Failed tests ──────────────────────────────────────────────────────────────────────────────────────────────
Failure (test-analyse.R:7:3): test_total_duration
`actual` (`actual`) not equal to `expected` (`expected`).

  `actual`: 100
`expected`:  10

Error (test-analyse.R:14:3): test_mean_duration
Error in `len(durations)`: could not find function "len"
Backtrace:
    ▆
 1. └─spacetravel:::calculate_mean_duration(durations) at test-analyse.R:14:3

[ FAIL 2 | WARN 0 | SKIP 1 | PASS 6 ]
Error: Test failures</code></pre>
</div>
<ol style="list-style-type: lower-alpha">
<li>How many tests has our colleague included in the test suite?</li>
<li>How many tests failed?</li>
<li>Why did “test_total_duration” fail?</li>
<li>Why did “test_mean_duration” fail?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<ol style="list-style-type: lower-alpha">
<li>9 tests were detected in the test suite</li>
<li>s - stands for “skipped”,</li>
<li>2 tests failed in in test file <code>test_analyse.py</code>
</li>
<li>
<code>test_total_duration</code> failed because the calculated total
duration differs from the expected value by a factor of 10.</li>
<li>
<code>test_mean_duration</code> failed because there is a syntax
error in <code>calculate_mean_duration</code>. Our colleague has used
the command <code>len</code> (not an R command) instead of
<code>length</code>. As a result, running the function returns a
<code>could not find function</code> error rather than a calculated
value and the test fails.</li>
</ol>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="test-suite-design">Test suite design<a class="anchor" aria-label="anchor" href="#test-suite-design"></a>
</h2>
<hr class="half-width">
<p>We now have the tools in place to automatically run tests. However,
that alone is not enough to properly test code. We will now look into
what makes a good test suite and good practices for testing code.</p>
<p>Let’s start by considering the following scenario. A collaborator on
our project has sent us the following function which can be used to add
a new column called <code>crew_size</code> to our data containing the
number of astronauts participating in any given spacewalk. How do we
know that it works as intended and that it will not break the rest of
our code? For this, we need to write a test suite with a comprehensive
coverage of the new code.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#' Calculate the Size of the Crew</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function calculates the number of crew members from a string containing</span></span>
<span><span class="co">#' their names, separated by semicolons. The crew size is determined by counting</span></span>
<span><span class="co">#' the number of crew members listed and subtracting 1 to account for an empty string</span></span>
<span><span class="co">#' at the end of the list.  This function should be applied to a dataframe.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param crew A character string containing the names of crew members, separated by semicolons.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return An integer representing the size of the crew (the number of crew members).</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' calculate_crew_size("John Doe;Jane Doe;")  # Returns 2</span></span>
<span><span class="co">#' calculate_crew_size("John Doe;")  # Returns 1</span></span>
<span><span class="va">calculate_crew_size</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">crew</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Use purrr::map_int to iterate over each crew element and return an integer vector</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">map_int</span><span class="op">(</span><span class="va">crew</span>, <span class="kw">function</span><span class="op">(</span><span class="va">c</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">trimmed_crew</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_trim</span><span class="op">(</span><span class="va">c</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">trimmed_crew</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">return</span><span class="op">(</span><span class="cn">NA_integer_</span><span class="op">)</span>  <span class="co"># Return NA as an integer (NA_integer_)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">crew_list</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_split</span><span class="op">(</span><span class="va">c</span>, <span class="st">";"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="kw">return</span><span class="op">(</span><span class="fu">length</span><span class="op">(</span><span class="va">crew_list</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>  <span class="co"># Return the number of crew members (excluding the last empty string)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span>    </span></code></pre>
</div>
<p>Let’s add this function to <code>R/eva_data_analysis.R</code> and
update <code>analysis/run_data_analysis.R</code> to include it.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>run_analysis <span class="ot">&lt;-</span> <span class="cf">function</span>(input_file, output_file, graph_file) {</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"--START--</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>  eva_data <span class="ot">&lt;-</span> <span class="fu">read_json_to_dataframe</span>(input_file)</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>  </span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>  eva_data <span class="ot">&lt;-</span> eva_data <span class="sc">|&gt;</span> <span class="co"># Add this line</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">crew_size =</span> <span class="fu">calculate_crew_size</span>(crew)) <span class="co"># Add this line</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>  <span class="fu">write_dataframe_to_csv</span>(eva_data, output_file) <span class="co"># Add this line</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>  <span class="fu">plot_cumulative_time_in_space</span>(eva_data, graph_file)</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>  <span class="fu">generate_summary_table</span>(eva_data, <span class="st">"crew_size"</span>, <span class="st">"analysis/tables/summary_table.html"</span>)</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"--END--</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>}</span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a><span class="sc">:::</span> checklist</span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>Remember to <span class="st">"Clean and Install"</span> (Build panel) to make sure that our changes have been installed.</span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a><span class="sc">:::</span></span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a></span></code></pre>
</div>
<div class="section level3">
<h3 id="writing-good-tests">Writing good tests<a class="anchor" aria-label="anchor" href="#writing-good-tests"></a>
</h3>
<p>The aim of writing good tests is to verify that each of our functions
behaves as expected with the full range of inputs that it might
encounter. It is helpful to consider each argument of a function in turn
and identify the range of typical values it can take. Once we have
identified this typical range or ranges (where a function takes more
than one argument), we should:</p>
<ul>
<li>Test all values at the edge of the range</li>
<li>Test at least one interior point</li>
<li>Test invalid values</li>
</ul>
<p>Let’s have a look at the <code>calculate_crew_size</code> function
from our colleague’s new code and write some tests for it.</p>
<div id="unit-tests-for-calculate_crew_size" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="unit-tests-for-calculate_crew_size" class="callout-inner">
<h3 class="callout-title">Unit tests for calculate_crew_size</h3>
<div class="callout-content">
<p>Implement unit tests for the <code>calculate_crew_size</code>
function. Cover typical cases and edge cases.</p>
<p>Hint - use the following template when writing tests:</p>
<pre><code>test_that("MYFUNCTION ...", {
    """
    Test that ...   #FIXME
    """

    # Typical value 1
    actual_result &lt;-  _______________ #FIXME
    expected_result &lt;- ______________ #FIXME
    expect_equal(actual_result == expected_result, tolerance = 1e-6)

    # Typical value 2
    actual_result &lt;-  _______________ #FIXME
    expected_result &lt;- ______________ #FIXME
    expect_equal(actual_result == expected_result, tolerance = 1e-6)
}</code></pre>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>We can add the following test functions to out test suite.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">test_that</span><span class="op">(</span><span class="st">"calculate_crew_size returns correct values for typical crew inputs"</span>, <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># First test case</span></span>
<span>  <span class="va">actual_result_1</span> <span class="op">&lt;-</span> <span class="fu">calculate_crew_size</span><span class="op">(</span><span class="st">"Valentina Tereshkova;"</span><span class="op">)</span></span>
<span>  <span class="va">expected_result_1</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">actual_result_1</span>, <span class="va">expected_result_1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Second test case</span></span>
<span>  <span class="va">actual_result_2</span> <span class="op">&lt;-</span> <span class="fu">calculate_crew_size</span><span class="op">(</span><span class="st">"Judith Resnik; Sally Ride;"</span><span class="op">)</span></span>
<span>  <span class="va">expected_result_2</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">actual_result_2</span>, <span class="va">expected_result_2</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Edge cases</span></span>
<span><span class="fu">test_that</span><span class="op">(</span><span class="st">"calculate_crew_size returns expected value for an empty crew string"</span>, <span class="op">{</span></span>
<span>  <span class="va">actual_result</span> <span class="op">&lt;-</span> <span class="fu">calculate_crew_size</span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu">is.na</span><span class="op">(</span><span class="va">actual_result</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s run out tests:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu">test_dir</span><span class="op">(</span><span class="st">"tests/testthat"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&gt; testthat::test_dir("tests/testthat")
✔ | F W  S  OK | Context
✔ |          5 | eva_data_analysis

══ Results ═══════════════════════════════════════════════════════════════════════════════════════════════════
[ FAIL 0 | WARN 0 | SKIP 0 | PASS 5 ]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="just-enough-tests">Just enough tests<a class="anchor" aria-label="anchor" href="#just-enough-tests"></a>
</h3>
<p>In this episode, so far we have (only) written tests for two
individual functions: <code>text_to_duration</code> and
<code>calculate_crew_size</code>.</p>
<p>We can quantify the proportion of our code base that is run (also
referred to as “exercised”) by a given test suite using a metric called
code coverage:</p>
<p><span class="math display">\[ \text{Line Coverage} = \left(
\frac{\text{Number of Executed Lines}}{\text{Total Number of Executable
Lines}} \right) \times 100 \]</span></p>
<p>We can calculate our test coverage using the <code>covr</code>
package as follows.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"covr"</span><span class="op">)</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"DT"</span><span class="op">)</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"htmltools"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">covr</span><span class="op">)</span></span>
<span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu">package_coverage</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&gt; coverage
spacewalks Coverage: 40.00%
R/eva_data_analysis.R: 40.00%</code></pre>
</div>
<p>To get an in-depth report about which parts of our code are tested
and which are not , we can run:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">covr</span><span class="fu">::</span><span class="fu">report</span><span class="op">(</span><span class="va">coverage</span><span class="op">)</span></span></code></pre>
</div>
<p>This option generates a report in the RStudio viewer. This provides
structured information about our test coverage including:</p>
<ul>
<li>a table showing the proportion of lines in each file that are
currently tested, and</li>
<li>an annotated copy of our code where untested lines are highlighted
in red.</li>
</ul>
<p>Ideally, all the lines of code in our code base should be exercised
by at least one test. However, if we lack the time and resources to test
every line of our code we should:</p>
<ul>
<li>avoid testing R’s built-in functions or functions imported from
well-known and well-tested libraries like <code>dplyr</code> or
<code>ggplot2</code>.</li>
<li>focus on the the parts of our code that carry the greatest
“reputational risk”, i.e. that could affect the accuracy of our reported
results.</li>
</ul>
<div id="callout3" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Test coverage of less than 100% indicates that more testing may be
helpful.</p>
<p>Test coverage of 100% does not mean that our code is bug-free.</p>
</div>
</div>
</div>
<div id="evaluating-code-coverage" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="evaluating-code-coverage" class="callout-inner">
<h3 class="callout-title">Evaluating code coverage</h3>
<div class="callout-content">
<p>Generate the code coverage report for your compendium using the
<code>covr::report(coverage)</code> command.</p>
<p>Inspect the report generated and extract the following
information:</p>
<ol style="list-style-type: lower-alpha">
<li>What proportion of the code base is currently “not” exercised by the
test suite?</li>
<li>Which functions in our code base are currently untested?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<ol style="list-style-type: lower-alpha">
<li>The proportion of the code base NOT covered by our tests is ~60%
(100% - 40%) - this may differ for your version of the code.</li>
<li>You can find this information by checking which functions in the
annotated source code section of the report contain red (untested)
lines. The following functions in our code base are currently untested:
<ul>
<li>read_json_to_dataframe</li>
<li>write_dataframe_to_csv</li>
<li>add_duration_hours_variable</li>
<li>plot_cumulative_time_in_space</li>
<li>add_crew_size_variable</li>
</ul>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<p>During this episode, we have covered how to use tests to verify the
correctness of our code. We have seen how to write a unit test, how to
manage and run our tests using the <code>testthat</code> framework and
how to identify which parts of our code require additional testing using
test coverage reports.</p>
<p>These skills reduce the probability that there will be a mistake in
our code and support reproducible research by giving us the confidence
to engage in open research practices. Tests also document the intended
behaviour of our code for other developers and mean that we can
experiment with changes to our code knowing that our tests will let us
know if we break any existing functionality.</p>
</section><section><h2 class="section-heading" id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<hr class="half-width">
<p>We recommend the following resources for some additional reading on
the topic of this episode:</p>
<ul>
<li>
<a href="https://r-pkgs.org/testing-basics.html" class="external-link">Testing basics</a>
from Wickham, H., &amp; Bryan, J. (2023). R Packages. O’Reilly</li>
<li><a href="https://testthat.r-lib.org/" class="external-link">Testthat package
documentation</a></li>
</ul>
<p>Also check the <a href="reference.html#litref">full reference set</a>
for the course.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<p>1 . Code testing supports reproducibility by demonstrating that your
code behaves as you expect and consistently generates the same output
with a given set of inputs. 2. Unit testing is crucial as it ensures
each functions works correctly. 3. Using the <code>testthat</code>
package you can write basic unit tests for R functions to verify their
correctness. 4. Identifying and handling edge cases in unit tests is
essential to ensure your code performs correctly under a variety of
conditions. 5. Test coverage can help you to identify parts of your code
that require additional testing.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="attribution">Attribution<a class="anchor" aria-label="anchor" href="#attribution"></a>
</h2>
<hr class="half-width">
<p>This episode reuses material from the <a href="https://carpentries-incubator.github.io/fair-research-software/09-code-documentation.html" class="external-link">“Code
Correctness”</a> episode of the Software Carpentries Incubator course <a href="https://carpentries-incubator.github.io/fair-research-software/" class="external-link">“Tools
and practices of FAIR research software”</a> under a <a href="https://creativecommons.org/licenses/by/4.0/deed.en" class="external-link">CC-BY-4.0</a>
with modifications (i) adaptations have been made to make the material
suitable for an audience of R users (e.g. replacing “software” with
“code” in places, pytest with testthat), (ii) all code has been ported
from Python to R (iii) Objectives, Questions, Key Points and Further
Reading sections have been updated to reflect the remixed R focussed
content.</p>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
<!--
Fair research software
 -->
<!--
Good Practices
 -->
<!---
Project Structure
--->
<!-------
Code Correctness
---->
<!--
Attribution
-->
</section></section><section id="aio-07-code-environment"><p>Content from <a href="07-code-environment.html">Reproducible development environment</a></p>
<hr>
<p>Last updated on 2025-03-12 |

        <a href="https://github.com/kkh451/r_reproducibility/edit/main/episodes/07-code-environment.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can we manage R dependencies in our analysis projects?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to:</p>
<ul>
<li>Set up a local package library for an R project using
<code>renv</code>.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="our-code-has-dependencies-1">Our code has dependencies <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
<a class="anchor" aria-label="anchor" href="#our-code-has-dependencies-1"></a>
</h2>
<hr class="half-width">
<p>Now that we’ve finished developing out project, let’s take a look
back at our code.</p>
<p>If we have a look at <code>analysis/scripts.R</code>, we can see a
number of library() calls at the top of the file:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">spacewalks2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="va">etc.</span></span></code></pre>
</div>
<p>Similarly, if we have a look at our script
<code>R/eva_data_analysis.R</code>, we can see a number of functions
from external packages being used including <code>dplyr::mutate</code>
and <code>ggplot2::ggplot</code>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">tdf</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Add duration_hours column</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>     <span class="co"># Calculate cumulative time</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">labs</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span></span>
<span>    <span class="op">)</span></span></code></pre>
</div>
<p>This means that our code requires several <strong>external
libraries</strong> (also called third-party packages or dependencies) -
<code>jsonlite</code>, <code>readr</code>, <code>dplyr</code>,
<code>stringr</code>, <code>tidyr</code> etc.</p>
</section><section><h2 class="section-heading" id="managing-dependencies-2">Managing dependencies <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>
<a class="anchor" aria-label="anchor" href="#managing-dependencies-2"></a>
</h2>
<hr class="half-width">
<p>One of the most important aspects of reproducible research is
managing dependencies.</p>
<p>For your analysis to run, it interacts with:</p>
<ul>
<li><p><strong>Operating system:</strong> The operating system of your
computer.</p></li>
<li><p><strong>System configurations</strong>: such as locations of
libraries and the search path your computer uses to find files and
libraries</p></li>
<li><p><strong>System Level libraries</strong>. These are non-R
libraries that R or packages in R you might be using depend on. (for
example libraries such as <code>GEOS</code>, <code>GDAL</code> and
<code>PROJ4</code> that geospatial R packages like <code>sf</code> and
<code>rgeos</code> depend on). Such external dependencies to R are
listed as <code>System Requirements</code> in R package
<code>DESCRIPTION</code> files (e.g have a look at the <a href="https://github.com/r-spatial/sf/blob/adf7410a5c55695b4c8db97a5258ec87c931320a/DESCRIPTION#L110" class="external-link">relevant
line</a> in the <code>sf</code> package
<code>DESCRIPTION</code>.</p></li>
<li><p><strong>R and the R packages your analysis depends on</strong>.
For example, the version of R we’ve been using as well as packages
<code>ggplot2</code> and <code>dplyr</code>.</p></li>
</ul>
<p>When someone else tries to reproduce your analysis on a different
computer, if any of these elements differ from what existed on your own
system when you last ran your analysis, e.g some of the dependencies are
missing, different versions are available or code behaves differently on
a different operating system, they may not be able to reproduce your
work.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>It is essential to document the specific package versions used in a
project and to offer a way for others to install those exact versions on
their own machines. The renv package addresses both of these needs
effectively.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="managing-r-dependencies-with-renv-2">Managing R dependencies with <code>renv</code> <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>
<a class="anchor" aria-label="anchor" href="#managing-r-dependencies-with-renv-2"></a>
</h2>
<hr class="half-width">
<p>The <code>renv</code> package is a recent effort to bring
project-local R dependency management to R projects.</p>
<p>Underlying the philosophy of <code>renv</code> is that any of your
existing workflows should just work as they did before –
<code>renv</code> helps manage library paths (and other project-specific
state) to help isolate your project’s R dependencies.</p>
<div class="section level3">
<h3 id="renv-workflow">
<code>renv</code> Workflow<a class="anchor" aria-label="anchor" href="#renv-workflow"></a>
</h3>
<p>The general workflow when working with <code>renv</code> is:</p>
<ol style="list-style-type: decimal">
<li><p>Call <code>renv::init()</code> to initialize a new project-local
environment with a <strong>private R library</strong>,</p></li>
<li><p>Work in the project as normal, installing and removing new R
packages as they are needed in the project,</p></li>
<li><p>Call <code>renv::snapshot()</code> to save the state of the
project library to the lockfile (called
<code>renv.lock</code>),</p></li>
<li><p>Continue working on your project, installing and updating R
packages as needed.</p></li>
<li><p>Call <code>renv::snapshot()</code> again to save the state of
your project library if your attempts to update R packages were
successful, or call <code>renv::restore()</code> to revert to the
previous state as encoded in the lockfile if your attempts to update
packages introduced some new problems.</p></li>
</ol>
<p>The <code>renv::init()</code> function attempts to ensure the
newly-created project library includes all R packages currently used by
the project. It does this by crawling R files within the project for
dependencies with the <code>renv::dependencies()</code> function. The
discovered packages are then installed into the project library with the
<code>renv::hydrate()</code> function, which will also attempt to save
time by copying packages from your user library (rather than
re-installing from CRAN) as appropriate.</p>
<p>Calling <code>renv::init()</code> will also write out the
infrastructure necessary to automatically load and use the private
library for new R sessions launched from the project root directory.
This is accomplished by creating (or amending) a project-local
<code>.Rprofile</code> with the necessary code to load the project when
the R session is started.</p>
<p>The following files are written to and used by projects using
<code>renv</code>:</p>
<table class="table">
<colgroup>
<col width="17%">
<col width="83%">
</colgroup>
<thead><tr class="header">
<th><strong>File</strong></th>
<th><strong>Usage</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>.Rprofile</code></td>
<td>Used to activate <code>renv</code> for new R sessions launched in
the project.</td>
</tr>
<tr class="even">
<td><code>renv.lock</code></td>
<td>The lockfile, describing the state of your project’s library at some
point in time.</td>
</tr>
<tr class="odd">
<td><code>renv/activate.R</code></td>
<td>The activation script run by the project
<code>.Rprofile</code>.</td>
</tr>
<tr class="even">
<td><code>renv/library</code></td>
<td>The private project library.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="reproducibility-with-renv">Reproducibility with <code>renv</code>
<a class="anchor" aria-label="anchor" href="#reproducibility-with-renv"></a>
</h3>
<p>Using <code>renv</code>, it’s possible to “save” and “load” the state
of your project library. More specifically, you can use:</p>
<ul>
<li>
<code>renv::snapshot()</code> to save the state of your project to
<code>renv.lock</code>; and</li>
<li>
<code>renv::restore()</code> to restore the state of your project
from <code>renv.lock</code>.</li>
</ul>
<p>For each package used in your project, <code>renv</code> will record
the package version, and (if known) the external source from which that
package can be retrieved. <code>renv::restore()</code> uses that
information to retrieve and re-install those packages in your
project.</p>
<div id="beyond-the-description-file-3" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="beyond-the-description-file-3" class="callout-inner">
<h3 class="callout-title">Beyond the DESCRIPTION file <a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>
</h3>
<div class="callout-content">
<p>So far we have been using the <code>DESCRIPTION</code> file to record
the dependencies of our research compendium. This file contains a list
of all of the direct dependencies of our research compendium. If we were
to share our research compendium with someone else, they could install
these dependencies by running devtools_install().</p>
<p>However, this approach has some limitations:</p>
<ul>
<li>We’ve had to manually track the dependencies of our analysis scripts
and their versions.</li>
<li>By default devtools_install() will install the dependencies into the
users global R library, not into a project-specific library. This makes
it challenging to work with multiple research compendia that may require
different versions of the same package</li>
<li>
<code>DESCRIPTION</code> file only records the direct dependencies
of our code - not the transitive dependencies (the dependencies of our
dependencies) .</li>
</ul>
<p>renv helps to ensure that our R project can be reproduced by:</p>
<ul>
<li>providing tools to automatically identify the dependencies of our
compendium.</li>
<li>logging the exact versions of our both direct AND transitive
dependencies.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="using-renv-in-our-spacewalks-project">Using <code>renv</code> in our <code>spacewalks</code> project<a class="anchor" aria-label="anchor" href="#using-renv-in-our-spacewalks-project"></a>
</h3>
<p>Let’s go back into our <code>spacewalks</code> compendium and capture
our dependencies into a project level R package library.</p>
<p>First, let’s configure the install location that renv will use to
<code>renv/library</code> using a .REnviron file.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">TXT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode txt" tabindex="0"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a># .REnviron</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>RENV_PATHS_LIBRARY = renv/library</span></code></pre>
</div>
<p>Then, we can initialise <code>renv</code></p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">renv</span><span class="fu">::</span><span class="fu">init</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&gt; renv::init()
This project contains a DESCRIPTION file.
Which files should renv use for dependency discovery in this project?

1: Use only the DESCRIPTION file. (explicit mode)
2: Use all files in this project. (implicit mode)

Selection: 2
</code></pre>
</div>
<p>We are presented with two options for automatic discover of our
compendium’s dependencies. “explicit mode” uses only the DESCRIPTION
file, while “implicit mode” scans all the files in our project for
dependencies.</p>
<p>We are Choose “2” to use all files in the project for dependency
discovery.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
- Using 'implicit' snapshot type. Please see `?renv::snapshot` for more details.

- Linking packages into the project library ... Done!
- Resolving missing dependencies ...
# Installing packages --------------------------------------------------------
- Installing magrittr ...                       OK [linked from cache]
- Installing dplyr ...                          OK [linked from cache]
- Installing ggplot2 ...                        OK [linked from cache]
- Installing here ...                           OK [linked from cache]
- Installing jsonlite ...                       OK [linked from cache]
- Installing xfun ...                           OK [linked from cache]
- Installing highr ...                          OK [linked from cache]
- Installing knitr ...                          OK [linked from cache]
- Installing purrr ...                          OK [linked from cache]
- Installing readr ...                          OK [linked from cache]
- Installing rmarkdown ...                      OK [linked from cache]
- Installing stringr ...                        OK [linked from cache]
- Installing evaluate ...                       OK [linked from cache]
- Installing withr ...                          OK [linked from cache]
- Installing waldo ...                          OK [linked from cache]
- Installing testthat ...                       OK [linked from cache]
- Installing tidyr ...                          OK [linked from cache]
- Installing roxygen2 ...                       OK [linked from cache]
- Installing devtools ...                       OK [linked from cache]
The following package(s) will be updated in the lockfile:

# CRAN -----------------------------------------------------------------------
- askpass        [* -&gt; 1.2.0]
- base64enc      [* -&gt; 0.1-3]
- bit            [* -&gt; 4.0.5]
- bit64          [* -&gt; 4.0.5]
- brew           [* -&gt; 1.0-10]
- brio           [* -&gt; 1.1.4]
- bslib          [* -&gt; 0.7.0]
- cachem         [* -&gt; 1.0.8]
- callr          [* -&gt; 3.7.6]
- cli            [* -&gt; 3.6.2]
- clipr          [* -&gt; 0.8.0]
- colorspace     [* -&gt; 2.1-0]
- commonmark     [* -&gt; 1.9.1]
- conflicted     [* -&gt; 1.2.0]
- cpp11          [* -&gt; 0.4.7]
- crayon         [* -&gt; 1.5.2]
- credentials    [* -&gt; 2.0.1]
- desc           [* -&gt; 1.4.3]
- devtools       [* -&gt; 2.4.5]
- diffobj        [* -&gt; 0.3.5]
- digest         [* -&gt; 0.6.35]
- downlit        [* -&gt; 0.4.3]
- dplyr          [* -&gt; 1.1.4]
- ellipsis       [* -&gt; 0.3.2]
- evaluate       [* -&gt; 1.0.3]
- fansi          [* -&gt; 1.0.6]
- farver         [* -&gt; 2.1.1]
- fastmap        [* -&gt; 1.1.1]
- fontawesome    [* -&gt; 0.5.2]
- fs             [* -&gt; 1.6.3]
- generics       [* -&gt; 0.1.3]
- gert           [* -&gt; 2.0.1]
- ggplot2        [* -&gt; 3.5.1]
- gh             [* -&gt; 1.4.1]
- git2r          [* -&gt; 0.35.0]
- gitcreds       [* -&gt; 0.1.2]
- glue           [* -&gt; 1.7.0]
- gtable         [* -&gt; 0.3.4]
- here           [* -&gt; 1.0.1]
- highr          [* -&gt; 0.11]
- hms            [* -&gt; 1.1.3]
- htmltools      [* -&gt; 0.5.8.1]
- htmlwidgets    [* -&gt; 1.6.4]
- httpuv         [* -&gt; 1.6.15]
- httr           [* -&gt; 1.4.7]
- httr2          [* -&gt; 1.0.1]
- ini            [* -&gt; 0.3.1]
- isoband        [* -&gt; 0.2.7]
- jquerylib      [* -&gt; 0.1.4]
- jsonlite       [* -&gt; 1.9.0]
- knitr          [* -&gt; 1.49]
- labeling       [* -&gt; 0.4.3]
- later          [* -&gt; 1.3.2]
- lattice        [* -&gt; 0.22-5]
- lifecycle      [* -&gt; 1.0.4]
- magrittr       [* -&gt; 2.0.3]
- MASS           [* -&gt; 7.3-60.0.1]
- Matrix         [* -&gt; 1.6-5]
- memoise        [* -&gt; 2.0.1]
- mgcv           [* -&gt; 1.9-1]
- mime           [* -&gt; 0.12]
- miniUI         [* -&gt; 0.1.1.1]
- munsell        [* -&gt; 0.5.1]
- nlme           [* -&gt; 3.1-164]
- pillar         [* -&gt; 1.9.0]
- pkgbuild       [* -&gt; 1.4.4]
- pkgconfig      [* -&gt; 2.0.3]
- pkgdown        [* -&gt; 2.0.7]
- pkgload        [* -&gt; 1.3.4]
- praise         [* -&gt; 1.0.0]
- prettyunits    [* -&gt; 1.2.0]
- processx       [* -&gt; 3.8.4]
- profvis        [* -&gt; 0.3.8]
- progress       [* -&gt; 1.2.3]
- promises       [* -&gt; 1.2.1]
- ps             [* -&gt; 1.7.6]
- purrr          [* -&gt; 1.0.4]
- R6             [* -&gt; 2.5.1]
- rappdirs       [* -&gt; 0.3.3]
- rcmdcheck      [* -&gt; 1.4.0]
- RColorBrewer   [* -&gt; 1.1-3]
- Rcpp           [* -&gt; 1.0.12]
- readr          [* -&gt; 2.1.5]
- remotes        [* -&gt; 2.5.0]
- renv           [* -&gt; 1.0.5]
- rlang          [* -&gt; 1.1.3]
- rmarkdown      [* -&gt; 2.29]
- roxygen2       [* -&gt; 7.3.2]
- rprojroot      [* -&gt; 2.0.4]
- rstudioapi     [* -&gt; 0.16.0]
- rversions      [* -&gt; 2.1.2]
- sass           [* -&gt; 0.4.9]
- scales         [* -&gt; 1.3.0]
- sessioninfo    [* -&gt; 1.2.2]
- shiny          [* -&gt; 1.8.1.1]
- sourcetools    [* -&gt; 0.1.7-1]
- stringi        [* -&gt; 1.8.3]
- stringr        [* -&gt; 1.5.1]
- sys            [* -&gt; 3.4.2]
- testthat       [* -&gt; 3.2.3]
- tibble         [* -&gt; 3.2.1]
- tidyr          [* -&gt; 1.3.1]
- tidyselect     [* -&gt; 1.2.1]
- tinytex        [* -&gt; 0.50]
- tzdb           [* -&gt; 0.4.0]
- urlchecker     [* -&gt; 1.0.1]
- usethis        [* -&gt; 2.2.3]
- utf8           [* -&gt; 1.2.4]
- vctrs          [* -&gt; 0.6.5]
- viridisLite    [* -&gt; 0.4.2]
- vroom          [* -&gt; 1.6.5]
- waldo          [* -&gt; 0.6.1]
- whisker        [* -&gt; 0.4.1]
- withr          [* -&gt; 3.0.2]
- xfun           [* -&gt; 0.51]
- xopen          [* -&gt; 1.0.1]
- xtable         [* -&gt; 1.8-4]
- yaml           [* -&gt; 2.3.8]
- zip            [* -&gt; 2.3.1]

# https://carpentries.r-universe.dev -----------------------------------------
- curl           [* -&gt; 5.2.1]
- openssl        [* -&gt; 2.1.1]
- ragg           [* -&gt; 1.3.0]
- systemfonts    [* -&gt; 1.0.6]
- textshaping    [* -&gt; 0.3.7]
- xml2           [* -&gt; 1.3.6]

The version of R recorded in the lockfile will be updated:
- R              [* -&gt; 4.3.3]

- Lockfile written to "~/projects/uob/astronaut-data-analysis-fair-r/spacewalks/renv.lock".

Restarting R session...

- Project '~/projects/uob/astronaut-data-analysis-fair-r/spacewalks' loaded. [renv 1.0.5]</code></pre>
</div>
<p>Alongside our existing content, our compendium now also contains the
infrastructure that powers <code>renv</code> dependency management:</p>
<pre><code>.
├── .Rprofile
├── renv
│   ├── .gitignore
│   ├── activate.R
│   ├── settings.json
│   └── library
│       └── R-4.3
└── renv.lock</code></pre>
<p>The <code>renv.lock</code> contains a list of names and versions of
packages used in our project.</p>
<p>The folder <code>renv/library/R-4.3</code> contains the project
specific library of installed packages for the R version the analysis is
currently being performed on. This is never shared with recipients of
our compendium. Rather, we share the rest of the files
(<code>renv.lock</code> file, the <code>.Rprofile</code> file and the
<code>renv/activate.R</code>). Making these available means others users
of your code will have the appropriate packages installed in their own
local library when the download and use your code.</p>
<p>Once we have run <code>renv::init()</code>, we should run
renv::status() to check the status of our project library.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">renv</span><span class="fu">::</span><span class="fu">status</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>No issues found -- the project is in a consistent state.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>No issues found -- the project is in a consistent state.</code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="restoring-an-environment-4">Restoring an Environment <a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>
<a class="anchor" aria-label="anchor" href="#restoring-an-environment-4"></a>
</h2>
<hr class="half-width">
<p>Anyone who wants to install the same packages that we use with their
exact versions can download our code, open the compendium and use
<code>renv::restore()</code>.</p>
<p>This will install everything in their local project library so they
can be up an running in no time.</p>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Restore an environment <a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></p>
<ol style="list-style-type: decimal">
<li><p>Download this <a href="https://reproducibility.rocks/reproducible_project.zip" class="external-link">reproducible
project</a>.</p></li>
<li><p>(Due to a recent issue with RStudio, you might need to press
Enter before continuing).</p></li>
<li><p>Open the project and run <code>renv::status()</code> in the R
console. What’s the status of the packages?</p></li>
<li><p>Run <code>renv::restore()</code> in the R console and
proceed.</p></li>
<li><p>Run <code>renv::status()</code> again to check that the project
is in a consistent state.</p></li>
<li><p>Render <code>analysis/report.Rmd</code> to make sure that it
worked.</p></li>
</ol>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="updating-an-environment">Updating an Environment<a class="anchor" aria-label="anchor" href="#updating-an-environment"></a>
</h2>
<hr class="half-width">
<p>If we continue working on our project and add some new functionality
that uses a new dependency we will need to update out DESCRIPTION file,
our renv.lock file and our project library renv/library.</p>
<p>Let’s add a new function to R/eva_data_analysis.R that tabulates crew
sizes in our spacewalks data.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generate_summary_table</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">column_name</span>, <span class="va">output_file</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Check if the column exists in the data</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">column_name</span> <span class="op">%in%</span> <span class="fu">colnames</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">stop</span><span class="op">(</span><span class="st">"Column not found in the data frame"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Create summary statistics table using gtsummary</span></span>
<span>  <span class="va">summary_table</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">column_name</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gtsummary</span><span class="fu">::</span><span class="fu">tbl_summary</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Save the summary table to the specified output file</span></span>
<span>  <span class="fu">gtsummary</span><span class="fu">::</span><span class="fu">as_gt</span><span class="op">(</span><span class="va">summary_table</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu">gtsave</span><span class="op">(</span><span class="va">output_file</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">cat</span><span class="op">(</span><span class="st">"Summary table saved to"</span>, <span class="va">output_file</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>This uses the tabulate package <code>gtsummary</code>.</p>
<p>Let’s add the new function to <code>R/eva_data_analysis.R</code> and
add the following lines to analysis/scripts/run_analysis.R to call the
function and save the result:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">generate_summary_table</span><span class="op">(</span><span class="va">eva_data</span>, <span class="st">"crew_size"</span>, <span class="st">"summary_table.html"</span><span class="op">)</span></span></code></pre>
</div>
<div id="checklist1" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Checklist</h3>
<div class="callout-content">
<p>Remember to “Clean and Install” (Build panel) to make sure that our
changes have been installed.</p>
</div>
</div>
</div>
<p>When we run <code>analysis/scripts/run_analysis.R</code> we see an
error because <code>gtsummary</code> is not installed in out local
project library.</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>- The project is out-of-sync -- use `renv::status()` for details.
[conflicted] Will prefer dplyr::filter over any other package.
[conflicted] Will prefer dplyr::lag over any other package.
Error in library(package, pos = pos, lib.loc = lib.loc, character.only = TRUE,  :
  there is no package called ‘spacewalks’
Calls: library -&gt; library
Execution halted</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code></code></pre>
</div>
<p>Before we install gtsummary let’s run <code>renv::status()</code> to
check the status of our current project dependencies.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">renv</span><span class="fu">::</span><span class="fu">status</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>No issues found -- the project is in a consistent state.</code></pre>
</div>
<p>Now let’s install out missing dependency in the console and rerun
<code>analysis/scripts/run_analysis.R</code> to check that everything is
running correctly.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">install.packages</span>(<span class="st">"gtsummary"</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># Downloading packages -------------------------------------------------------
- Downloading gtsummary from CRAN ...           OK [1.6 Mb in 1.5s]
- Downloading cards from CRAN ...               OK [523.8 Kb in 1.3s]
- Downloading gt from CRAN ...                  OK [5.7 Mb in 1.8s]
- Downloading bigD from CRAN ...                OK [1.1 Mb in 1.3s]
- Downloading bitops from CRAN ...              OK [24.8 Kb in 0.81s]
- Downloading juicyjuice from CRAN ...          OK [1.1 Mb in 1.3s]
- Downloading V8 from CRAN ...                  OK [8.4 Mb in 2.2s]
- Downloading markdown from CRAN ...            OK [142.2 Kb in 0.82s]
- Downloading reactable from CRAN ...           OK [1 Mb in 1.0s]
- Downloading reactR from CRAN ...              OK [594.8 Kb in 0.89s]
Successfully downloaded 10 packages in 17 seconds.

The following package(s) will be installed:
- bigD       [0.3.0]
- bitops     [1.0-9]
- cards      [0.5.0]
- gt         [0.11.1]
- gtsummary  [2.1.0]
- juicyjuice [0.1.0]
- markdown   [1.13]
- reactable  [0.4.4]
- reactR     [0.6.1]
- V8         [6.0.1]
These packages will be installed into "~/projects/uob/astronaut-data-analysis-fair-r/spacewalks/renv/library/R-4.3/aarch64-apple-darwin20".
Would you like to proceed? [Y/n]: Y</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># Installing packages --------------------------------------------------------
- Installing cards ...                          OK [installed binary and cached in 0.29s]
- Installing bigD ...                           OK [installed binary and cached in 0.29s]
- Installing bitops ...                         OK [installed binary and cached in 0.23s]
- Installing V8 ...                             OK [installed binary and cached in 0.5s]
- Installing juicyjuice ...                     OK [installed binary and cached in 0.28s]
- Installing markdown ...                       OK [installed binary and cached in 0.31s]
- Installing reactR ...                         OK [installed binary and cached in 0.32s]
- Installing reactable ...                      OK [installed binary and cached in 0.29s]
- Installing gt ...                             OK [installed binary and cached in 0.32s]
- Installing gtsummary ...                      OK [installed binary and cached in 0.28s]
Successfully installed 10 packages in 3.5 seconds.</code></pre>
</div>
<p>Now let’s run renv::status() in the console:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="sc">&gt;</span> renv<span class="sc">::</span><span class="fu">status</span>()</span></code></pre>
</div>
<p>The following package(s) are in an inconsistent state:</p>
<p>package installed recorded used bigD y n y<br>
bitops y n y<br>
cards y n y<br>
gt y n y<br>
gtsummary y n y<br>
juicyjuice y n y<br>
markdown y n y<br>
reactable y n y<br>
reactR y n y<br>
V8 y n y</p>
<p>See ?renv::status() for advice on resolving these issues.</p>
<pre><code>
Now let's run renv::snapshot() in the console.
```r
renv::snapshot()</code></pre>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>The following package(s) will be updated in the lockfile:

# CRAN ----------------------------------------------------------------------
- bigD         [* -&gt; 0.3.0]
- bitops       [* -&gt; 1.0-9]
- cards        [* -&gt; 0.5.0]
- gt           [* -&gt; 0.11.1]
- gtsummary    [* -&gt; 2.1.0]
- juicyjuice   [* -&gt; 0.1.0]
- markdown     [* -&gt; 1.13]
- reactable    [* -&gt; 0.4.4]
- reactR       [* -&gt; 0.6.1]
- V8           [* -&gt; 6.0.1]

Do you want to proceed? [Y/n]: Y</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>- Lockfile written to "~/projects/uob/astronaut-data-analysis-fair-r/spacewalks/renv.lock".</code></pre>
</div>
<p>Finally, let’s run renv::status() in the console:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">renv</span><span class="fu">::</span><span class="fu">status</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>No issues found -- the project is in a consistent state.</code></pre>
</div>
</section><section><h2 class="section-heading" id="caveats-4">Caveats <a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>
<a class="anchor" aria-label="anchor" href="#caveats-4"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="the-lockfile">The lockfile<a class="anchor" aria-label="anchor" href="#the-lockfile"></a>
</h3>
<p>The lockfile holds a snapshot of the project library at a moment in
time, but it doesn’t guarantee that this corresponds to the rendered
result. The lockfile could be out of date when the code is run, or the
code might have been run with a previous version of the lockfile. It’s
up to you to always render your file when the project is in a consistent
state.</p>
</div>
<div class="section level3">
<h3 id="dependency-discovery">Dependency discovery<a class="anchor" aria-label="anchor" href="#dependency-discovery"></a>
</h3>
<p>The automatic dependency discovery is really cool, but somewhat
limited. It understand the most common and obvious ways a package can be
loaded in a script, but it can fail if you use some more indirect
methods. As we saw, it fails to detect the markdown dependency. It also
fails if you use functionality in a package that depends on Suggested
packages (e.g. <code>ggplot2::geom_hex()</code> requires the hexbin
package, so you need to add an explicit <code><a href="https://github.com/edzer/hexbin" class="external-link">library(hexbin)</a></code>
somewhere in your project).</p>
</div>
<div class="section level3">
<h3 id="package-installation">Package installation<a class="anchor" aria-label="anchor" href="#package-installation"></a>
</h3>
<p>Sometimes package installation fails. One common case would be if you
installed a CRAN-compiled package in Windows but the person trying to
<code>restore()</code> the environment is running Linux. Since CRAN
doesn’t offer compiled packages for Linux, renv will try to install from
source, which can fail if compilation requires missing system
dependencies. There’s nothing renv can do in this case, but the problem
can be resolved by installing the relevant system dependencies.</p>
<p>Package installation will fail if the remote repository that hosts a
package is unreachable either due to local connection issues or it being
down, or deleted. Again, there’s nothing renv can do in that
situation.</p>
<p>Package installation can fail if the package requires compilation but
the machine doesn’t have enough RAM to compile. This is the case with
the sf package, which cannot be compiled in the free-tier RStudio Cloud
machine.</p>
</div>
<div class="section level3">
<h3 id="system-dependencies">System dependencies<a class="anchor" aria-label="anchor" href="#system-dependencies"></a>
</h3>
<p>Furthermore, some R packages require certain system dependences to be
installed to run. renv does not handle these cases yet, so if you are
using a package that needs system dependencies, installation could fail
if these are not met. Even if installation goes well, a package might
not work if it has unmet runtime dependencies.</p>
<p>Even in the case in which system dependencies are fulfilled, renv
offers no guarantee that these are the same versions used to run the
analysis. This means that if results depend on the version of some
system dependency, renv will not be able to ensure reproducibility. This
includes the version of R itself!</p>
</div>
</section><section><h2 class="section-heading" id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<hr class="half-width">
<p>We recommend the following resources for some additional reading on
the topic of this episode:</p>
<ul>
<li>[renv package official documentation][renv_man]</li>
</ul>
<p>Also check the <a href="reference.html#litref">full reference set</a>
for the course.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>renv environments keep different R package versions and dependencies
required by different projects separate.</li>
<li>An renv environment is essentially a project-specific directory
structure that isolates the packages and their versions used within that
project/compendium.</li>
<li>You can use renv to create and manage R project environments, and
use renv::restore() to install and manage external (third-party)
libraries (packages) in your project.</li>
<li>By convention, you can save and export your R environment in a set
of files (renv.lock), located in your project’s root directory. This
file can then be shared with collaborators/users and used to replicate
your environment elsewhere using renv::restore().</li>
</ul>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="attribution">Attribution<a class="anchor" aria-label="anchor" href="#attribution"></a>
</h2>
<hr class="half-width">
<p>This episode reuses material from the [“Reproducible Development
Environment”][fair-software-course-correctn] episode of the Software
Carpentries Incubator course <a href="https://carpentries-incubator.github.io/fair-research-software/" class="external-link">“Tools
and practices of FAIR research software”</a> under a <a href="https://creativecommons.org/licenses/by/4.0/deed.en" class="external-link">CC-BY-4.0</a>
with modifications (i) adaptations have been made to make the material
suitable for an audience of R users (e.g. replacing “software” with
“code” in places, pytest with testthat), (ii) all code has been ported
from Python to R (iii) Objectives, Questions, Key Points and Further
Reading sections have been updated to reflect the remixed R focussed
content.</p>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
<!--
Fair research software
 -->
<!--
Good Practices
 -->
<!---
Project Structure
--->
<!-------
Code Correctness
---->
<!--
Attribution
-->
</section><div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Material re-used from <a href="https://carpentries-incubator.github.io/fair-research-software/05-code-environment.html" class="external-link">“Reproducible
Development Environment”</a> under <a href="https://creativecommons.org/licenses/by/4.0/deed.en" class="external-link">CC-BY-4.0</a>
with modifications detailed above.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Reused from <a href="https://annakrystalli.me/rrresearchACCE20/managing-dependencies.htm" class="external-link">Managing
Dependences</a> in course <a href="https://annakrystalli.me/rrresearchACCE20/" class="external-link">“Reproducible Research
Data and Project Management in R”</a> by Anna Krystalli under <a href="https://creativecommons.org/licenses/by/4.0/deed.en" class="external-link">CC-BY-4.0</a>
with modifications to update R output for our case-study.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Reused from <a href="https://annakrystalli.me/rrresearchACCE20/managing-dependencies.htm" class="external-link">Managing
Dependences</a> in course <a href="https://annakrystalli.me/rrresearchACCE20/" class="external-link">“Reproducible Research
Data and Project Management in R”</a> by Anna Krystalli under <a href="https://creativecommons.org/licenses/by/4.0/deed.en" class="external-link">CC-BY-4.0</a>
with modifications to update R output for our case-study.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Original material.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Re-used from the lesson <a href="https://reproducibility.rocks/materials/day3/01-renv/" class="external-link">“Managing R
dependencies with renv”</a> under <a href="https://creativecommons.org/licenses/by/4.0/legalcode" class="external-link">CC-BY-4.0</a>
from <a href="https://reproducibility.rocks/" class="external-link">“An R reproducibility
toolkit for the practical researcher”</a> by Elio Campitelli and Paola
Corrales.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Re-used from the lesson <a href="https://reproducibility.rocks/materials/day3/01-renv/" class="external-link">“Managing R
dependencies with renv”</a> under <a href="https://creativecommons.org/licenses/by/4.0/legalcode" class="external-link">CC-BY-4.0</a>
from <a href="https://reproducibility.rocks/" class="external-link">“An R reproducibility
toolkit for the practical researcher”</a> by Elio Campitelli and Paola
Corrales.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>Re-used from the lesson <a href="https://reproducibility.rocks/materials/day3/01-renv/" class="external-link">“Managing R
dependencies with renv”</a> under <a href="https://creativecommons.org/licenses/by/4.0/legalcode" class="external-link">CC-BY-4.0</a>
from <a href="https://reproducibility.rocks/" class="external-link">“An R reproducibility
toolkit for the practical researcher”</a> by Elio Campitelli and Paola
Corrales.<a href="#fnref7" class="footnote-back">↩︎</a></p></li>
</ol>
</div></section><section id="aio-08-wrap-up"><p>Content from <a href="08-wrap-up.html">Wrap-up</a></p>
<hr>
<p>Last updated on 2025-03-12 |

        <a href="https://github.com/kkh451/r_reproducibility/edit/main/episodes/08-wrap-up.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What reproducible research practices have we covered in this
course?</li>
<li>What tools and practices should you learn next?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Reflect on the reproducible research practices in this course and
identify next steps for additional skills</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>In this course we have explored the significance of reproducible
research and explored some tools and practices we can use in our own R
development that can help us and others do <em>better research</em>
including unit testing and dependency management.</p>
<p>Reproducible research often requires that researchers implement new
practices and learn new tools - in this course we taught you some of
these as a starting point but you will discover what works best for
yourself, your group, community and domain.</p>
<p>Some of these practices may take a while to implement and may require
perseverance, others you can start practicing today.</p>
<figure><img src="fig/plant-a-tree.jpg" alt='An image of a Chinese proverb "The best time to plant a tree was 20 years ago. The second best time is now' class="figure mx-auto d-block"><div class="figcaption">An image of a Chinese proverb “The best time to
plant a tree was 20 years ago. The second best time is now” by CCNULL,
used under a CC-BY 2.0 licence</div>
</figure><section><h2 class="section-heading" id="next-steps-1">Next Steps <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
<a class="anchor" aria-label="anchor" href="#next-steps-1"></a>
</h2>
<hr class="half-width">
<p>In this course we focused on tools and practices relevant to R
development.</p>
<p>A key practice / tool that we did not cover in this course is the use
of version control tools to track changes in you project. Some of the
tools covered in this course e.g. the <code>rrtools</code> compendium
will work even better when used with version control tools.</p>
<p>This is an extremely important skill that can help support
reproducible research - but that’s a story for another course.</p>
</section><section><h2 class="section-heading" id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<hr class="half-width">
<p>Please check out <a href="reference.html#litref">the following
resources</a> for some additional reading on the topic of this course
and the full reference set.</p>
<ul>
<li><a href="https://happygitwithr.com/" class="external-link">Happy Git and GitHub for the
UseR</a></li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>We covered a range of best practices for reproducible research in
this course</li>
<li>Thes practices will deliver even better results if you pair them
with the use of version control e.g. git/GitHub.</li>
</ul>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="attribution">Attribution<a class="anchor" aria-label="anchor" href="#attribution"></a>
</h2>
<hr class="half-width">
<p>This episode reuses material from the <a href="https://carpentries-incubator.github.io/fair-research-software/11-wrap-up.html" class="external-link">“Wrap-up”</a>
episode of the Software Carpentries Incubator course <a href="https://carpentries-incubator.github.io/fair-research-software/" class="external-link">“Tools
and practices of FAIR research software”</a> under a <a href="https://creativecommons.org/licenses/by/4.0/deed.en" class="external-link">CC-BY-4.0</a>
with modifications: Objectives, Questions, Key Points and Further
Reading sections have been updated to reflect the remixed R focussed
content.</p>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
<!--
Fair research software
 -->
<!--
Good Practices
 -->
<!---
Project Structure
--->
<!-------
Code Correctness
---->
<!--
Attribution
-->
</section><div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Original Content<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/kkh451/r_reproducibility/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/kkh451/r_reproducibility/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/kkh451/r_reproducibility/" class="external-link">Source</a></p>
				<p><a href="https://github.com/kkh451/r_reproducibility/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:k.r.kopec-harding@bham.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://kkh451.github.io/r_reproducibility/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "R, RStudio, lesson, reproducibility",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://kkh451.github.io/r_reproducibility/aio.html",
  "identifier": "https://kkh451.github.io/r_reproducibility/aio.html",
  "dateCreated": "2024-09-01",
  "dateModified": "2025-03-12",
  "datePublished": "2025-03-12"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

