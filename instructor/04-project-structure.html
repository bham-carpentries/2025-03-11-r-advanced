<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Advanced R: R for Reproducibility: Project structure</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png"><link rel="manifest" href="../favicons/incubator/site.webmanifest"><link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Lesson Description" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>


      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../04-project-structure.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="../assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Advanced R: R for Reproducibility
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Advanced R: R for Reproducibility
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Advanced R: R for Reproducibility
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 40%" class="percentage">
    40%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 40%" aria-valuenow="40" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../04-project-structure.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-introduction.html">1. Course introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-good-practices.html">2. Good practices</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-code-readability.html">3. Code readability</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        4. Project structure
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#introducing-research-compendia">Introducing Research Compendia</a></li>
<li><a href="#setting-up-a-research-compendium">Setting up a research compendium</a></li>
<li><a href="#managing-functionality-in-a-package">Managing functionality in a package</a></li>
<li><a href="#further-reading">Further reading</a></li>
<li><a href="#attribution">Attribution</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-code-documentation.html">5. Code documentation</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-code-correctness.html">6. Code correctness</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-code-environment.html">7. Reproducible development environment</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-wrap-up.html">8. Wrap-up</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/03-code-readability.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/05-code-documentation.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/03-code-readability.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Code readability
        </a>
        <a class="chapter-link float-end" href="../instructor/05-code-documentation.html" rel="next">
          Next: Code documentation...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Project structure</h1>
        <p>Last updated on 2026-02-09 |

        <a href="https://github.com/kkh451/r_reproducibility/edit/main/episodes/04-project-structure.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 90 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can we best structure our R project?</li>
<li>What are conventional places to store data, code, results and tests
within our research project?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to:</p>
<ul><li>Set up and use an R “research compendium” using rrtools to organise
a reproducible research project.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>In the previous episode we have seen some tools and practices that
can help up improve readability of our code - including breaking our
code into small, reusable functions that perform one specific task.</p>
<p>In this episode we will expand these practices to our (research)
projects as a whole.</p>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>At this point, the code in your local software project’s directory
should be as in: <a href="https://github.com/bham-carpentries/astronaut-data-analysis-for-r/tree/04-project-structure" class="external-link uri">https://github.com/bham-carpentries/astronaut-data-analysis-for-r/tree/04-project-structure</a></p>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introducing-research-compendia">Introducing Research Compendia<a class="anchor" aria-label="anchor" href="#introducing-research-compendia"></a></h2>
<hr class="half-width"><p>Ensuring that our R project is organised and well-structured is just
as important as writing well-structured code. Following conventions on
consistent and informative directory structure for our project will
ensure people will immediately know where to find things and is
especially helpful for long-term research projects or when working in
teams.</p>
<p>Our project is currently set up as a simple R project with all of our
files stored in the root of the project folder. We could improve on this
significantly by creating a more structured directory layout like the
one below:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>project_name/
├── README.md             # overview of the project
├── data/                 # data files used in the project
│   ├── README.md         # describes where data came from
│   ├── raw/
│   └── processed/
├── manuscript/           # manuscript describing the results
├── results/              # results of the analysis (data, tables)
│   ├── preliminary/
│   └── final/
├── figures/              # results of the analysis (figures)
│   ├── comparison_plot.png
│   └── regression_chart.pdf
├── src/                  # contains source code for the project
│   ├── LICENSE           # license for your code
│   ├── main_script.R    # main script/code entry point
│   └── ...
├── doc/                  # documentation for your project
└── ...</code></pre>
</div>
<p>However, we are going to structure our project as an rrtools
(package) research compendium instead.</p>
<p>An rrtools compendium is essentially an R package containing
everything required to reproduce an analysis (data and functions). While
experience of building R packages is helpful - it isn’t necessary to get
started working with rrtools compendia - we will cover the necessary
detail as we go along.</p>
<div id="research-compendium-vs-r-project" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="research-compendium-vs-r-project" class="callout-inner">
<h3 class="callout-title">Research Compendium vs R Project</h3>
<div class="callout-content">
<p>A <strong>research compendium</strong> offers additional benefits
over a simple R project structure, particularly for ensuring
reproducibility and long-term sustainability of the project.</p>
<ul><li><p>While a simple R project can be <strong>well-organised</strong>,
a research compendium follows a standardised <strong>R package
structure</strong> that aligns with best practices for reproducible
research. This makes it far easier for someone new to the project to
understand and run the analysis.</p></li>
<li><p>rrtools compendia include <strong>metadata files</strong> like
<code>DESCRIPTION</code> and <code>NAMESPACE</code> that provide clear
documentation of dependencies, which helps other collaborators or future
users run your project with the correct packages and versions.</p></li>
<li><p>The compendium setup also allows you to include automatic
documentation generation through tools like <strong>roxygen2</strong>,
making it easier to maintain and update as the project evolves.</p></li>
<li><p>A research compendium supports <strong>automated testing</strong>
(using tools like <code>testthat</code>).</p></li>
</ul></div>
</div>
</div>
</section><section><h2 class="section-heading" id="setting-up-a-research-compendium">Setting up a research compendium<a class="anchor" aria-label="anchor" href="#setting-up-a-research-compendium"></a></h2>
<hr class="half-width"><p>In this section we are going to setup an R compendium using the
rrtools package and copy over our content from out current project to
the new compendium.</p>
<p>The top-level of our folder structure for this course is organised as
follows:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>advanced_r/
├── project/
│   └── spacewalks1/ # contains source code for the project
└── compendium/</code></pre>
</div>
<p>Before we start, we need to close our current
<code>spacewalks1</code> project (File &gt;&gt; Close Project) and
create and open a new R project <code>spacewalks2</code> in the
compendium subfolder of <code>advanced_r</code> (File &gt;&gt; New
Project &gt;&gt; New Directory &gt;&gt; New Project).</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>advanced_r/
├── project/
│   └── spacewalks1/
└── compendium/
│   └── spacewalks2/ </code></pre>
</div>
<p>We also need to install a number of packages we’ll need to start
working with the compendium:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"rrtools"</span><span class="op">)</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"usethis"</span><span class="op">)</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span></code></pre>
</div>
<p>Once we have created and launched the new project, we can start
setting up the compendium by running the following commands in the R
console:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">rrtools</span><span class="op">)</span></span>
<span><span class="fu">rrtools</span><span class="fu">::</span><span class="fu">use_compendium</span><span class="op">(</span>simple<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&gt; library(rrtools)
✔ Git is installed on this computer, your username is abc123</code></pre>
</div>
<pre><code>New project 'spacewalks2' is nested inside an existing project '/Users/myusername/projects/astronaut-data-analysis-r/advanced_r/compendium', which is rarely a good idea.
If this is unexpected, the here package has a function, `here::dr_here()` that reveals why '/Users/myusername/projects/astronaut-data-analysis-r/advanced_r/compendium' is regarded as a project.
Do you want to create anyway?

1: I agree
2: Absolutely not
3: Not now</code></pre>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Selection: 1
✔ Setting active project to '/Users/myusername/projects/astronaut-data-analysis-r/advanced_r/compendium/spacewalks2'
✔ Creating 'R/'
✔ Writing 'DESCRIPTION'
Package: spacewalks2
Title: What the Package Does (One Line, Title Case)
Version: 0.0.0.9000
Authors@R (parsed):
    * First Last &lt;first.last@example.com&gt; [aut, cre]
Description: What the package does (one paragraph).
License: MIT + file LICENSE
ByteCompile: true
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.3.2
✔ Writing 'NAMESPACE'
Overwrite pre-existing file 'spacewalks2.Rproj'?

1: Yup
2: Nope
3: Not now
</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Selection: 1
✔ Writing 'spacewalks2.Rproj'
✔ Adding '^spacewalks2\\.Rproj$' to '.Rbuildignore'
✔ Adding '.Rproj.user' to '.gitignore'
✔ Adding '^\\.Rproj\\.user$' to '.Rbuildignore'
✔ Opening '/Users/myusername/projects/astronaut-data-analysis-r/advanced_r/compendium/spacewalks2/' in new RStudio session
✔ Setting active project to '&lt;no active project&gt;'
✔ The package spacewalks2 has been created

Next, you need to:  ↓ ↓ ↓
• Edit the DESCRIPTION file
• Add a license file (e.g. with usethis::use_mit_license(copyright_holder = 'Your Name'))
• Use other 'rrtools' functions to add components to the compendium</code></pre>
</div>
<p>The output of the use_compendium function provides a list of next
steps to complete the setup of the compendium.</p>
<p>We will follow these steps to complete the setup, but first let’s
take a look at the new directory structure that has been created:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>.
├── DESCRIPTION &lt;- .............................package metadata
|                                               dependency management
├── NAMESPACE &lt;- ...............................AUTO-GENERATED on build
├── R &lt;- .......................................folder for functions
└── spacewalks2.Rproj &lt;- ......................rstudio project file</code></pre>
</div>
<p>rrtools::use_compendium() creates the bare backbone of infrastructure
required for a research compendium.</p>
<p>At this point it provides facilities to store general metadata about
our compendium (eg bibliographic details to create a citation) and
manage dependencies in the DESCRIPTION file and store and document
functions in the R/ folder.</p>
<p>Together these allow us to manage, install and share functionality
associated with our project.</p>
<ul><li>A <code>DESCRIPTION</code> file is a required component of an R
package. This file contains metadata about our package, including the
name, version, author, and dependencies.</li>
<li>A <code>NAMESPACE</code> file is a required component of an R
package. Its role is to defines the functions, methods, and datasets
that are exported from a package (i.e., made available to users) and
those that are kept internal (i.e., not accessible directly by users).
It helps manage the visibility of functions and ensures that only the
intended parts of the package are exposed to the outside world. This
file is auto-generated when the package is built.</li>
<li>The <code>R/</code> folder contains the R scripts that contain the
functions in the package.</li>
<li>RStudio Project file <code>spacewalks2.Rproj</code> - this file is
used to open the project in RStudio.</li>
</ul><div class="section level3">
<h3 id="edit-the-description-file">Edit the DESCRIPTION file<a class="anchor" aria-label="anchor" href="#edit-the-description-file"></a></h3>
<p>Let’s start by editing the DESCRIPTION file.</p>
<pre class="text"><code>Package: spacewalks2
Title: What the Package Does (One Line, Title Case)
Version: 0.0.0.9000
Authors@R:
    person("First", "Last", , "first.last@example.com", role = c("aut", "cre"))
Description: What the package does (one paragraph).
License: MIT + file LICENSE
ByteCompile: true
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.3.2</code></pre>
<p>The following fields need to be updated:</p>
<ul><li>
<code>Package</code> - the name of the package.</li>
<li>
<code>Title</code> - a short description of what the package
does.</li>
<li>
<code>Version</code> - the version number of the package.</li>
<li>
<code>Authors@R</code> - the authors of the package.</li>
<li>
<code>Description</code> - a longer description of what the package
does.</li>
<li>
<code>License</code> - the license under which the package code is
distributed.</li>
</ul><pre><code>Package: spacewalks2
Title: Analysis of NASA's extravehicular activity datasets
Version: 0.0.0.9000
Authors@R: c(
    person(given   = "Kamilla",
           family  = "Kopec-Harding",
           role    = c("cre"),
           email   = "k.r.kopec-harding@bham.ac.uk",
           comment = c(ORCID = "{{0000-0002-2960-7944}}")),
    person(given   = "Sarah",
           family  = "Jaffa",
           role    = c("aut"),
           email   = "sarah.jaffa@manchester.ac.uk",
           comment = c(ORCID = "{{0000-0002-6711-6345}}")),
    person(given   = "Aleksandra",
           family  = "Nenadic",
           role    = c("aut"),
           comment = c(ORCID = "{{0000-0002-2269-3894}}"))
    )
Description: An R research compendium for researchers to generate visualisations and statistical
    summaries of NASA's extravehicular activity datasets.
License: MIT + file LICENSE
ByteCompile: true
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.3.2</code></pre>
</div>
<div class="section level3">
<h3 id="add-a-license-file">Add a license file<a class="anchor" aria-label="anchor" href="#add-a-license-file"></a></h3>
<p>Next, we need to add a license file to the compendium.<br>
A license file is a text file that specifies the legal terms under which
the code in the package can be used.</p>
<p>We can add a license file using the <code>usethis</code> package:
We’ll use an MIT license for this project. We discuss how to select a
license in the next episode.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_mit_license</span><span class="op">(</span>copyright_holder <span class="op">=</span> <span class="st">"Kamilla Kopec-Harding"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>✔ Writing 'LICENSE'
✔ Writing 'LICENSE.md'
✔ Adding '^LICENSE\\.md$' to '.Rbuildignore'</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="add-components-to-the-compendium">Add components to the compendium<a class="anchor" aria-label="anchor" href="#add-components-to-the-compendium"></a></h3>
<p>Once we have filled in the DESCRIPTION file and added a license file,
we can start adding content to the compendium. We’ll look at this in
detail in the next section</p>
</div>
</section><section><h2 class="section-heading" id="managing-functionality-in-a-package">Managing functionality in a package<a class="anchor" aria-label="anchor" href="#managing-functionality-in-a-package"></a></h2>
<hr class="half-width"><p>We mentioned previously that an R compendium is an R package.
<code>rrtools</code> essentially provides us with an R package template
and in this section we will start populating this with the functionality
from our current project <code>spacewalks1</code>.</p>
<p>Our first task is to copy over the code from our current project to
the new compendium and get it working within the compendium / R package
structure. We’ll follow these steps:</p>
<ul><li>Create package functions</li>
<li>Document our functions</li>
<li>Build and install our compendium package</li>
<li>Check our package for issues</li>
<li>Fix any issues that come up</li>
<li>Re-build and install our compendium package</li>
<li>Write a script to run (drive) our analysis</li>
</ul><div class="section level3">
<h3 id="create-package-functions">Create package functions<a class="anchor" aria-label="anchor" href="#create-package-functions"></a></h3>
<p>We’ll start by creating a new R script file in the <code>R/</code>
folder of the compendium and copying over the functions we have created
so far.</p>
<p>To create or edit .R files in the R/ directory, we can use:</p>
<pre><code><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_r</span><span class="op">(</span><span class="st">"eva_data_analysis.R"</span><span class="op">)</span></span></code></pre>
<p>This creates a file called eva_data_analysis.R in the R/ directory
and opens it up for editing. Let’s populate this with the functions we
created in the previous episode.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># R/eva_data_analysis.R</span></span>
<span></span>
<span><span class="co">#' Read and Clean EVA Data from JSON</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function reads EVA data from a JSON file, cleans it by converting</span></span>
<span><span class="co">#' the 'eva' column to numeric, converting data from text to date format,</span></span>
<span><span class="co">#. creating a year variable and removing rows with missing values, and sorts</span></span>
<span><span class="co">#' the data by the 'date' column.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param input_file A character string specifying the path to the input JSON file.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A cleaned and sorted data frame containing the EVA data.</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">read_json_to_dataframe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"Reading JSON file"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_df</span> <span class="op">&lt;-</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">eva_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Convert Duration from HH:MM Format to Hours</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function converts a duration in "HH:MM" format (as a character string)</span></span>
<span><span class="co">#' into the total duration in hours (as a numeric value).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @details</span></span>
<span><span class="co">#' When applied to a vector, it will only process and return the first element</span></span>
<span><span class="co">#' so this function must be applied to a data frame rowwise.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param duration A character string representing the duration in "HH:MM" format.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A numeric value representing the duration in hours.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' text_to_duration("03:45")  # Returns 3.75 hours</span></span>
<span><span class="co">#' text_to_duration("12:30")  # Returns 12.5 hours</span></span>
<span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">time_parts</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_split</span><span class="op">(</span><span class="va">duration</span>, <span class="st">":"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">hours</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">minutes</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">60</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Plot Cumulative Time in Space Over the Years</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function plots the cumulative time spent in space over the years based on</span></span>
<span><span class="co">#' the data in the dataframe. The cumulative time is calculated by converting the</span></span>
<span><span class="co">#' "duration" column into hours, then computing the cumulative sum of the duration.</span></span>
<span><span class="co">#' The plot is saved as a PNG file at the specified location.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param tdf A dataframe containing a "duration" column in "HH:MM" format and a "date" column.</span></span>
<span><span class="co">#' @param graph_file A character string specifying the path to save the graph.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return NULL</span></span>
<span><span class="va">plot_cumulative_time_in_space</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tdf</span>, <span class="va">graph_file</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">tdf</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Add duration_hours column</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>     <span class="co"># Calculate cumulative time</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, plot <span class="op">=</span> <span class="va">time_in_space_plot</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Notice that this file <strong>only</strong> contains functions and we
have omitted <code>library()</code> calls. We will add the main script
that calls these functions later.</p>
</div>
<div class="section level3">
<h3 id="document-package-functions">Document package functions<a class="anchor" aria-label="anchor" href="#document-package-functions"></a></h3>
<p>Now, to have our functions exported as part of the spacewalks2
package, we need to document them using Roxygen2.</p>
<p>As we saw earlier, Roxygen2 provides a documentation framework in R
and allows us to write specially-structured comments preceding each
function definition. When we document our our package, these are
processed automatically to produce .Rd help files for our functions. The
contents of these files controls which are exported to the package
NAMESPACE.</p>
<p>The <span class="citation">@export</span> tag tells Roxygen2 to add a
function as an export in the NAMESPACE file, so that it will be
accessible and available for use after package installation. This means
that we need to add the <span class="citation">@export</span> function
to each of our functions:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Read and Clean EVA Data from JSON</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function reads EVA data from a JSON file, cleans it by converting</span></span>
<span><span class="co">#' the 'eva' column to numeric, converting data from text to date format,</span></span>
<span><span class="co">#. creating a year variable and removing rows with missing values, and sorts</span></span>
<span><span class="co">#' the data by the 'date' column.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param input_file A character string specifying the path to the input JSON file.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A cleaned and sorted data frame containing the EVA data.</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">read_json_to_dataframe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"Reading JSON file"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_df</span> <span class="op">&lt;-</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">eva_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Convert Duration from HH:MM Format to Hours</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function converts a duration in "HH:MM" format (as a character string)</span></span>
<span><span class="co">#' into the total duration in hours (as a numeric value).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @details</span></span>
<span><span class="co">#' When applied to a vector, it will only process and return the first element</span></span>
<span><span class="co">#' so this function must be applied to a data frame rowwise.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param duration A character string representing the duration in "HH:MM" format.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A numeric value representing the duration in hours.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' text_to_duration("03:45")  # Returns 3.75 hours</span></span>
<span><span class="co">#' text_to_duration("12:30")  # Returns 12.5 hours</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">time_parts</span> <span class="op">&lt;-</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">duration</span>, <span class="st">":"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">hours</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">minutes</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">60</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Plot Cumulative Time in Space Over the Years</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function plots the cumulative time spent in space over the years based on</span></span>
<span><span class="co">#' the data in the dataframe. The cumulative time is calculated by converting the</span></span>
<span><span class="co">#' "duration" column into hours, then computing the cumulative sum of the duration.</span></span>
<span><span class="co">#' The plot is saved as a PNG file at the specified location.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param tdf A dataframe containing a "duration" column in "HH:MM" format and a "date" column.</span></span>
<span><span class="co">#' @param graph_file A character string specifying the path to save the graph.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return NULL</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">plot_cumulative_time_in_space</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tdf</span>, <span class="va">graph_file</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">tdf</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Add duration_hours column</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>     <span class="co"># Calculate cumulative time</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, plot <span class="op">=</span> <span class="va">time_in_space_plot</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="build-and-install-package">Build and install package<a class="anchor" aria-label="anchor" href="#build-and-install-package"></a></h3>
<div class="section level4">
<h4 id="build-roxygen-documentation">Build Roxygen documentation<a class="anchor" aria-label="anchor" href="#build-roxygen-documentation"></a></h4>
<p>Now that we’ve annotated our source code we can build the
documentation either by clicking on More &gt; Document in the RStudio
Build panel or from the console using:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">document</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>ℹ Updating spacewalks2 documentation
ℹ Loading spacewalks2
Writing NAMESPACE
Writing read_json_to_dataframe.Rd
Writing text_to_duration.Rd
Writing plot_cumulative_time_in_space.Rd</code></pre>
</div>
<p>The man/ directory will now contain an .Rd file for each of our
functions.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>man
└── plot_cumulative_time_in_space.Rd
└── read_json_to_dataframe.Rd
└── text_to_duration.Rd</code></pre>
</div>
<p>and the NAMESPACE now contains an export() entry for each of our
functions:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co"># Generated by roxygen2: do not edit by hand</span></span>
<span><span class="fu">export</span><span class="op">(</span><span class="va">plot_cumulative_time_in_space</span><span class="op">)</span></span>
<span><span class="fu">export</span><span class="op">(</span><span class="va">read_json_to_dataframe</span><span class="op">)</span></span>
<span><span class="fu">export</span><span class="op">(</span><span class="va">text_to_duration</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="install-package">Install Package<a class="anchor" aria-label="anchor" href="#install-package"></a></h4>
<p>The usual workflow for package development is to:</p>
<ul><li>make some changes</li>
<li>build and install the package</li>
<li>unload and reload the package (often in a new R session)</li>
</ul><p>The best way to install and reload a package in a fresh R session is
to use the 🔨 Clean and Install command tab in the Build panel which
performs several steps in sequence to ensure a clean and correct
result:</p>
<ul><li>Unloads any existing version of the package (including shared
libraries if necessary).</li>
<li>Builds and installs the package using R CMD INSTALL.</li>
<li>Restarts the underlying R session to ensure a clean environment for
re-loading the package.</li>
<li>Reloads the package in the new R session by executing the library
function.</li>
</ul><p>Running the 🔨 Clean and Install command on our package results in
this output in the Build panel output:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>==&gt; R CMD INSTALL --preclean --no-multiarch --with-keep.source spacewalks2

* installing to library ‘/Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library’
* installing *source* package ‘spacewalks2’ ...
** using staged installation
** R
** byte-compile and prepare package for lazy loading
** help
*** installing help indices
** building package indices
** testing if installed package can be loaded from temporary location
** testing if installed package can be loaded from final location
** testing if installed package keeps a record of temporary installation path
* DONE (spacewalks2)</code></pre>
</div>
<p>We can inspect the resulting documentation for our function using
?plot_cumulative_time_in_space</p>
</div>
</div>
<div class="section level3">
<h3 id="check-package">Check package<a class="anchor" aria-label="anchor" href="#check-package"></a></h3>
<div class="section level4">
<h4 id="automated-checking">Automated checking<a class="anchor" aria-label="anchor" href="#automated-checking"></a></h4>
<p>An important part of the package development process is R CMD check.
R CMD check automatically checks your code and can automatically detects
many common problems that we’d otherwise discover the hard way.</p>
<p>To check our package, we can:</p>
<ul><li>use devtools::check()</li>
<li>click on the ✅Check tab in the Build panel.</li>
</ul><p>This: + Ensures that the documentation is up-to-date by running
devtools::document(). + Bundles the package before checking it.</p>
<p>More info on checks here.</p>
<p>Both these run R CMD check which return three types of messages:</p>
<ul><li>ERRORs: Severe problems that you should fix regardless of whether or
not you’re submitting to CRAN.</li>
<li>WARNINGs: Likely problems that you must fix if you’re planning to
submit to CRAN (and a good idea to look into even if you’re not). _
NOTEs: Mild problems. If you are submitting to CRAN, you should strive
to eliminate all NOTEs, even if they are false positives. Let’s Check
our package:</li>
</ul><div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── R CMD check results ──────────────────────────────────────────────────────────── spacewalks2 0.0.0.9000 ────
Duration: 10s

❯ checking dependencies in R code ... WARNING
  '::' or ':::' imports not declared from:
    ‘ggplot2’ ‘stringr’

❯ checking R code for possible problems ... NOTE
  plot_cumulative_time_in_space: no visible global function definition
    for ‘ggplot’
  plot_cumulative_time_in_space: no visible global function definition
    for ‘mutate’
  plot_cumulative_time_in_space: no visible global function definition
    for ‘ungroup’
  plot_cumulative_time_in_space: no visible global function definition
    for ‘rowwise’
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘duration’
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘duration_hours’
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘cumulative_time’
  plot_cumulative_time_in_space: no visible global function definition
    for ‘geom_line’
  plot_cumulative_time_in_space: no visible global function definition
    for ‘labs’
  read_json_to_dataframe: no visible global function definition for
    ‘arrange’
  read_json_to_dataframe: no visible global function definition for
    ‘drop_na’
  read_json_to_dataframe: no visible global function definition for
    ‘mutate’
  read_json_to_dataframe: no visible global function definition for
    ‘fromJSON’
  read_json_to_dataframe: no visible binding for global variable ‘eva’
  read_json_to_dataframe: no visible global function definition for
    ‘ymd_hms’
  read_json_to_dataframe: no visible global function definition for
    ‘year’
  Undefined global functions or variables:
    arrange cumulative_time drop_na duration duration_hours eva fromJSON
    geom_line ggplot labs mutate rowwise ungroup year ymd_hms

0 errors ✔ | 1 warning ✖ | 1 notes ✖</code></pre>
</div>
<p>R CMD check succeeded OK so there’s a couple of flags from problems
and a NOTE. Let’s start troubleshooting with:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>our_function_name: no visible global function definition for ‘third_party_function_name’

read_json_to_dataframe: no visible global function definition for ‘mutate’
plot_cumulative_time_in_space: no visible global function definition for ‘ggplot’</code></pre>
</div>
<p>This arises because we are using lots of functions from third party
packages in our code e.g. mutate and ggplot from dplyr and ggplot2
respectively. However, we have not specified that they are imported from
the dplyr and ggplot2 NAMESPACEs so the checks look for functions with
those names in our package (spacewalks2) instead and obviously can’t
find anything.</p>
<p>To fix this we need to add the namespace of every third-party
function we use.</p>
<p>To specify the namespace of a function we use the notation
<package_name>::<function_name>, so let’s update our functions with
these details.</function_name></package_name></p>
<p>Let’s start with <code>read_json_to_dataframe</code>:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">read_json_to_dataframe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"Reading JSON file"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_df</span> <span class="op">&lt;-</span> <span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">eva_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Once we’ve added namespace notation to all the functions our
<code>read_json_to_dataframe</code> function looks like this:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">read_json_to_dataframe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"Reading JSON file"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_df</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">eva_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Add namespace notation to the
<code>plot_cumulative_time_in_space</code> function</p>
<pre><code><span><span class="va">plot_cumulative_time_in_space</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tdf</span>, <span class="va">graph_file</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">tdf</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Add duration_hours column</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>     <span class="co"># Calculate cumulative time</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, plot <span class="op">=</span> <span class="va">time_in_space_plot</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>plot_cumulative_time_in_space &lt;- function(tdf, graph_file) {</p>
<p>time_in_space_plot &lt;- tdf |&gt; dplyr::rowwise() |&gt;
dplyr::mutate(duration_hours = text_to_duration(duration)) |&gt; # Add
duration_hours column dplyr::ungroup() |&gt;
dplyr::mutate(cumulative_time = cumsum(duration_hours)) |&gt; #
Calculate cumulative time ggplot2::ggplot(ggplot2::aes(x = date, y =
cumulative_time)) + ggplot2::geom_line(color = “black”) + ggplot2::labs(
x = “Year”, y = “Total time spent in space to date (hours)”, title =
“Cumulative Spacewalk Time” )</p>
<p>ggplot2::ggsave(graph_file, width = 8, height = 6, plot =
time_in_space_plot) }</p>
</div>
</div>
</div>
</div>
<p>We can update the rest of our functions as follows:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Read and Clean EVA Data from JSON</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function reads EVA data from a JSON file, cleans it by converting</span></span>
<span><span class="co">#' the 'eva' column to numeric, converting data from text to date format,</span></span>
<span><span class="co">#. creating a year variable and removing rows with missing values, and sorts</span></span>
<span><span class="co">#' the data by the 'date' column.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param input_file A character string specifying the path to the input JSON file.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A cleaned and sorted data frame containing the EVA data.</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">read_json_to_dataframe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"Reading JSON file"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_df</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu">fromJSON</span><span class="op">(</span><span class="va">input_file</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>eva <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">eva</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu">ymd_hms</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">arrange</span><span class="op">(</span><span class="va">date</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">eva_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Convert Duration from HH:MM Format to Hours</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function converts a duration in "HH:MM" format (as a character string)</span></span>
<span><span class="co">#' into the total duration in hours (as a numeric value).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @details</span></span>
<span><span class="co">#' When applied to a vector, it will only process and return the first element</span></span>
<span><span class="co">#' so this function must be applied to a data frame rowwise.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param duration A character string representing the duration in "HH:MM" format.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A numeric value representing the duration in hours.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' text_to_duration("03:45")  # Returns 3.75 hours</span></span>
<span><span class="co">#' text_to_duration("12:30")  # Returns 12.5 hours</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">time_parts</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_split</span><span class="op">(</span><span class="va">duration</span>, <span class="st">":"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">hours</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">minutes</span> <span class="op">&lt;-</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">time_parts</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">60</span></span>
<span>  <span class="kw">return</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Plot Cumulative Time in Space Over the Years</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function plots the cumulative time spent in space over the years based on</span></span>
<span><span class="co">#' the data in the dataframe. The cumulative time is calculated by converting the</span></span>
<span><span class="co">#' "duration" column into hours, then computing the cumulative sum of the duration.</span></span>
<span><span class="co">#' The plot is saved as a PNG file at the specified location.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param tdf A dataframe containing a "duration" column in "HH:MM" format and a "date" column.</span></span>
<span><span class="co">#' @param graph_file A character string specifying the path to save the graph.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return NULL</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">plot_cumulative_time_in_space</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tdf</span>, <span class="va">graph_file</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">time_in_space_plot</span> <span class="op">&lt;-</span> <span class="va">tdf</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>duration_hours <span class="op">=</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Add duration_hours column</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>cumulative_time <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">duration_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>     <span class="co"># Calculate cumulative time</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">cumulative_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">labs</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Total time spent in space to date (hours)"</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Cumulative Spacewalk Time"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu">ggsave</span><span class="op">(</span><span class="va">graph_file</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">6</span>, plot <span class="op">=</span> <span class="va">time_in_space_plot</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Let’s run Check again:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── R CMD check results ───────────────── spacewalks2 0.0.0.9000 ────
Duration: 1m 7.7s

❯ checking dependencies in R code ... WARNING
  '::' or ':::' imports not declared from:
    ‘dplyr’ ‘ggplot2’ ‘jsonlite’ ‘lubridate’ ‘stringr’ ‘tidyr’

❯ checking R code for possible problems ... NOTE
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘duration’
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘duration_hours’
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘cumulative_time’
  read_json_to_dataframe: no visible binding for global variable ‘eva’
  Undefined global functions or variables:
    cumulative_time duration duration_hours eva

0 errors ✔ | 1 warning ✖ | 1 notes ✖
Error: R CMD check found WARNINGs
Execution halted

Exited with status 1.</code></pre>
</div>
</div>
<div class="section level4">
<h4 id="add-dependency">Add dependency<a class="anchor" aria-label="anchor" href="#add-dependency"></a></h4>
<p>In this next round of checks, the note about undefined global
functions is gone but now we have a warning regarding ‘::’ or ‘:::’
import not declared from: ‘dplyr’, ‘ggplot2’ and other packages. It’s
flagging the fact that we are wanting to import functions from dplyr and
other packages but have not yet declared the package as a dependency in
the Imports field of the DESCRIPTION file.</p>
<p>We can add dplyr and these other packages to Imports with:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_package</span><span class="op">(</span><span class="st">"dplyr"</span>, <span class="st">"Imports"</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_package</span><span class="op">(</span><span class="st">"ggplot2"</span>, <span class="st">"Imports"</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_package</span><span class="op">(</span><span class="st">"jsonlite"</span>, <span class="st">"Imports"</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_package</span><span class="op">(</span><span class="st">"lubridate"</span>, <span class="st">"Imports"</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_package</span><span class="op">(</span><span class="st">"stringr"</span>, <span class="st">"Imports"</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_package</span><span class="op">(</span><span class="st">"tidyr"</span>, <span class="st">"Imports"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>✔ Setting active project to '/Users/krharding/projects/uob/astronaut-data-analysis-not-so-fair-r/advanced_r/compendium/spacewalks2'
✔ Adding 'dplyr' to Imports field in DESCRIPTION
• Refer to functions with `dplyr::fun()`
&gt; usethis::use_package("ggplot2", "Imports")
✔ Adding 'ggplot2' to Imports field in DESCRIPTION
• Refer to functions with `ggplot2::fun()`
&gt; usethis::use_package("jsonlite", "Imports")
✔ Adding 'jsonlite' to Imports field in DESCRIPTION
• Refer to functions with `jsonlite::fun()`
&gt; usethis::use_package("lubridate", "Imports")
✔ Adding 'lubridate' to Imports field in DESCRIPTION
• Refer to functions with `lubridate::fun()`
&gt; usethis::use_package("stringr", "Imports")
✔ Adding 'stringr' to Imports field in DESCRIPTION
• Refer to functions with `stringr::fun()`
&gt; usethis::use_package("tidyr", "Imports")
✔ Adding 'tidyr' to Imports field in DESCRIPTION
• Refer to functions with `tidyr::fun()` </code></pre>
</div>
<p>Our description file now looks like this:</p>
<pre><code>Package: spacewalks2
Title: Analysis of NASA's extravehicular activity datasets
Version: 0.0.0.9000
Authors@R: c(
    person(given   = "Kamilla",
           family  = "Kopec-Harding",
           role    = c("cre"),
           email   = "k.r.kopec-harding@bham.ac.uk",
           comment = c(ORCID = "{{0000-0002-2960-7944}}")),
    person(given   = "Sarah",
           family  = "Jaffa",
           role    = c("aut"),
           email   = "sarah.jaffa@manchester.ac.uk",
           comment = c(ORCID = "{{0000-0002-6711-6345}}")),
    person(given   = "Aleksandra",
           family  = "Nenadic",
           role    = c("aut"),
           comment = c(ORCID = "{{0000-0002-2269-3894}}"))
    )
Description: An R research compendium for researchers to generate visualisations and statistical
    summaries of NASA's extravehicular activity datasets.
License: MIT + file LICENSE
ByteCompile: true
Encoding: UTF-8
LazyData: true
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.3.2
Imports:
    dplyr,
    ggplot2,
    jsonlite,
    lubridate,
    stringr,
    tidyr</code></pre>
<p>Let’s do one final check.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── R CMD check results ───────────────── spacewalks2 0.0.0.9000 ────
Duration: 13.7s

❯ checking for future file timestamps ... NOTE
  unable to verify current time

❯ checking R code for possible problems ... NOTE
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘duration’
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘duration_hours’
  plot_cumulative_time_in_space: no visible binding for global variable
    ‘cumulative_time’
  read_json_to_dataframe: no visible binding for global variable ‘eva’
  Undefined global functions or variables:
    cumulative_time duration duration_hours eva

0 errors ✔ | 0 warnings ✔ | 1 notes ✖</code></pre>
</div>
<p>We’ll ignore this note for the time being. It results from the
non-standard evaluation used in dplyr functions. You can find out more
about it in the [Programming with dplyr
vignette][programming-with-dplyr-vignette].</p>
<div id="creating-a-driver-script" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="creating-a-driver-script" class="callout-inner">
<h3 class="callout-title">Creating a Driver Script</h3>
<div class="callout-content">
<ol style="list-style-type: decimal"><li><p>Now that we’ve updated our functions to include the correct
namespace for dplyr functions, let’s build and install the package again
so that are functions are available for use.</p></li>
<li>
<p>Setup a run script that calls the functions in the package to run
the analysis on the EVA data. The steps below will lead you through this
process.</p>
<ol style="list-style-type: lower-alpha"><li><p>Create a new folder <code>analysis</code> in the root of the
compendium.</p></li>
<li>
<p>Create the following sub-folders in the <code>analysis</code>
folder to organise our scripts, data and results:</p>
<ul><li>
<code>scripts</code> - to store our analysis scripts</li>
<li>
<code>data</code> - to store raw and processed data</li>
<li>
<code>data/raw_data</code> - to store our raw data<br></li>
<li>
<code>data/derived_data</code> - to store the output of our
analysis<br></li>
<li>
<code>figures</code> - to store any figures generated by our
analysis</li>
<li>
<code>tables</code> - to store any tables generated by our
analysis</li>
</ul></li>
<li><p>Place the file <code>eva-data.json</code> in the
<code>analysis/data/raw_data</code> folder.</p></li>
<li>
<p>Create a new R script file in the <code>scripts</code> folder
called <code>run_analysis.R</code>. Use the <code>run_analysis</code>
function from <code>spacewalks1</code> and related code to run the
analysis</p>
<p>Hint: remember to update the input and output file locations in your
code.</p>
</li>
<li>
<p>One final piece of housekeeping we need to do is to edit the file
.Rbuildignore in the root of the compendium and add the following line
to it:</p>
<pre><code>^analysis$</code></pre>
<p>This will ensure that the analysis folder is not included in the
package next time it is built.</p>
</li>
</ol></li>
</ol></div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<ol style="list-style-type: decimal"><li>Build and install the package</li>
</ol><p>Run “Clean and Install” from the build panel.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>==&gt; R CMD INSTALL --preclean --no-multiarch --with-keep.source spacewalks2

* installing to library ‘/Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library’
* installing *source* package ‘spacewalks2’ ...
** using staged installation
** R
** byte-compile and prepare package for lazy loading
** help
*** installing help indices
** building package indices
** testing if installed package can be loaded from temporary location
** testing if installed package can be loaded from final location
** testing if installed package keeps a record of temporary installation path
* DONE (spacewalks2)</code></pre>
</div>
<ol start="2" style="list-style-type: decimal"><li>Your <code>run_analysis.R</code> script should look like this:</li>
</ol><div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">spacewalks</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">readr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">run_analysis</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input_file</span>, <span class="va">output_file</span>, <span class="va">graph_file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"--START--\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">eva_data</span> <span class="op">&lt;-</span> <span class="fu">read_json_to_dataframe</span><span class="op">(</span><span class="va">input_file</span><span class="op">)</span></span>
<span>  <span class="fu">write.csv</span><span class="op">(</span><span class="va">eva_data</span>, <span class="va">output_file</span><span class="op">)</span></span>
<span>  <span class="fu">plot_cumulative_time_in_space</span><span class="op">(</span><span class="va">eva_data</span>, <span class="va">graph_file</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"--END--\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">input_file</span> <span class="op">&lt;-</span> <span class="st">'analysis/data/raw_data/eva-data.json'</span></span>
<span><span class="va">output_file</span> <span class="op">&lt;-</span> <span class="st">'analysis/data/derived_data/eva-data.csv'</span></span>
<span><span class="va">graph_file</span> <span class="op">&lt;-</span> <span class="st">'analysis/figures/cumulative_eva_graph.png'</span></span>
<span><span class="fu">run_analysis</span><span class="op">(</span><span class="va">input_file</span>, <span class="va">output_file</span>, <span class="va">graph_file</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a></h2>
<hr class="half-width"><p>We recommend the following resources for some additional reading on
the topic of this episode:</p>
<ul><li><a href="https://github.com/benmarwick/rrtools" class="external-link"><code>rrtools</code>
package documentation</a></li>
<li><a href="https://book.the-turing-way.org/reproducible-research/compendia" class="external-link">The
Turing Way’s “Guide for Reproducible Research – Research
Compendia”</a></li>
<li><a href="https://research-compendium.science/" class="external-link">A list of resources
about Research Compendia by Daniel Nust, Ben Marwich and Carl
Boettinger</a></li>
</ul><p>Also check the <a href="reference.html#litref">full reference set</a>
for the course.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul><li>Good practices for code and project structure are essential for
creating readable, reusable and reproducible projects.</li>
<li>You can create a research compendium using rrtools or create an R
package</li>
<li>Both approaches use a standard set of files and directories that
other R users will be familiar with</li>
<li>All functions go in the R/ folder of this new directory</li>
<li>A typical workflow is to modify your code and then run
devtools::check() to ensure there are no errors or warnings.</li>
</ul></div>
</div>
</div>
</section><section><h2 class="section-heading" id="attribution">Attribution<a class="anchor" aria-label="anchor" href="#attribution"></a></h2>
<hr class="half-width"><p>This episode reuses material from pages <a href="https://annakrystalli.me/rrtools-repro-research/create-compendium.html" class="external-link">“Create
a compendium”</a> and <a href="https://annakrystalli.me/rrtools-repro-research/package.html" class="external-link">“Manage
functionality as a package“</a> from <a href="https://annakrystalli.me/rrtools-repro-research/index.html" class="external-link">“Reproducible
Research in R with rrtools”</a> by Anna Krystalli under <a href="https://creativecommons.org/licenses/by/4.0/" class="external-link">CC-BY-4.0</a>
license with modifications. Sections covering git and github have been
removed. Output has been modified to reflect the spacewalks case study
project used in this course. Some original material has been added to
introduce the episode and to connect sections together where needed.
This is indicated with a footnote <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> e.g. Challenge “Create a Driver Script”.
The section ”Test function” is omitted and the Document function section
has been cut-down as roxygen is covered elsewhere in this course.<br>
Questions, Objectives and Keypoints have been re-used from the “Code
Structure” episod the Software Carpentries Incubator course <a href="https://carpentries-incubator.github.io/fair-research-software/07-code-structure.html" class="external-link">’Tools
and practices of FAIR research software”</a> under a <a href="https://creativecommons.org/licenses/by/4.0/" class="external-link">CC-BY-4.0</a>
licence with modifications: adaptations for R code.</p>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
<!--
Fair research software
 -->
<!--
Good Practices
 -->
<!---
Project Structure
--->
<!-------
Code Correctness
---->
<!--
Attribution
-->
</section><div class="footnotes footnotes-end-of-document">
<hr><ol><li id="fn1"><p>Original Material<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol></div>



      </div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/03-code-readability.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/05-code-documentation.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/03-code-readability.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Code readability
        </a>
        <a class="chapter-link float-end" href="../instructor/05-code-documentation.html" rel="next">
          Next: Code documentation...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/kkh451/r_reproducibility/edit/main/episodes/04-project-structure.Rmd" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/kkh451/r_reproducibility/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/kkh451/r_reproducibility/" class="external-link">Source</a></p>
        <p>
        <a href="https://github.com/kkh451/r_reproducibility/blob/main/" class="external-link">Cite</a>
        | <a href="mailto:k.r.kopec-harding@bham.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
		</div>
		<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.18.5" class="external-link">sandpaper (0.18.5)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.9" class="external-link">varnish (1.0.9)</a></p>
		</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://kkh451.github.io/r_reproducibility/instructor/04-project-structure.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "R, RStudio, lesson, reproducibility",
  "name": "Project structure",
  "creativeWorkStatus": "active",
  "url": "https://kkh451.github.io/r_reproducibility/instructor/04-project-structure.html",
  "identifier": "https://kkh451.github.io/r_reproducibility/instructor/04-project-structure.html",
  "dateCreated": "2024-09-01",
  "dateModified": "2026-02-09",
  "datePublished": "2026-02-09"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

