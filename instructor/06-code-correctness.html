<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Advanced R: R for Reproducibility: Code correctness</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png"><link rel="manifest" href="../favicons/incubator/site.webmanifest"><link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Lesson Description" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../06-code-correctness.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="../assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Advanced R: R for Reproducibility
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Advanced R: R for Reproducibility
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Advanced R: R for Reproducibility
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 74%" class="percentage">
    74%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 74%" aria-valuenow="74" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../06-code-correctness.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-introduction.html">1. Course introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-good-practices.html">2. Good Practices</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-code-readability.html">3. Code readability</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-project-structure.html">4. Code structure</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-code-documentation.html">5. Code documentation</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        6. Code correctness
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#why-use-software-testing">Why use software testing?</a></li>
<li><a href="#types-of-software-tests">Types of software tests</a></li>
<li><a href="#informal-testing">Informal testing</a></li>
<li><a href="#formal-testing">Formal testing</a></li>
<li><a href="#testing-frameworks">Testing frameworks</a></li>
<li><a href="#test-suite-design">Test suite design</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#further-reading">Further reading</a></li>
<li><a href="#attribution">Attribution</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-code-environment.html">7. Reproducible development environment</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-wrap-up.html">8. Wrap-up</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/05-code-documentation.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/07-code-environment.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/05-code-documentation.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Code documentation
        </a>
        <a class="chapter-link float-end" href="../instructor/07-code-environment.html" rel="next">
          Next: Reproducible...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Code correctness</h1>
        <p>Last updated on 2025-03-12 |

        <a href="https://github.com/kkh451/r_reproducibility/edit/main/episodes/06-code-correctness.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 90 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can we verify that our code is correct?</li>
<li>How can we automate testing in R?</li>
<li>What makes a “good” test?</li>
<li>Which parts of our code should we prioritise for testing?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>After completing this episode, participants should be able to:</p>
<ul><li>Explain why code testing is important and how this supports
reproducibility.</li>
<li>Describe the different types of software tests (unit tests,
integration tests, regression tests).</li>
<li>Implement unit tests to verify that functions behave as expected
using the R testing framework <code>testthat</code>.</li>
<li>Interpret the output from <code>testthat</code> to identify which
functions are not behaving as expected.</li>
<li>Write tests using typical values, edge cases and invalid inputs to
ensure that the code can handle extreme values and invalid inputs
appropriately.</li>
<li>Evaluate code coverage to identify how much of the code is being
tested and identify areas that need further tests.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>Now that we have improved the structure and readability of our code -
it is much easier to test its functionality and improve it further. The
goal of software testing is to check that the actual results produced by
a piece of code meet our expectations, i.e. are correct.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Open your research compendium in R Studio and clear your
environment:</p>
<ul><li>Double-click on spacwalks2.rproj to open your project in
RStudio.</li>
<li>Clear your environment using the built-in GUI:
<ul><li>Go to the Environment pane (usually on the top right).</li>
<li>Click on the ** broom icon** (Clear All) to remove all objects in
the environment.</li>
</ul></li>
</ul></div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>At this point, the code in your local software project’s directory
should be as in: TODO</p>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="why-use-software-testing">Why use software testing?<a class="anchor" aria-label="anchor" href="#why-use-software-testing"></a></h2>
<hr class="half-width"><p>Adopting software testing as part of our research workflow helps us
to conduct <strong>better research</strong> and produce reproducible
software:</p>
<ul><li>Software testing can help us be more productive as it helps us to
identify and fix problems with our code early and quickly and allows us
to demonstrate to ourselves and others that our code does what we claim.
More importantly, we can share our tests alongside our code, allowing
others to verify our software for themselves.</li>
<li>The act of writing tests encourages to structure our code as
individual functions and often results in a more
<strong>readable</strong>, modular and maintainable codebase that is
easier to extend or repurpose.</li>
<li>Software testing improves the <strong>accessibility</strong> and
<strong>reusability</strong> of our code - well-written software tests
capture the expected behaviour of our code and can be used alongside
documentation to help other developers quickly make sense of our code.
In addition, a well tested codebase allows developers to experiment with
new features safe in the knowledge that tests will reveal if their
changes have broken any existing functionality.</li>
<li>Software testing also gives us the confidence to engage in open
research practices - if we are not sure that our code works as intended
and produces accurate results, we are unlikely to feel confident about
sharing our code with others. Software testing brings piece of mind by
providing a step-by-step approach that we can apply to verify that our
code is correct.</li>
</ul></section><section><h2 class="section-heading" id="types-of-software-tests">Types of software tests<a class="anchor" aria-label="anchor" href="#types-of-software-tests"></a></h2>
<hr class="half-width"><p>There are many different types of software tests, including:</p>
<ul><li><p><strong>Unit tests</strong> focus on testing individual functions
in isolation. They ensure that each small part of the software performs
as intended. By verifying the correctness of these individual units, we
can catch errors early in the development process.</p></li>
<li><p><strong>Integration tests</strong> check how different parts of
the code e.g. functions work together.</p></li>
<li><p><strong>Regression tests</strong> are used to ensure that new
changes or updates to the codebase do not adversely affect the existing
functionality. They involve checking whether a program or part of a
program still generates the same results after changes have been
made.</p></li>
<li><p><strong>End-to-end</strong> tests are a special type of
integration testing which checks that a program as a whole behaves as
expected.</p></li>
</ul><p>In this course, our primary focus will be on unit testing. However,
the concepts and techniques we cover will provide a solid foundation
applicable to other types of testing.</p>
<div id="types-of-software-tests-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="types-of-software-tests-1" class="callout-inner">
<h3 class="callout-title">Types of software tests</h3>
<div class="callout-content">
<p>Fill in the blanks in the sentences below:</p>
<ul><li>__________ tests compare the ______ output of a program to its
________ output to demonstrate correctness.</li>
<li>Unit tests compare the actual output of a ______ ________ to the
expected output to demonstrate correctness.</li>
<li>__________ tests check that results have not changed since the
previous test run.</li>
<li>__________ tests check that two or more parts of a program are
working together correctly.</li>
</ul></div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ul><li>End-to-end tests compare the actual output of a program to the
expected output to demonstrate correctness.</li>
<li>Unit tests compare the actual output of a single function to the
expected output to demonstrate correctness.</li>
<li>Regression tests check that results have not changed since the
previous test run.</li>
<li>Integration tests check that two or more parts of a program are
working together correctly.</li>
</ul></div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="informal-testing">Informal testing<a class="anchor" aria-label="anchor" href="#informal-testing"></a></h2>
<hr class="half-width"><p>How should we test our code?</p>
<p>One approach is to load the code or a function into our R
environment.</p>
<p>From the R console, we can then run one function or a piece of code
at a time and check that it behaves as expected. To do this, we can
observe how the function behaves using input values for which we know
what the correct return value should be.</p>
<p>Let’s do this for our <code>text_to_duration</code> function.</p>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Before we do so, let’s deliberately introduce a bug into our
code:</p>
<ol style="list-style-type: decimal"><li>Open <code>R/eva_data_analysis.R</code>
</li>
<li>Let’s modify <code>text_to_duration</code> so that the
<code>minutes</code> component is divided by <code>6</code> instead of
<code>60</code> (an easy typo to make!).</li>
</ol><div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">#' Convert Duration from HH:MM Format to Hours</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#' This function converts a duration in "HH:MM" format (as a character string)</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#' into the total duration in hours (as a numeric value).</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#' @param duration A character string representing the duration in "HH:MM" format.</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#' @return A numeric value representing the duration in hours.</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#' text_to_duration("03:45")  # Returns 3.75 hours</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#' text_to_duration("12:30")  # Returns 12.5 hours</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>text_to_duration <span class="ot">&lt;-</span> <span class="cf">function</span>(duration) {</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  time_parts <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_split</span>(duration, <span class="st">":"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>  hours <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(time_parts[<span class="dv">1</span>])</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>  minutes <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(time_parts[<span class="dv">2</span>])</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>  duration_hours <span class="ot">&lt;-</span> hours <span class="sc">+</span> minutes <span class="sc">/</span> <span class="dv">6</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>  <span class="fu">return</span>(duration_hours)</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>}</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="fl">3.</span> Once we<span class="st">'ve done this we must rebuild and install our compendium using </span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="st">   "Clean and Install" from the Build panel.</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>Recall that the <code>text_to_duration</code> function converts a
spacewalk duration stored as a string in format “HH:MM” to a duration in
hours - e.g. duration <code>01:15</code> (1 hour and 15 minutes) should
return a numerical value of <code>1.25</code>.</p>
<p>Open <code>R/eva_data_analysis.R</code> in RStudio and click “Source”
to load all of the functions into the R environment.</p>
<p>On the R console, let’s invoke our function with the value
“10:00”:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">text_to_duration</span>(<span class="st">"10:00"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fl">10.0</span></span></code></pre>
</div>
<p>So, we have invoked our function with the value “10:00” and it
returned the floating point value “10” as expected.</p>
<p>We can then further explore the behaviour of our function by
running:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">text_to_duration</span>(<span class="st">"00:00"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fl">0.0</span></span></code></pre>
</div>
<p>This all seems correct so far.</p>
<p>Testing code in this “informal” way in an important process to go
through as we draft our code for the first time. However, there are some
serious drawbacks to this approach if used as our only form of
testing.</p>
<div id="what-are-the-limitations-of-informally-testing-code-5-minutes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="what-are-the-limitations-of-informally-testing-code-5-minutes" class="callout-inner">
<h3 class="callout-title">What are the limitations of informally testing code? (5 minutes)</h3>
<div class="callout-content">
<p>Think about the questions below. Your instructors may ask you to
share your answers in a shared notes document and/or discuss them with
other participants.</p>
<ul><li>Why might we choose to test our code informally?</li>
<li>What are the limitations of relying solely on informal tests to
verify that a piece of code is behaving as expected?</li>
</ul></div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>It can be tempting to test our code informally because this
approach:</p>
<ul><li>is quick and easy</li>
<li>provides immediate feedback</li>
</ul><p>However, there are limitations to this approach:</p>
<ul><li>Working interactively is error prone</li>
<li>We must reload our function in R each time we change our code</li>
<li>We must repeat our tests every time we update our code which is time
consuming</li>
<li>We must rely on memory to keep track of how we have tested our code,
e.g. what input values we tried</li>
<li>We must rely on memory to keep track of which functions have been
tested and which have not (informal testing may work well on smaller
pieces of code but it becomes unpractical for a large codebase)</li>
<li>Once we close the R console, we lose all the test scenarios we have
tried</li>
</ul></div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="formal-testing">Formal testing<a class="anchor" aria-label="anchor" href="#formal-testing"></a></h2>
<hr class="half-width"><div id="caution1" class="callout caution">
<div class="callout-square">
<i class="callout-icon" data-feather="alert-triangle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Caution</h3>
<div class="callout-content">
<p>The way we setup and store tests in this section is not conventional
for R and is used for teaching purposes to introduce the concept of
testing.</p>
<p>In section “Testing Frameworks”, we cover the conventional way to
write tests in R.</p>
</div>
</div>
</div>
<p>We can overcome some of these limitations by formalising our testing
process. A formal approach to testing our code is to write dedicated
test functions to check it. These test functions:</p>
<ul><li>Run the function we want to test - the target function with known
inputs</li>
<li>Compare the output to known, valid results</li>
<li>Raise an error if the function’s actual output does not match the
expected output</li>
<li>Are recorded in a test script that can be re-run on demand.</li>
</ul><p>Let’s explore this process by writing some formal tests for our
<code>text_to_duration</code> function.</p>
<p>In RStudio, let’s create a new R file <code>test_code.R</code> in
<code>analysis/scripts</code> to store our tests.</p>
<p>We need to load spacewalks using a <code>library()</code> call so
that we can access text_to_duration` in our test script.</p>
<p>Then, we define our first test function and run it:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">spacewalks</span><span class="op">)</span></span>
<span><span class="va">test_text_to_duration_integer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">input_value</span> <span class="op">&lt;-</span> <span class="st">"10:00"</span></span>
<span>  <span class="va">test_result</span> <span class="op">&lt;-</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">input_value</span><span class="op">)</span> <span class="op">==</span> <span class="fl">10</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="fu">paste</span><span class="op">(</span><span class="st">"text_to_duration('10:00') == 10?"</span>, <span class="va">test_result</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">test_text_to_duration_integer</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>We can run this code with RStudio using the “Source” button or by
running the code in the R console:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">test_text_to_duration_integer</span>()</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"text_to_duration('10:00') == 10? TRUE"</span></span></code></pre>
</div>
<p>This test checks that when we apply <code>text_to_duration</code> to
input value <code>10:00</code>, the output matches the expected value of
<code>10</code>.</p>
<p>In this example, we use a print statement to report whether the
actual output from <code>text_to_duration</code> meets our
expectations.</p>
<p>However, this does not meet our requirement to “Raise an error if the
function’s output does not match the expected output” and means that we
must carefully read our test function’s output to identify whether it
has failed.</p>
<p>To ensure that our code raises an error if the function’s output does
not match the expected output, we using<br>
the <code>expect_true</code> function from the <code>testthat</code>
package.</p>
<p>The <code>expect_true</code> function checks whether a statement is
<code>True</code>. If the statement is <code>True</code>,
<code>expect_true</code> does not return a value and the code continues
to run. However, if the statement is <code>False</code>,
<code>expect_true</code> raises an <code>Error</code>.</p>
<p>Let’s rewrite our test with an <code>expect_true</code>
statement:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">spacewalks</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">testthat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_text_to_duration_integer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">input_value</span> <span class="op">&lt;-</span> <span class="st">"10:00"</span></span>
<span>  <span class="va">test_result</span> <span class="op">&lt;-</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">input_value</span><span class="op">)</span> <span class="op">==</span> <span class="fl">10</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="va">test_result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">test_text_to_duration_integer</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Notice that when we run <code>test_text_to_duration_integer()</code>,
nothing happens - there is no output. That is because our function is
working correctly and returning the expected value of 10.</p>
<p>Let’s add another test to check what happens when duration is not an
integer number and if our function can handle durations with a non-zero
minute component, and rerun our test code.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">spacewalks</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">testthat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_text_to_duration_integer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">input_value</span> <span class="op">&lt;-</span> <span class="st">"10:00"</span></span>
<span>  <span class="va">test_result</span> <span class="op">&lt;-</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="va">input_value</span><span class="op">)</span> <span class="op">==</span> <span class="fl">10</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="va">test_result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">test_text_to_duration_float</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">input_value</span> <span class="op">&lt;-</span> <span class="st">"10:15"</span></span>
<span>  <span class="va">test_result</span> <span class="op">&lt;-</span> <span class="fu">all.equal</span><span class="op">(</span><span class="fu">text_to_duration</span><span class="op">(</span><span class="va">input_value</span><span class="op">)</span>, <span class="fl">10.25</span><span class="op">)</span> <span class="co">#</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="va">test_result</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">test_text_to_duration_float</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">test_text_to_duration_integer</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>&gt; test_text_to_duration_float()
Error: `test_result` is not TRUE

`actual`:   FALSE
`expected`: TRUE</code></pre>
</div>
<p>Notice that this time, our test
<code>test_text_to_duration_float</code> fails. Our
<code>expect_true</code> statement has raised an <code>Error</code> - a
clear signal that there is a problem in our code that we need to
fix.</p>
<p>We know that duration <code>10:15</code> should be converted to
number <code>10.25</code>. What is wrong with our code? If we look at
our <code>text_to_duration</code> function, we may identify the
following line of our code as problematic:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">6</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Recall that our conversion code contains a bug - the minutes
component should have been divided by 60 and not 6. We were able to spot
this tiny bug <strong>only by testing our code</strong> (note that just
by looking at the result graph there is not way to spot incorrect
results).</p>
<p>Let’s fix the problematic line and rerun out tests. To do this we
need to:</p>
<ul><li>Navigate to R/eva_data_analysis.R in RStudio</li>
<li>Correct the affected line of code</li>
</ul><div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">duration_hours</span> <span class="op">=</span> <span class="fu">int</span><span class="op">(</span><span class="va">hours</span><span class="op">)</span> <span class="op">+</span> <span class="fu">int</span><span class="op">(</span><span class="va">minutes</span><span class="op">)</span><span class="op">/</span><span class="fl">60</span> </span></code></pre>
</div>
<div id="checklist1" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Checklist</h3>
<div class="callout-content">
<p>Remember to “Clean and Install” (Build panel) to make sure that our
changes have been installed.</p>
</div>
</div>
</div>
<p>This time our tests run without problem.</p>
<p>You may have noticed that we have to repeat a lot of code to add each
individual test for each test case. You may also have noticed that our
test script stopped after the first test failure and none of the tests
after that were run.</p>
<p>To run our remaining tests we would have to manually comment out our
failing test and re-run the test script. As our code base grows, testing
in this way becomes cumbersome and error-prone. These limitations can be
overcome by automating our tests using a <strong>testing
framework</strong>.</p>
</section><section><h2 class="section-heading" id="testing-frameworks">Testing frameworks<a class="anchor" aria-label="anchor" href="#testing-frameworks"></a></h2>
<hr class="half-width"><p>Testing frameworks can automatically find all the tests in our code
base, run all of them (so we do not have to invoke them explicitly or,
even worse, forget to invoke them), and present the test results as a
readable summary.</p>
<p>We will use the R testing framework <code>testthat</code> with the
code coverage package <code>covr</code>.</p>
<p>Let’s install these packages and add them to our DESCRIPTION
file.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"testthat"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"covr)</span></span></code></pre>
</div>
<p>DESCRIPTION file</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>Suggests<span class="sc">:</span> </span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="fu">testthat</span> (<span class="sc">&gt;=</span> <span class="dv">3</span>.<span class="fl">0.0</span>),</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  covr,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  ...</span></code></pre>
</div>
<p>Let’s make sure that our tests are ready to work with
<code>testthat</code>.</p>
<ul><li>
<p><code>testthat</code> automatically discovers tests based on
specific naming patterns. It looks for files that start with “test_” or
“test-” and end with “.r” or “.R”. Then, within these files,
<code>testthat</code> looks for function calls to “test_that()”. Our
test file already meets these requirements, so there is nothing to do
here. However, our script does contain lines to run each of our test
functions. These are no-longer required as <code>testthat</code> will
run our tests so we can remove them:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Delete these 2 lines</span></span>
<span><span class="fu">test_text_to_duration_float</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">test_text_to_duration_integer</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</li>
<li><p>It is also conventional when working with <code>testthat</code>
to place test files in a <code>tests\testthat</code> directory at the
root of our project and to name each test file after the code file that
it targets. This helps in maintaining a clean structure and makes it
easier for others to understand where the tests are located.</p></li>
<li>
<p>Finally, a standard setup file <code>testthat.R</code> is placed
in the tests folder:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This file is part of the standard setup for testthat.</span></span>
<span><span class="co"># It is recommended that you do not modify it.</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Where should you do additional test configuration?</span></span>
<span><span class="co"># Learn more about the roles of various files in:</span></span>
<span><span class="co"># * https://r-pkgs.org/testing-design.html#sec-tests-files-overview</span></span>
<span><span class="co"># * https://testthat.r-lib.org/articles/special-files.html</span></span>
<span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">testthat</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">spacewalks</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">test_check</span><span class="op">(</span><span class="st">"spacewalks"</span><span class="op">)</span></span></code></pre>
</div>
</li>
</ul><p>We can setup the folder structure and setup file manually or by
running the following commands in the R console:</p>
<pre><code><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_testthat</span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>A set of tests for a given piece of code is called a test suite. Our
test suite is currently located in <code>analysis/scripts</code>. Let’s
move it to a conventional test folder <code>tests/testthat</code> and
rename our <code>test-code.R</code> file to
<code>test-eva_data_analysis.R</code>.</p>
<p>You can do this using the file panel in RStudio or by typing the
following commands in the command line terminal:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">mv</span> test-code.R tests/testthat/test-eva_data_analysis.R</span></code></pre>
</div>
<p>Before we re-run our tests using <code>testthat</code>, let’s convert
out test functions to <code>test_that()</code> calls and add some inline
comments to clarify what each test is doing. We will also expand our
syntax to highlight the logic behind our approach:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"text_to_duration returns expected ground truth values</span></span>
<span><span class="st">    for typical durations with a non-zero minute component"</span>, <span class="op">{</span></span>
<span>  <span class="va">actual_result</span> <span class="op">&lt;-</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="st">"10:15"</span><span class="op">)</span></span>
<span>  <span class="va">expected_result</span> <span class="op">&lt;-</span> <span class="fl">10.25</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu">isTRUE</span><span class="op">(</span><span class="fu">all.equal</span><span class="op">(</span><span class="va">actual_result</span><span class="op">)</span>, <span class="va">expected_result</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">test_that</span><span class="op">(</span><span class="st">"text_to_duration returns expected ground truth values</span></span>
<span><span class="st">    for typical whole hour durations"</span>, <span class="op">{</span></span>
<span>  <span class="va">actual_result</span> <span class="op">&lt;-</span> <span class="fu">text_to_duration</span><span class="op">(</span><span class="st">"10:00"</span><span class="op">)</span></span>
<span>  <span class="va">expected_result</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="va">actual_result</span><span class="op">==</span><span class="va">expected_result</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Writing our tests this way highlights the key idea that each test
should compare the actual results returned by our function with expected
values.</p>
<p>Similarly, writing inline comments for our tests that complete the
sentence “Test that …” helps us to understand what each test is doing
and why it is needed.</p>
<p>Before running out tests with <code>testthat</code>, let’s
reintroduce our old bug in function <code>text_to_duration</code> that
affects the durations with a non-zero minute component like “10:25” but
not those that are whole hours, e.g. “10:00”:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">6</span> <span class="co"># 6 instead of 60</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Finally, let’s run our tests. We can do this by running the following
command in the R console:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu">test_dir</span><span class="op">(</span><span class="st">"tests/testthat"</span><span class="op">)</span></span></code></pre>
</div>
<p>This runs all of the tests in the <code>tests/testthat</code>
directory and provides a summary of the results.</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>&gt; testthat::test_dir("tests/testthat")
✔ | F W  S  OK | Context
✖ | 1        1 | eva_data_analysis
────────────────────────────────────────────────────────────────────────────────
Error (test-eva_data_analysis.R:5:3): text_to_duration returns expected ground truth values
    for typical durations with a non-zero minute component
Error in `isTRUE(all.equal(actual_result), expected_result)`: unused argument (expected_result)
Backtrace:
    ▆
 1. └─testthat::expect_true(isTRUE(all.equal(actual_result), expected_result)) at test-eva_data_analysis.R:5:3
 2.   └─testthat::quasi_label(enquo(object), label, arg = "object")
 3.     └─rlang::eval_bare(expr, quo_get_env(quo))
────────────────────────────────────────────────────────────────────────────────

══ Results ═════════════════════════════════════════════════════════════════════
── Failed tests ────────────────────────────────────────────────────────────────
Error (test-eva_data_analysis.R:5:3): text_to_duration returns expected ground truth values
    for typical durations with a non-zero minute component
Error in `isTRUE(all.equal(actual_result), expected_result)`: unused argument (expected_result)
Backtrace:
    ▆
 1. └─testthat::expect_true(isTRUE(all.equal(actual_result), expected_result)) at test-eva_data_analysis.R:5:3
 2.   └─testthat::quasi_label(enquo(object), label, arg = "object")
 3.     └─rlang::eval_bare(expr, quo_get_env(quo))

[ FAIL 1 | WARN 0 | SKIP 0 | PASS 1 ]
Error: Test failures</code></pre>
</div>
<p>From the above output from <code>testthats</code>’s execution of out
tests, we notice that:</p>
<ul><li>If a test finishes without triggering an error, the test is
considered “OK” and is included in the total count of of successful
tests under the “OK” column.</li>
<li>If a test raises an error, the test is considered a failure with an
<code>F</code> and is included in the total count of of successful tests
under the “OK” column</li>
<li>The output includes details about the error to help identify what
went wrong.</li>
</ul><p>Let’s fix our bug once again, reload our compendium
(devtools::load_all()) and rerun our tests using
<code>testthat</code>.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text_to_duration</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">duration_hours</span> <span class="op">&lt;-</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">minutes</span> <span class="op">/</span> <span class="fl">60</span> </span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div id="checklist2" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Checklist</h3>
<div class="callout-content">
<p>Remember to “Clean and Install” (Build panel) to make sure that our
changes have been installed.</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu">test_dir</span><span class="op">(</span><span class="st">"tests/testthat"</span><span class="op">)</span></span></code></pre>
</div>
<div id="interpreting-testhat-output" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="interpreting-testhat-output" class="callout-inner">
<h3 class="callout-title">Interpreting <code>testhat</code> output</h3>
<div class="callout-content">
<p>A colleague has asked you to conduct a pre-publication review of
their code which analyses time spent in space by various individual
astronauts.</p>
<p>You tested their code using <code>testhat</code>, and got the
following output. Inspect it and answer the questions below.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&gt; testthat::test_dir("tests/testthat")
✔ | F W  S  OK | Context
✖ | 2        4 | analyse
──────────────────────────────────────────────────────────────────────────────────────────────────────────────
Failure (test-analyse.R:7:3): test_total_duration
`actual` (`actual`) not equal to `expected` (`expected`).

  `actual`: 100
`expected`:  10

Error (test-analyse.R:14:3): test_mean_duration
Error in `len(durations)`: could not find function "len"
Backtrace:
    ▆
 1. └─spacetravel:::calculate_mean_duration(durations) at test-analyse.R:14:3
──────────────────────────────────────────────────────────────────────────────────────────────────────────────
✔ |      1    2 | prepare

══ Results ═══════════════════════════════════════════════════════════════════════════════════════════════════
── Failed tests ──────────────────────────────────────────────────────────────────────────────────────────────
Failure (test-analyse.R:7:3): test_total_duration
`actual` (`actual`) not equal to `expected` (`expected`).

  `actual`: 100
`expected`:  10

Error (test-analyse.R:14:3): test_mean_duration
Error in `len(durations)`: could not find function "len"
Backtrace:
    ▆
 1. └─spacetravel:::calculate_mean_duration(durations) at test-analyse.R:14:3

[ FAIL 2 | WARN 0 | SKIP 1 | PASS 6 ]
Error: Test failures</code></pre>
</div>
<ol style="list-style-type: lower-alpha"><li>How many tests has our colleague included in the test suite?</li>
<li>How many tests failed?</li>
<li>Why did “test_total_duration” fail?</li>
<li>Why did “test_mean_duration” fail?</li>
</ol></div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<ol style="list-style-type: lower-alpha"><li>9 tests were detected in the test suite</li>
<li>s - stands for “skipped”,</li>
<li>2 tests failed in in test file <code>test_analyse.py</code>
</li>
<li>
<code>test_total_duration</code> failed because the calculated total
duration differs from the expected value by a factor of 10.</li>
<li>
<code>test_mean_duration</code> failed because there is a syntax
error in <code>calculate_mean_duration</code>. Our colleague has used
the command <code>len</code> (not an R command) instead of
<code>length</code>. As a result, running the function returns a
<code>could not find function</code> error rather than a calculated
value and the test fails.</li>
</ol></div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="test-suite-design">Test suite design<a class="anchor" aria-label="anchor" href="#test-suite-design"></a></h2>
<hr class="half-width"><p>We now have the tools in place to automatically run tests. However,
that alone is not enough to properly test code. We will now look into
what makes a good test suite and good practices for testing code.</p>
<p>Let’s start by considering the following scenario. A collaborator on
our project has sent us the following function which can be used to add
a new column called <code>crew_size</code> to our data containing the
number of astronauts participating in any given spacewalk. How do we
know that it works as intended and that it will not break the rest of
our code? For this, we need to write a test suite with a comprehensive
coverage of the new code.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#' Calculate the Size of the Crew</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' This function calculates the number of crew members from a string containing</span></span>
<span><span class="co">#' their names, separated by semicolons. The crew size is determined by counting</span></span>
<span><span class="co">#' the number of crew members listed and subtracting 1 to account for an empty string</span></span>
<span><span class="co">#' at the end of the list.  This function should be applied to a dataframe.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param crew A character string containing the names of crew members, separated by semicolons.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return An integer representing the size of the crew (the number of crew members).</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' calculate_crew_size("John Doe;Jane Doe;")  # Returns 2</span></span>
<span><span class="co">#' calculate_crew_size("John Doe;")  # Returns 1</span></span>
<span><span class="va">calculate_crew_size</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">crew</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Use purrr::map_int to iterate over each crew element and return an integer vector</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">map_int</span><span class="op">(</span><span class="va">crew</span>, <span class="kw">function</span><span class="op">(</span><span class="va">c</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">trimmed_crew</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_trim</span><span class="op">(</span><span class="va">c</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">trimmed_crew</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">return</span><span class="op">(</span><span class="cn">NA_integer_</span><span class="op">)</span>  <span class="co"># Return NA as an integer (NA_integer_)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">crew_list</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_split</span><span class="op">(</span><span class="va">c</span>, <span class="st">";"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="kw">return</span><span class="op">(</span><span class="fu">length</span><span class="op">(</span><span class="va">crew_list</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>  <span class="co"># Return the number of crew members (excluding the last empty string)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span>    </span></code></pre>
</div>
<p>Let’s add this function to <code>R/eva_data_analysis.R</code> and
update <code>analysis/run_data_analysis.R</code> to include it.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>run_analysis <span class="ot">&lt;-</span> <span class="cf">function</span>(input_file, output_file, graph_file) {</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"--START--</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>  eva_data <span class="ot">&lt;-</span> <span class="fu">read_json_to_dataframe</span>(input_file)</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>  </span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>  eva_data <span class="ot">&lt;-</span> eva_data <span class="sc">|&gt;</span> <span class="co"># Add this line</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">crew_size =</span> <span class="fu">calculate_crew_size</span>(crew)) <span class="co"># Add this line</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>  <span class="fu">write_dataframe_to_csv</span>(eva_data, output_file) <span class="co"># Add this line</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>  <span class="fu">plot_cumulative_time_in_space</span>(eva_data, graph_file)</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>  <span class="fu">generate_summary_table</span>(eva_data, <span class="st">"crew_size"</span>, <span class="st">"analysis/tables/summary_table.html"</span>)</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"--END--</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>}</span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a><span class="sc">:::</span> checklist</span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>Remember to <span class="st">"Clean and Install"</span> (Build panel) to make sure that our changes have been installed.</span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a><span class="sc">:::</span></span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a></span></code></pre>
</div>
<div class="section level3">
<h3 id="writing-good-tests">Writing good tests<a class="anchor" aria-label="anchor" href="#writing-good-tests"></a></h3>
<p>The aim of writing good tests is to verify that each of our functions
behaves as expected with the full range of inputs that it might
encounter. It is helpful to consider each argument of a function in turn
and identify the range of typical values it can take. Once we have
identified this typical range or ranges (where a function takes more
than one argument), we should:</p>
<ul><li>Test all values at the edge of the range</li>
<li>Test at least one interior point</li>
<li>Test invalid values</li>
</ul><p>Let’s have a look at the <code>calculate_crew_size</code> function
from our colleague’s new code and write some tests for it.</p>
<div id="unit-tests-for-calculate_crew_size" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="unit-tests-for-calculate_crew_size" class="callout-inner">
<h3 class="callout-title">Unit tests for calculate_crew_size</h3>
<div class="callout-content">
<p>Implement unit tests for the <code>calculate_crew_size</code>
function. Cover typical cases and edge cases.</p>
<p>Hint - use the following template when writing tests:</p>
<pre><code>test_that("MYFUNCTION ...", {
    """
    Test that ...   #FIXME
    """

    # Typical value 1
    actual_result &lt;-  _______________ #FIXME
    expected_result &lt;- ______________ #FIXME
    expect_equal(actual_result == expected_result, tolerance = 1e-6)

    # Typical value 2
    actual_result &lt;-  _______________ #FIXME
    expected_result &lt;- ______________ #FIXME
    expect_equal(actual_result == expected_result, tolerance = 1e-6)
}</code></pre>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>We can add the following test functions to out test suite.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">test_that</span><span class="op">(</span><span class="st">"calculate_crew_size returns correct values for typical crew inputs"</span>, <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># First test case</span></span>
<span>  <span class="va">actual_result_1</span> <span class="op">&lt;-</span> <span class="fu">calculate_crew_size</span><span class="op">(</span><span class="st">"Valentina Tereshkova;"</span><span class="op">)</span></span>
<span>  <span class="va">expected_result_1</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">actual_result_1</span>, <span class="va">expected_result_1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Second test case</span></span>
<span>  <span class="va">actual_result_2</span> <span class="op">&lt;-</span> <span class="fu">calculate_crew_size</span><span class="op">(</span><span class="st">"Judith Resnik; Sally Ride;"</span><span class="op">)</span></span>
<span>  <span class="va">expected_result_2</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">actual_result_2</span>, <span class="va">expected_result_2</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Edge cases</span></span>
<span><span class="fu">test_that</span><span class="op">(</span><span class="st">"calculate_crew_size returns expected value for an empty crew string"</span>, <span class="op">{</span></span>
<span>  <span class="va">actual_result</span> <span class="op">&lt;-</span> <span class="fu">calculate_crew_size</span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu">is.na</span><span class="op">(</span><span class="va">actual_result</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Let’s run out tests:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu">test_dir</span><span class="op">(</span><span class="st">"tests/testthat"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&gt; testthat::test_dir("tests/testthat")
✔ | F W  S  OK | Context
✔ |          5 | eva_data_analysis

══ Results ═══════════════════════════════════════════════════════════════════════════════════════════════════
[ FAIL 0 | WARN 0 | SKIP 0 | PASS 5 ]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="just-enough-tests">Just enough tests<a class="anchor" aria-label="anchor" href="#just-enough-tests"></a></h3>
<p>In this episode, so far we have (only) written tests for two
individual functions: <code>text_to_duration</code> and
<code>calculate_crew_size</code>.</p>
<p>We can quantify the proportion of our code base that is run (also
referred to as “exercised”) by a given test suite using a metric called
code coverage:</p>
<p><span class="math display">\[ \text{Line Coverage} = \left(
\frac{\text{Number of Executed Lines}}{\text{Total Number of Executable
Lines}} \right) \times 100 \]</span></p>
<p>We can calculate our test coverage using the <code>covr</code>
package as follows.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"covr"</span><span class="op">)</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"DT"</span><span class="op">)</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"htmltools"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">covr</span><span class="op">)</span></span>
<span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu">package_coverage</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&gt; coverage
spacewalks Coverage: 40.00%
R/eva_data_analysis.R: 40.00%</code></pre>
</div>
<p>To get an in-depth report about which parts of our code are tested
and which are not , we can run:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">covr</span><span class="fu">::</span><span class="fu">report</span><span class="op">(</span><span class="va">coverage</span><span class="op">)</span></span></code></pre>
</div>
<p>This option generates a report in the RStudio viewer. This provides
structured information about our test coverage including:</p>
<ul><li>a table showing the proportion of lines in each file that are
currently tested, and</li>
<li>an annotated copy of our code where untested lines are highlighted
in red.</li>
</ul><p>Ideally, all the lines of code in our code base should be exercised
by at least one test. However, if we lack the time and resources to test
every line of our code we should:</p>
<ul><li>avoid testing R’s built-in functions or functions imported from
well-known and well-tested libraries like <code>dplyr</code> or
<code>ggplot2</code>.</li>
<li>focus on the the parts of our code that carry the greatest
“reputational risk”, i.e. that could affect the accuracy of our reported
results.</li>
</ul><div id="callout3" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Test coverage of less than 100% indicates that more testing may be
helpful.</p>
<p>Test coverage of 100% does not mean that our code is bug-free.</p>
</div>
</div>
</div>
<div id="evaluating-code-coverage" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="evaluating-code-coverage" class="callout-inner">
<h3 class="callout-title">Evaluating code coverage</h3>
<div class="callout-content">
<p>Generate the code coverage report for your compendium using the
<code>covr::report(coverage)</code> command.</p>
<p>Inspect the report generated and extract the following
information:</p>
<ol style="list-style-type: lower-alpha"><li>What proportion of the code base is currently “not” exercised by the
test suite?</li>
<li>Which functions in our code base are currently untested?</li>
</ol></div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<ol style="list-style-type: lower-alpha"><li>The proportion of the code base NOT covered by our tests is ~60%
(100% - 40%) - this may differ for your version of the code.</li>
<li>You can find this information by checking which functions in the
annotated source code section of the report contain red (untested)
lines. The following functions in our code base are currently untested:
<ul><li>read_json_to_dataframe</li>
<li>write_dataframe_to_csv</li>
<li>add_duration_hours_variable</li>
<li>plot_cumulative_time_in_space</li>
<li>add_crew_size_variable</li>
</ul></li>
</ol></div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a></h2>
<hr class="half-width"><p>During this episode, we have covered how to use tests to verify the
correctness of our code. We have seen how to write a unit test, how to
manage and run our tests using the <code>testthat</code> framework and
how to identify which parts of our code require additional testing using
test coverage reports.</p>
<p>These skills reduce the probability that there will be a mistake in
our code and support reproducible research by giving us the confidence
to engage in open research practices. Tests also document the intended
behaviour of our code for other developers and mean that we can
experiment with changes to our code knowing that our tests will let us
know if we break any existing functionality.</p>
</section><section><h2 class="section-heading" id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a></h2>
<hr class="half-width"><p>We recommend the following resources for some additional reading on
the topic of this episode:</p>
<ul><li>
<a href="https://r-pkgs.org/testing-basics.html" class="external-link">Testing basics</a>
from Wickham, H., &amp; Bryan, J. (2023). R Packages. O’Reilly</li>
<li><a href="https://testthat.r-lib.org/" class="external-link">Testthat package
documentation</a></li>
</ul><p>Also check the <a href="reference.html#litref">full reference set</a>
for the course.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<p>1 . Code testing supports reproducibility by demonstrating that your
code behaves as you expect and consistently generates the same output
with a given set of inputs. 2. Unit testing is crucial as it ensures
each functions works correctly. 3. Using the <code>testthat</code>
package you can write basic unit tests for R functions to verify their
correctness. 4. Identifying and handling edge cases in unit tests is
essential to ensure your code performs correctly under a variety of
conditions. 5. Test coverage can help you to identify parts of your code
that require additional testing.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="attribution">Attribution<a class="anchor" aria-label="anchor" href="#attribution"></a></h2>
<hr class="half-width"><p>This episode reuses material from the <a href="https://carpentries-incubator.github.io/fair-research-software/09-code-documentation.html" class="external-link">“Code
Correctness”</a> episode of the Software Carpentries Incubator course <a href="https://carpentries-incubator.github.io/fair-research-software/" class="external-link">“Tools
and practices of FAIR research software”</a> under a <a href="https://creativecommons.org/licenses/by/4.0/deed.en" class="external-link">CC-BY-4.0</a>
with modifications (i) adaptations have been made to make the material
suitable for an audience of R users (e.g. replacing “software” with
“code” in places, pytest with testthat), (ii) all code has been ported
from Python to R (iii) Objectives, Questions, Key Points and Further
Reading sections have been updated to reflect the remixed R focussed
content.</p>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
<!--
Fair research software
 -->
<!--
Good Practices
 -->
<!---
Project Structure
--->
<!-------
Code Correctness
---->
<!--
Attribution
-->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/05-code-documentation.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/07-code-environment.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/05-code-documentation.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Code documentation
        </a>
        <a class="chapter-link float-end" href="../instructor/07-code-environment.html" rel="next">
          Next: Reproducible...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/kkh451/r_reproducibility/edit/main/episodes/06-code-correctness.Rmd" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/kkh451/r_reproducibility/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/kkh451/r_reproducibility/" class="external-link">Source</a></p>
				<p><a href="https://github.com/kkh451/r_reproducibility/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:k.r.kopec-harding@bham.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://kkh451.github.io/r_reproducibility/instructor/06-code-correctness.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "R, RStudio, lesson, reproducibility",
  "name": "Code correctness",
  "creativeWorkStatus": "active",
  "url": "https://kkh451.github.io/r_reproducibility/instructor/06-code-correctness.html",
  "identifier": "https://kkh451.github.io/r_reproducibility/instructor/06-code-correctness.html",
  "dateCreated": "2024-09-01",
  "dateModified": "2025-03-12",
  "datePublished": "2025-03-12"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

